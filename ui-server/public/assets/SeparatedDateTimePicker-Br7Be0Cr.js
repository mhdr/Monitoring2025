import{bI as e,bQ as a}from"./vendor-TAwwu7tv.js";import{j as t}from"./date-utils-hKKKzaQW.js";import{a as r,c as l}from"./layout-C1_h6sDC.js";const n=l(),i=({id:l,value:i,onChange:c,"data-id-ref":s,className:o="",dateLabel:d,timeLabel:m})=>{const{language:u}=r(),f=e.useRef(null),p=e.useRef(null),[h,g]=e.useState(""),[j,v]=e.useState(""),b=e.useCallback(e=>{if(!e)return{date:"",time:""};const[a,t]=e.split("T");return{date:a||"",time:t||""}},[]),$=e.useCallback(e=>{if(!e)return"";try{const[a,r,l]=e.split("-").map(Number),{jy:n,jm:i,jd:c}=t.toJalaali(a,r,l);return`${n}/${String(i).padStart(2,"0")}/${String(c).padStart(2,"0")}`}catch(a){return n.error("Error converting ISO date to Jalali:",a),""}},[]),k=e.useCallback(e=>{if(!e)return"";try{const a=e.match(/(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(!a)return"";const[,r,l,n]=a,{gy:i,gm:c,gd:s}=t.toGregorian(parseInt(r),parseInt(l),parseInt(n)),o=String(i);return`${o}-${String(c).padStart(2,"0")}-${String(s).padStart(2,"0")}`}catch(a){return n.error("Error converting Jalali date to ISO:",a),""}},[]),w=e.useCallback((e,a)=>e&&a?`${e}T${a}`:"",[]);e.useEffect(()=>{const{date:e,time:a}=b(i);g("fa"===u&&e?$(e):e),v(a)},[i,u,b,$]),e.useEffect(()=>{"fa"===u&&f.current&&h&&(f.current.value=h)},[u,h]),e.useEffect(()=>{if("fa"!==u||!f.current)return;const e=f.current,a=()=>{const a=e.value;if(a&&a!==h){const e=k(a);if(e){g(a);const t=w(e,j);t&&c(t)}}};return e.addEventListener("change",a),()=>{e.removeEventListener("change",a)}},[u,h,j,k,w,c]),e.useEffect(()=>{"fa"===u&&new Promise((e,a)=>{if(window.jalaliDatepicker)return void e();const t="jalali-datepicker-script";let r=document.getElementById(t);if(r){const a=setInterval(()=>{window.jalaliDatepicker&&(clearInterval(a),e())},50);return}r=document.createElement("script"),r.id=t,r.src="/lib/jalalidatepicker/jalalidatepicker.min.js",r.async=!0,r.onload=()=>e(),r.onerror=()=>a(new Error("Failed to load JalaliDatePicker")),document.head.appendChild(r)}).catch(e=>{n.error("Error loading JalaliDatePicker:",e)})},[u]),e.useEffect(()=>{if("fa"!==u)return;const e=e=>{const a=e.target;p.current&&(!f.current||f.current.contains(a)||p.current.contains(a)||(n.log("Click outside detected, hiding Jalali picker"),window.jalaliDatepicker?.hide(),p.current=null))};return document.addEventListener("mousedown",e,!0),()=>{document.removeEventListener("mousedown",e,!0)}},[u]);const x=e.useCallback(()=>{if(!f.current)return;const e=f.current.value,a=k(e);if(a){g(e);const t=w(a,j);t&&c(t)}p.current=null,n.log("Date selected, picker reference cleared")},[k,j,w,c]),N=e=>{const a=e.target.value;v(a);let t=h;"fa"===u&&h&&(t=k(h));const r=w(t,a);r&&c(r)},C=e.useCallback(e=>{e.preventDefault(),window.jalaliDatepicker&&f.current?(window.jalaliDatepicker.show(f.current,{time:!1,date:!0,autoHide:!0,hideAfterChange:!0,persianDigits:!0,initDate:f.current.value||void 0,onChange:x}),setTimeout(()=>{const e=document.querySelector("jdp-container");e&&(p.current=e,n.log("Picker opened, container reference saved"))},50)):n.warn("JalaliDatePicker not loaded yet")},[x]);return"fa"===u?a.jsx("div",{className:o,"data-id-ref":`${s}-container`,children:a.jsxs("div",{className:"row g-2",children:[a.jsxs("div",{className:"col-12 col-sm-6",children:[d&&a.jsx("label",{htmlFor:`${l}-date`,className:"form-label small mb-1","data-id-ref":`${s}-date-label`,children:d}),a.jsx("input",{ref:f,type:"text",className:"form-control form-control-sm",id:`${l}-date`,"data-id-ref":`${s}-date`,placeholder:"____/__/__",onClick:C,onFocus:C,readOnly:!0})]}),a.jsxs("div",{className:"col-12 col-sm-6",children:[m&&a.jsx("label",{htmlFor:`${l}-time`,className:"form-label small mb-1","data-id-ref":`${s}-time-label`,children:m}),a.jsx("input",{type:"time",className:"form-control form-control-sm",id:`${l}-time`,value:j,onChange:N,"data-id-ref":`${s}-time`})]})]})}):a.jsx("div",{className:o,"data-id-ref":`${s}-container`,children:a.jsxs("div",{className:"row g-2",children:[a.jsxs("div",{className:"col-12 col-sm-6",children:[d&&a.jsx("label",{htmlFor:`${l}-date`,className:"form-label small mb-1","data-id-ref":`${s}-date-label`,children:d}),a.jsx("input",{type:"date",className:"form-control form-control-sm",id:`${l}-date`,value:h,onChange:e=>{const a=e.target.value;g(a);const t=w(a,j);t&&c(t)},"data-id-ref":`${s}-date`})]}),a.jsxs("div",{className:"col-12 col-sm-6",children:[m&&a.jsx("label",{htmlFor:`${l}-time`,className:"form-label small mb-1","data-id-ref":`${s}-time-label`,children:m}),a.jsx("input",{type:"time",className:"form-control form-control-sm",id:`${l}-time`,value:j,onChange:N,"data-id-ref":`${s}-time`})]})]})})};export{i as S};
