const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ItemAddEditModbusMappingDialog-UnWR5l6Z.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/i18n-BrX_VL2O.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/ItemDeleteModbusMappingDialog-Ca-ACOWv.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./i18n-BrX_VL2O.js";import{bI as s,bQ as t}from"./vendor-TAwwu7tv.js";import{a as i,c as a,a7 as o,E as n}from"./layout-C1_h6sDC.js";import{SyncfusionGridWrapper as l}from"./SyncfusionGridWrapper-je9qfgPl.js";import{b as r}from"./api-D5q9v5qU.js";import{B as d,h as m,I as p,z as c,E as u,a as g,F as x,c as h,v as f,j,O as b}from"./mui-core-im59jMHH.js";import{E as y,G as C,C as M,a8 as S}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./react-router-B0bL9ISA.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const w=a(),I=s.lazy(()=>e(()=>import("./ItemAddEditModbusMappingDialog-UnWR5l6Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),k=s.lazy(()=>e(()=>import("./ItemDeleteModbusMappingDialog-Ca-ACOWv.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),E=({open:e,item:a,onClose:E,onMappingsChange:T})=>{const{t:_}=i(),[v,z]=s.useState([]),[D,F]=s.useState([]),[$,N]=s.useState(!1),[W,P]=s.useState(null),[A,R]=s.useState(null),[O,B]=s.useState(!1),[G,H]=s.useState(!1),[L,V]=s.useState(null),[Q,Y]=s.useState(!1);s.useEffect(()=>{e&&(async()=>{try{const e=await n();e?.data&&(F(e.data),w.log("Controllers fetched",{count:e.data.length}))}catch(e){w.error("Failed to fetch controllers",{error:e})}})()},[e]);const Z=s.useCallback(async()=>{if(a?.id){N(!0),P(null);try{w.log("Fetching mappings for item",{itemId:a.id});const e=await o({itemId:a.id});e?.data&&(z(e.data),w.log("Mappings fetched",{count:e.data.length}),T?.(e.data.length))}catch(e){w.error("Failed to fetch mappings",{error:e}),P(_("itemModbusMappings.errors.fetchMappingsFailed"))}finally{N(!1)}}},[a?.id,_,T]);s.useEffect(()=>{e&&a?.id&&Z()},[e,a?.id,Z]);const q=s.useMemo(()=>{const e=new Map;return v.forEach(s=>{const t=e.get(s.controllerId)||[];t.push(s.position),e.set(s.controllerId,t)}),e},[v]),J=s.useCallback(()=>{V(null),Y(!1),B(!0)},[]),K=s.useCallback(e=>{V(e),Y(!0),B(!0)},[]),U=s.useCallback(e=>{V(e),H(!0)},[]),X=e=>{B(!1),H(!1),V(null),Y(!1),e&&Z()},ee=e=>{R(e),setTimeout(()=>R(null),5e3)},se=s.useCallback(e=>t.jsxs(d,{"data-id-ref":`item-mapping-actions-${e.id}`,sx:{display:"flex",gap:.5,py:.5},children:[t.jsx(m,{title:_("common.buttons.edit"),children:t.jsx(p,{"data-id-ref":`item-mapping-edit-btn-${e.id}`,size:"small",color:"primary",onClick:()=>K(e),children:t.jsx(y,{fontSize:"small"})})}),t.jsx(m,{title:_("common.buttons.delete"),children:t.jsx(p,{"data-id-ref":`item-mapping-delete-btn-${e.id}`,size:"small",color:"error",onClick:()=>U(e),children:t.jsx(C,{fontSize:"small"})})})]}),[_,K,U]),te=s.useMemo(()=>v.map(e=>({...e,controllerDisplay:`${e.controllerName} (${e.ipAddress}:${e.port})`,operationTypeName:e.operationType===r.Read?_("modbusControllers.mappings.read"):_("modbusControllers.mappings.write")})),[v,_]),ie=s.useMemo(()=>[{field:"controllerDisplay",headerText:_("itemModbusMappings.controllerName"),width:200,minWidth:150,allowSorting:!0},{field:"position",headerText:_("modbusControllers.mappings.position"),width:100,minWidth:80,allowSorting:!0},{field:"operationTypeName",headerText:_("modbusControllers.mappings.operationType"),width:120,minWidth:100,allowSorting:!0},{field:"id",headerText:_("common.actions"),width:120,minWidth:120,allowSorting:!1,allowFiltering:!1,template:se}],[_,se]);return t.jsxs(t.Fragment,{children:[t.jsxs(c,{open:e,onClose:E,maxWidth:"md",fullWidth:!0,"data-id-ref":"item-modbus-mappings-dialog",PaperProps:{sx:{height:{xs:"100%",sm:"70vh"},maxHeight:{xs:"100%",sm:"70vh"}}},children:[t.jsxs(u,{"data-id-ref":"item-modbus-mappings-dialog-title",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pr:1},children:[t.jsxs(d,{children:[t.jsx(g,{variant:"h6",component:"span",children:_("itemModbusMappings.title")}),a&&t.jsxs(g,{variant:"subtitle2",color:"text.secondary",component:"div",children:[a.pointNumber," - ",a.name]})]}),t.jsx(p,{"data-id-ref":"item-modbus-mappings-close-btn",onClick:E,size:"small",children:t.jsx(M,{})})]}),t.jsxs(x,{"data-id-ref":"item-modbus-mappings-dialog-content",sx:{display:"flex",flexDirection:"column",p:2},children:[W&&t.jsx(h,{"data-id-ref":"item-modbus-mappings-error",severity:"error",onClose:()=>P(null),sx:{mb:2},children:W}),A&&t.jsx(h,{"data-id-ref":"item-modbus-mappings-success",severity:"success",onClose:()=>R(null),sx:{mb:2},children:A}),t.jsx(d,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:t.jsx(f,{"data-id-ref":"item-modbus-add-mapping-btn",variant:"contained",size:"small",startIcon:t.jsx(S,{}),onClick:J,disabled:0===D.length,children:_("modbusControllers.mappings.addMapping")})}),$?t.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(j,{})}):0===v.length?t.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(g,{"data-id-ref":"item-modbus-no-mappings",color:"text.secondary",children:_("itemModbusMappings.noMappings")})}):t.jsx(d,{sx:{flex:1,minHeight:200},children:t.jsx(l,{dataSource:te,columns:ie,height:"100%",allowPaging:!1,allowSorting:!0,allowResizing:!0,"data-id-ref":"item-modbus-mappings-grid"})})]}),t.jsx(b,{"data-id-ref":"item-modbus-mappings-dialog-actions",children:t.jsx(f,{"data-id-ref":"item-modbus-mappings-close-action-btn",onClick:E,children:_("common.buttons.close")})})]}),t.jsx(s.Suspense,{fallback:null,children:O&&a&&t.jsx(I,{open:O,editMode:Q,mapping:L,itemId:a.id,itemName:`${a.pointNumber} - ${a.name}`,controllers:D,existingPositionsByController:q,onClose:X,onSuccess:ee})}),t.jsx(s.Suspense,{fallback:null,children:G&&a&&t.jsx(k,{open:G,mapping:L,onClose:X,onSuccess:ee})})]})};export{E as default};
