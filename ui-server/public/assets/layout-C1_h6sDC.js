import{bL as e,bM as t,bN as a,bO as r,bP as i,bI as s,bQ as n,bR as o}from"./vendor-TAwwu7tv.js";import{i as l,B as c,a as d,b as u,u as m,_ as g}from"./i18n-BrX_VL2O.js";import{u as p,B as h,A as f,C as y,T as x,I as b,a as v,M as w,b as S,D as k,S as j,c as C,d as A,L as N,e as I,f as E,g as T,h as M,i as F,j as D,k as R,l as $}from"./mui-core-im59jMHH.js";import{M as P,A as O,P as L,S as H,a as _,b as G,L as U,C as B,D as z,W,c as V,d as q,U as K,e as Q,f as X,g as Y}from"./mui-icons-v3eeVnKX.js";import{u as J,a as Z,O as ee}from"./react-router-B0bL9ISA.js";l.use(c).use(d).use(u).init({fallbackLng:"en",supportedLngs:["en","fa"],nonExplicitSupportedLngs:!0,debug:!1,interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},ns:["translation"],defaultNS:"translation",detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"i18nextLng"},react:{useSuspense:!1},load:"currentOnly",preload:["en"],partialBundledLanguages:!0});const te=()=>{},ae=e=>({log:te,info:te,warn:te,error:te,debug:te,trace:te,table:te,group:te,groupCollapsed:te,groupEnd:te,time:te,timeEnd:te}),re=ae(),ie=e()(t(e=>({language:"en",isLoadingLanguage:!1,changeLanguage:async t=>{e({isLoadingLanguage:!0});try{await l.changeLanguage(t),document.documentElement.dir="fa"===t?"rtl":"ltr",document.documentElement.lang=t,document.title=l.t("pageTitle"),document.body.className="fa"===t?"rtl":"ltr",e({language:t}),re.info("Language changed:",{language:t,direction:"fa"===t?"rtl":"ltr"})}catch(a){re.error("Failed to change language:",a)}finally{e({isLoadingLanguage:!1})}},setLoadingLanguage:t=>{e({isLoadingLanguage:t})}}),{name:"language-storage",version:1,partialize:e=>({language:e.language})})),se=async()=>{try{await l.loadLanguages(["en","fa"]);const e=localStorage.getItem("language-storage");let t="en";if(e)try{const a=JSON.parse(e);!a.state?.language||"en"!==a.state.language&&"fa"!==a.state.language||(t=a.state.language,re.log("Stored language detected:",t))}catch{re.warn("Failed to parse stored language, using default")}l.language!==t&&await l.changeLanguage(t),document.documentElement.dir="fa"===t?"rtl":"ltr",document.documentElement.lang=t,document.body.className="fa"===t?"rtl":"ltr",ie.setState({language:t}),re.log("Language initialized:",{language:t,direction:document.documentElement.dir})}catch(e){re.error("Failed to initialize language:",e),await l.changeLanguage("en"),ie.setState({language:"en"})}},ne=()=>{const e=ie(e=>e.language),t=ie(e=>e.isLoadingLanguage),a=ie(e=>e.changeLanguage),{t:r}=m();return{language:e,isLoadingLanguage:t,changeLanguage:a,t:r}},oe=ae(),le=6048e5,ce={token:null,refreshToken:null,user:null,expiration:null,_hasHydrated:!1},de=e()(t((e,t)=>({...ce,setAuth:(t,a,r)=>{const i=Date.now()+le;oe.info("Setting auth data:",{hasToken:!!t,hasRefreshToken:!!r,userId:a.id,userName:a.userName,expiresAt:new Date(i).toISOString()}),e({token:t,refreshToken:r||null,user:a,expiration:i})},clearAuth:()=>{oe.info("Clearing auth data");const a=t()._hasHydrated;e({...ce,_hasHydrated:a})},extendExpiration:()=>{const a=t();if(a.token){const t=Date.now()+le;oe.info("Extending auth expiration:",{oldExpiration:a.expiration?new Date(a.expiration).toISOString():"none",newExpiration:new Date(t).toISOString()}),e({expiration:t})}},isExpired:()=>{const e=t();if(!e.expiration)return!1;const a=Date.now()>e.expiration;return a&&oe.warn("Auth has expired:",{expiration:new Date(e.expiration).toISOString(),now:(new Date).toISOString()}),a},getTokenSync:()=>t().token,setHasHydrated:t=>{e({_hasHydrated:t})}}),{name:"auth-storage",version:1,onRehydrateStorage:e=>(oe.info("Auth store rehydration starting..."),(t,a)=>{a?oe.error("Error rehydrating auth state:",a):oe.info("Auth state rehydrated from localStorage:",{hasToken:!!t?.token,hasUser:!!t?.user}),e.setHasHydrated(!0)}),partialize:e=>({token:e.token,refreshToken:e.refreshToken,user:e.user,expiration:e.expiration})})),ue={getStoredTokenSync:()=>de.getState().getTokenSync(),getStoredToken:async()=>de.getState().token,getStoredRefreshToken:async()=>de.getState().refreshToken,getStoredUser:async()=>de.getState().user,isAuthExpired:async()=>de.getState().isExpired(),extendAuthExpiration:async()=>{de.getState().extendExpiration()},setStoredAuth:async(e,t,a)=>{de.getState().setAuth(e,t,a)},clearStoredAuth:async()=>{de.getState().clearAuth()},clearAll:async()=>{de.getState().clearAuth()},hasHydrated:()=>de.getState()._hasHydrated,waitForHydration:()=>new Promise(e=>{if(de.getState()._hasHydrated)return void e();const t=de.subscribe(a=>{a._hasHydrated&&(t(),e())})})},me=ae();let ge=null;const pe=()=>{if("undefined"==typeof BroadcastChannel)return me.warn("BroadcastChannel API is not supported in this browser"),null;if(ge)return ge;try{return ge=new BroadcastChannel("auth-channel"),me.debug("Auth BroadcastChannel initialized"),ge}catch(e){return me.error("Failed to initialize Auth BroadcastChannel:",e),null}},he=(e,t)=>{const a=ge||pe();if(a)try{const r={type:"LOGIN",payload:{accessToken:e,refreshToken:t}};a.postMessage(r),me.debug("Broadcasted LOGIN event")}catch(r){me.error("Failed to broadcast LOGIN event:",r)}},fe=()=>{const e=ge||pe();if(e)try{const t={type:"LOGOUT"};e.postMessage(t),me.debug("Broadcasted LOGOUT event")}catch(t){me.error("Failed to broadcast LOGOUT event:",t)}},ye=(e,t)=>{const a=ge||pe();if(a)try{const r={type:"TOKEN_REFRESHED",payload:{accessToken:e,refreshToken:t}};a.postMessage(r),me.debug("Broadcasted TOKEN_REFRESHED event")}catch(r){me.error("Failed to broadcast TOKEN_REFRESHED event:",r)}},xe=e=>{const t=ge||pe();if(t)try{const a={type:"AUTH_CHECK_RESPONSE",payload:{isAuthenticated:e}};t.postMessage(a),me.debug("Broadcasted AUTH_CHECK_RESPONSE:",e)}catch(a){me.error("Failed to broadcast AUTH_CHECK_RESPONSE:",a)}},be=e=>{const t=ge||pe();if(!t)return()=>{};const a=t=>{try{e(t.data)}catch(a){me.error("Error handling auth broadcast message:",a)}};return t.addEventListener("message",a),()=>{t.removeEventListener("message",a)}},ve=ae();function we(){return ve.log("Production mode: Using relative URLs (same origin)"),""}const Se={baseUrl:we(),signalRBaseUrl:function ke(){return we()}(),timeout:1e4,logConfig(){}},je=ae(),Ce=new r,Ae=a.create({baseURL:Se.baseUrl,timeout:Se.timeout,headers:{"Content-Type":"application/json"}});function Ne(e){if(a.isAxiosError(e)){const t=e;if(a.isCancel(e)||"ERR_CANCELED"===t.code){const e=new Error("Request was cancelled");throw e.cancelled=!0,e}if("ECONNABORTED"===t.code)throw new Error("Request timeout - please try again");if("ERR_NETWORK"===t.code)throw new Error("Network error - please check your connection");const r=t.response?.data,i=r?.message||t.message||"An error occurred",s=t.response?.status||0,n=new Error(i);throw n.status=s,n.errors=r?.errors,n}throw e}Ae.interceptors.request.use(e=>{const t=ue.getStoredTokenSync();return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`,ue.extendAuthExpiration().catch(e=>{je.error("Failed to extend auth expiration:",e)})),e},e=>(je.error("Request interceptor error:",e),Promise.reject(e))),Ae.interceptors.response.use(e=>e,async e=>{const t=e.config;if(401===e.response?.status&&t&&!t._retry){const e=/\/api\/auth\/login/i.test(t.url||""),i=/\/api\/auth\/refresh-token/i.test(t.url||"");if(!e&&!i){if(t._retry=!0,Ce.isLocked())return await Ce.waitForUnlock(),Ae(t);const e=await Ce.acquire();try{const e=await ue.getStoredToken(),i=await ue.getStoredRefreshToken(),s=await ue.getStoredUser();if(e&&i&&s){je.log("Attempting to refresh token...");try{const r=await a.post(`${Se.baseUrl}/api/Auth/refresh-token`,{accessToken:e,refreshToken:i},{headers:{"Content-Type":"application/json"},timeout:Se.timeout});if(r.data?.success&&r.data?.accessToken){const{accessToken:e,refreshToken:a,user:i}=r.data;return await ue.setStoredAuth(e,i||s,a),a&&ye(e,a),je.log("Token refreshed successfully"),t.headers&&(t.headers.Authorization=`Bearer ${e}`),Ae(t)}je.warn("Token refresh failed - unsuccessful response"),await ue.clearStoredAuth()}catch(r){je.error("Token refresh request failed:",r),await ue.clearStoredAuth()}}else je.warn("Missing tokens for refresh"),await ue.clearStoredAuth()}finally{e()}"/login"!==window.location.pathname&&(je.warn("Redirecting to login after failed refresh"),window.location.href="/login")}}return Promise.reject(e)});const Ie=async e=>{try{const t=await Ae.post("/api/Auth/login",e);return t.data.success&&await ue.setStoredAuth(t.data.accessToken,t.data.user,t.data.refreshToken),t.data}catch(t){Ne(t)}},Ee=async e=>{try{return(await Ae.post("/api/Auth/change-password",e)).data}catch(t){Ne(t)}},Te=async()=>{try{await Ae.post("/api/Auth/logout")}catch(e){Ne(e)}},Me=ae(),Fe={IDLE:"idle",CONNECTING:"connecting",CONNECTED:"connected",ERROR:"error",DISCONNECTED:"disconnected"},De={groups:[],items:[],alarms:[],isDataSynced:!1,lastSyncTime:null},Re={activeAlarms:{alarmCount:0,lastUpdate:null,streamStatus:Fe.IDLE,streamError:null,fetchError:null,isFetching:!1,highestPriority:null,list:[]},backgroundRefresh:{enabled:!0,refreshInterval:3e5,lastRefreshTime:null},alarmRefreshTrigger:0},$e=e()(i(t((e,t)=>({...De,...Re,setGroups:t=>{Me.info("Setting groups:",{count:t.length}),e({groups:t,lastSyncTime:Date.now()})},clearGroups:()=>{Me.info("Clearing groups"),e({groups:[]})},setItems:t=>{Me.info("Setting items:",{count:t.length}),e({items:t,lastSyncTime:Date.now()})},clearItems:()=>{Me.info("Clearing items"),e({items:[]})},setAlarms:t=>{Me.info("Setting alarms:",{count:t.length}),e({alarms:t,lastSyncTime:Date.now()})},clearAlarms:()=>{Me.info("Clearing alarms"),e({alarms:[]})},setDataSynced:t=>{Me.info("Setting data synced status:",t),e({isDataSynced:t})},clearDataSyncStatus:()=>{Me.info("Clearing data sync status"),e({isDataSynced:!1})},updateActiveAlarms:(t,a,r)=>{Me.log("Updating active alarms:",{alarmCount:t,highestPriority:r,timestamp:a}),e(e=>({activeAlarms:{...e.activeAlarms,alarmCount:t,lastUpdate:a,highestPriority:r??e.activeAlarms.highestPriority}}))},setActiveAlarmsList:t=>{Me.log("Setting active alarms list:",{count:t.length}),e(e=>({activeAlarms:{...e.activeAlarms,list:t,alarmCount:t.length,lastUpdate:Date.now()}}))},setActiveAlarmsStreamStatus:t=>{Me.log("Setting active alarms stream status:",t),e(e=>({activeAlarms:{...e.activeAlarms,streamStatus:t}}))},setActiveAlarmsStreamError:t=>{Me.error("Active alarms stream error:",t),e(e=>({activeAlarms:{...e.activeAlarms,streamError:t,streamStatus:Fe.ERROR}}))},setActiveAlarmsFetching:t=>{e(e=>({activeAlarms:{...e.activeAlarms,isFetching:t}}))},setActiveAlarmsFetchError:t=>{e(e=>({activeAlarms:{...e.activeAlarms,fetchError:t}}))},resetActiveAlarmsStream:()=>{Me.info("Resetting active alarms stream"),e({activeAlarms:{...Re.activeAlarms}})},updateBackgroundRefreshConfig:t=>{Me.info("Updating background refresh config:",t),e(e=>({backgroundRefresh:{...e.backgroundRefresh,...t}}))},setLastRefreshTime:t=>{e(e=>({backgroundRefresh:{...e.backgroundRefresh,lastRefreshTime:t}}))},triggerAlarmRefresh:()=>{e(e=>({alarmRefreshTrigger:e.alarmRefreshTrigger+1}))},clearAllMonitoringData:()=>{Me.info("Clearing all monitoring data"),e({...De,...Re})},hasStoredData:()=>{const e=t();return e.groups.length>0||e.items.length>0||e.alarms.length>0}}),{name:"monitoring-storage",version:1,partialize:e=>({groups:e.groups,items:e.items,alarms:e.alarms,isDataSynced:e.isDataSynced,lastSyncTime:e.lastSyncTime})}),{name:"MonitoringStore",enabled:!0})),Pe={getStoredGroups:async()=>{const e=$e.getState().groups;return e.length>0?e:null},setStoredGroups:async e=>{$e.getState().setGroups(e)},clearStoredGroups:async()=>{$e.getState().clearGroups()},getStoredItems:async()=>{const e=$e.getState().items;return e.length>0?e:null},setStoredItems:async e=>{$e.getState().setItems(e)},clearStoredItems:async()=>{$e.getState().clearItems()},getStoredAlarms:async()=>{const e=$e.getState().alarms;return e.length>0?e:null},setStoredAlarms:async e=>{$e.getState().setAlarms(e)},clearStoredAlarms:async()=>{$e.getState().clearAlarms()},clearAllMonitoringData:async()=>{$e.getState().clearAllMonitoringData()},hasStoredData:async()=>$e.getState().hasStoredData()},Oe=Object.freeze(Object.defineProperty({__proto__:null,StreamStatus:Fe,monitoringStorageHelpers:Pe,useMonitoringStore:$e},Symbol.toStringTag,{value:"Module"})),Le=ae(),He=()=>{const e=de(e=>e.user),t=de(e=>e.token),a=de(e=>e._hasHydrated),[r,i]=s.useState(!1),n=Boolean(t&&e),o=!a||r;s.useEffect(()=>{Le.log("Auth state initialized:",{hasToken:!!t,hasUser:!!e,isAuthenticated:n,hasHydrated:a})},[t,e,n,a]),s.useEffect(()=>{pe();const e=be(e=>{switch(e.type){case"LOGIN":Le.debug("Received LOGIN broadcast from another tab"),ue.setStoredAuth(e.payload.accessToken,de.getState().user,e.payload.refreshToken);break;case"LOGOUT":Le.debug("Received LOGOUT broadcast from another tab"),de.getState().clearAuth(),Pe.clearAllMonitoringData();break;case"TOKEN_REFRESHED":Le.debug("Received TOKEN_REFRESHED broadcast from another tab"),ue.setStoredAuth(e.payload.accessToken,de.getState().user,e.payload.refreshToken);break;case"AUTH_CHECK_REQUEST":Le.debug("Received AUTH_CHECK_REQUEST"),xe(n);break;case"AUTH_CHECK_RESPONSE":Le.debug("Received AUTH_CHECK_RESPONSE:",e.payload.isAuthenticated);break;default:Le.warn("Unknown auth broadcast message type:",e)}});return()=>{e(),ge&&(ge.close(),ge=null,me.debug("Auth BroadcastChannel closed"))}},[n]),s.useEffect(()=>{if(!n)return;ue.extendAuthExpiration().catch(e=>{Le.error("Failed to extend auth expiration on mount:",e)});const e=setInterval(()=>{ue.extendAuthExpiration().catch(e=>{Le.error("Failed to extend auth expiration:",e)})},3e5);return()=>clearInterval(e)},[n]);const l=s.useCallback(async e=>{try{i(!0);const t=await Ie(e);await ue.setStoredAuth(t.accessToken,t.user,t.refreshToken),i(!1),t.refreshToken&&he(t.accessToken,t.refreshToken)}catch(t){throw i(!1),t}},[]),c=s.useCallback(async()=>{try{await Te()}catch(e){Le.error("Logout API call failed, but continuing with local cleanup:",e)}await ue.clearAll(),await Pe.clearAllMonitoringData().catch(e=>{Le.error("Failed to clear monitoring data on logout:",e)}),fe()},[]);return{user:e,token:t,isAuthenticated:n,isLoading:o,login:l,logout:c}},_e=async e=>{const{monitoringStorageHelpers:t}=await g(async()=>{const{monitoringStorageHelpers:e}=await Promise.resolve().then(()=>Oe);return{monitoringStorageHelpers:e}},void 0);return await t.setStoredGroups(e.groups),e},Ge=async e=>{const{monitoringStorageHelpers:t}=await g(async()=>{const{monitoringStorageHelpers:e}=await Promise.resolve().then(()=>Oe);return{monitoringStorageHelpers:e}},void 0);return await t.setStoredItems(e.items),e},Ue=async e=>{const{monitoringStorageHelpers:t}=await g(async()=>{const{monitoringStorageHelpers:e}=await Promise.resolve().then(()=>Oe);return{monitoringStorageHelpers:e}},void 0);return await t.setStoredAlarms(e.data.data),e},Be=async()=>{const{monitoringStorageHelpers:e}=await g(async()=>{const{monitoringStorageHelpers:e}=await Promise.resolve().then(()=>Oe);return{monitoringStorageHelpers:e}},void 0),t=await e.getStoredItems();return t?t.map(e=>e.id):[]},ze=ae(),We=async()=>{try{const e=await Ae.post("/api/Monitoring/Groups",{}),t=await ue.getStoredUser();if(t?.roles?.some(e=>"admin"===e.toLowerCase()||"administrator"===e.toLowerCase())){ze.log("Admin user detected - returning all groups without filtering:",{totalGroups:e.data.groups.length,userRoles:t?.roles||[]});const a={groups:e.data.groups};return _e(a)}const a=await Ae.post("/api/Monitoring/Items",{showOrphans:!0}),r=new Set;a.data.items.forEach(e=>{e.groupId&&r.add(e.groupId)});const i=t=>{const a=e.data.groups.find(e=>e.id===t);a&&a.parentId&&!r.has(a.parentId)&&(r.add(a.parentId),i(a.parentId))};Array.from(r).forEach(e=>i(e));const s=e.data.groups.filter(e=>r.has(e.id));return ze.log("Regular user groups filtering result:",{totalGroups:e.data.groups.length,accessibleItems:a.data.items.length,accessibleGroupIds:Array.from(r),filteredGroups:s.length,userRoles:t?.roles||[]}),_e({groups:s})}catch(e){Ne(e)}},Ve=async(e={showOrphans:!1})=>{try{const t=await Ae.post("/api/Monitoring/Items",e);return Ge(t.data)}catch(t){Ne(t)}},qe=async e=>{try{const t={};if(e?.itemIds&&e.itemIds.length>0)t.itemIds=e.itemIds,ze.log("Using provided itemIds for getValues",{count:e.itemIds.length});else{const e=await Be();e&&e.length>0?(t.itemIds=e,ze.log("Using itemIds from utility for getValues",{count:e.length})):ze.log("No stored items found, sending request without itemIds (backend will return data based on user permissions)")}return(await Ae.post("/api/Monitoring/Values",t)).data}catch(t){Ne(t)}},Ke=async e=>{try{return(await Ae.post("/api/Monitoring/Value",e)).data}catch(t){Ne(t)}},Qe=async e=>{try{return(await Ae.post("/api/Monitoring/History",e)).data}catch(t){Ne(t)}},Xe=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteItem",e)).data}catch(t){Ne(t)}},Ye=async e=>{try{return(await Ae.post("/api/Monitoring/MovePoint",e)).data}catch(t){Ne(t)}},Je=async e=>{try{const t={};if(e?.itemIds&&e.itemIds.length>0)t.itemIds=e.itemIds,ze.log("Using provided itemIds for getAlarms",{count:e.itemIds.length});else{const e=await Be();e&&e.length>0?(t.itemIds=e,ze.log("Using itemIds from utility for getAlarms",{count:e.length})):ze.log("No stored items found, sending request without itemIds (backend will return alarms based on user permissions)")}const a=await Ae.post("/api/Monitoring/Alarms",t);return ze.log("Alarms fetched successfully",{alarmsCount:a.data.data?.data?.length||0}),Ue(a.data)}catch(t){ze.error("Failed to fetch alarms",t),Ne(t)}},Ze=async e=>{try{const t={};if(e?.itemIds&&e.itemIds.length>0)t.itemIds=e.itemIds,ze.log("Using provided itemIds for getActiveAlarms",{count:e.itemIds.length});else{const e=await Be();e&&e.length>0?(t.itemIds=e,ze.log("Using itemIds from utility for getActiveAlarms",{count:e.length})):ze.log("No stored items found, sending request without itemIds (backend will return active alarms based on user permissions)")}return(await Ae.post("/api/Monitoring/ActiveAlarms",t)).data}catch(t){Ne(t)}},et=async e=>{try{const t={startDate:e.startDate,endDate:e.endDate};if(e.itemIds&&e.itemIds.length>0)t.itemIds=e.itemIds,ze.log("Using provided itemIds for getAlarmHistory",{count:e.itemIds.length});else{const e=await Be();e&&e.length>0?(t.itemIds=e,ze.log("Using itemIds from utility for getAlarmHistory",{count:e.length})):ze.log("No stored items found, sending request without itemIds (backend will return alarm history based on user permissions)")}void 0!==e.page&&null!==e.page&&(t.page=e.page),void 0!==e.pageSize&&null!==e.pageSize&&(t.pageSize=e.pageSize),ze.log("Fetching alarm history with pagination",{startDate:e.startDate,endDate:e.endDate,page:t.page||1,pageSize:t.pageSize||100});const a=(await Ae.post("/api/Monitoring/HistoryAlarms",t)).data.data;return ze.log("Alarm history fetched successfully",{page:a.page,pageSize:a.pageSize,totalCount:a.totalCount,totalPages:a.totalPages,itemsInCurrentPage:a.data?.length||0}),a}catch(t){Ne(t)}},tt=async e=>{try{ze.log("Adding new alarm:",{itemId:e.itemId,alarmType:e.alarmType,alarmPriority:e.alarmPriority,compareType:e.compareType,isDisabled:e.isDisabled});const t=await Ae.post("/api/Monitoring/AddAlarm",e);return ze.log("Alarm added successfully:",{success:t.data.success,alarmId:t.data.alarmId,message:t.data.message}),t.data}catch(t){ze.error("Failed to add alarm:",t),Ne(t)}},at=async e=>{try{const t=await Ae.post("/api/Monitoring/EditAlarm",e);return ze.log("Alarm edited successfully:",{alarmId:e.id,success:t.data.success}),t.data}catch(t){ze.error("Failed to edit alarm:",{alarmId:e.id,error:t}),Ne(t)}},rt=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteAlarm",e)).data}catch(t){Ne(t)}},it=async e=>{try{return(await Ae.post("/api/Monitoring/GetExternalAlarms",e)).data}catch(t){Ne(t)}},st=async e=>{try{return(await Ae.post("/api/Monitoring/BatchEditExternalAlarms",e)).data}catch(t){Ne(t)}},nt=async e=>{try{return(await Ae.post("/api/Monitoring/AddGroup",e)).data}catch(t){Ne(t)}},ot=async e=>{try{return(await Ae.post("/api/Monitoring/EditGroup",e)).data}catch(t){Ne(t)}},lt=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteGroup",e)).data}catch(t){Ne(t)}},ct=async e=>{try{return(await Ae.post("/api/Monitoring/MoveGroup",e)).data}catch(t){Ne(t)}},dt=async e=>{try{const t=await Ae.post("/api/Monitoring/WriteOrAddValue",e),a=t.data.data;return ze.log("Write or add value completed successfully",{itemId:e.itemId,value:e.value,isSuccess:a.isSuccess,message:t.data.message}),a}catch(t){ze.error("Failed to write or add value",{itemId:e.itemId,value:e.value,error:t}),Ne(t)}},ut=async e=>{const t=ae();try{t.log("Fetching item details",{itemId:e});const a=await Ae.post("/api/Monitoring/GetItem",{itemId:e});return t.log("Item fetched successfully",{itemId:e,success:a.data.success}),a.data}catch(a){t.error("Failed to fetch item",{itemId:e,error:a}),Ne(a)}},mt=e=>e.charAt(0).toUpperCase()+e.slice(1),gt=e=>{if(null==e)return e;if("object"!=typeof e)return e;if(Array.isArray(e))return e.map(gt);const t={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[mt(a)]=gt(e[a]));return t},pt=async e=>{const t=ae();try{t.log("Editing item",{itemId:e.id,itemName:e.itemName});const a=gt(e);t.log("Sending PascalCase request payload:",a);const r=await Ae.post("/api/Monitoring/EditItem",a);return t.log("Item edited successfully",{itemId:e.id,success:r.data.success,message:r.data.message}),r.data}catch(a){t.error("Failed to edit item",{itemId:e.id,error:a}),Ne(a)}},ht=async()=>{const e=ae();try{e.log("Fetching next available point number");const t=await Ae.post("/api/Monitoring/NextNumber",{});return e.log("Next point number retrieved successfully",{nextPointNumber:t.data.nextPointNumber,success:t.data.success}),t.data}catch(t){e.error("Failed to get next point number",{error:t}),Ne(t)}},ft=async e=>{const t=ae();try{t.log("Adding item",{itemName:e.itemName,pointNumber:e.pointNumber});const a=gt(e);t.log("Sending PascalCase request payload:",a);const r=await Ae.post("/api/Monitoring/AddItem",a);return t.log("Item added successfully",{itemName:e.itemName,success:r.data.success,itemId:r.data.itemId,message:r.data.message}),r.data}catch(a){t.error("Failed to add item",{itemName:e.itemName,error:a}),Ne(a)}},yt=async()=>{const e=ae();try{e.log("Fetching settings version");const t=await Ae.get("/api/Monitoring/SettingsVersion");return e.log("Settings version retrieved successfully",{version:t.data.version,userVersion:t.data.userVersion}),t.data}catch(t){e.error("Failed to get settings version",t),Ne(t)}},xt=async e=>{try{ze.log("Fetching point mean by date",e);const t=await Ae.post("/api/Monitoring/PointMeanByDate",e);return ze.log("Point mean retrieved successfully",{success:t.data.success,count:t.data.dailyValues?.length}),t.data}catch(t){ze.error("Failed to get point mean by date",t),Ne(t)}},bt=async e=>{try{ze.log("Fetching point min by date",e);const t=await Ae.post("/api/Monitoring/PointMinByDate",e);return ze.log("Point min retrieved successfully",{success:t.data.success,count:t.data.dailyValues?.length}),t.data}catch(t){ze.error("Failed to get point min by date",t),Ne(t)}},vt=async e=>{try{ze.log("Fetching point max by date",e);const t=await Ae.post("/api/Monitoring/PointMaxByDate",e);return ze.log("Point max retrieved successfully",{success:t.data.success,count:t.data.dailyValues?.length}),t.data}catch(t){ze.error("Failed to get point max by date",t),Ne(t)}},wt=async e=>{try{ze.log("Fetching point std by date",e);const t=await Ae.post("/api/Monitoring/PointStdByDate",e);return ze.log("Point std retrieved successfully",{success:t.data.success,count:t.data.dailyValues?.length}),t.data}catch(t){ze.error("Failed to get point std by date",t),Ne(t)}},St=async e=>{try{ze.log("Fetching point count by date",e);const t=await Ae.post("/api/Monitoring/PointCountByDate",e);return ze.log("Point count retrieved successfully",{success:t.data.success,count:t.data.dailyCounts?.length}),t.data}catch(t){ze.error("Failed to get point count by date",t),Ne(t)}},kt=async e=>{try{ze.log("Fetching point mean (24h)",e);const t=await Ae.post("/api/Monitoring/PointMean",e);return ze.log("Point mean (24h) retrieved successfully",{mean:t.data.mean}),t.data}catch(t){ze.error("Failed to get point mean (24h)",t),Ne(t)}},jt=async e=>{try{ze.log("Fetching point min (24h)",e);const t=await Ae.post("/api/Monitoring/PointMin",e);return ze.log("Point min (24h) retrieved successfully",{min:t.data.min}),t.data}catch(t){ze.error("Failed to get point min (24h)",t),Ne(t)}},Ct=async e=>{try{ze.log("Fetching point max (24h)",e);const t=await Ae.post("/api/Monitoring/PointMax",e);return ze.log("Point max (24h) retrieved successfully",{max:t.data.max}),t.data}catch(t){ze.error("Failed to get point max (24h)",t),Ne(t)}},At=async e=>{try{ze.log("Fetching point std (24h)",e);const t=await Ae.post("/api/Monitoring/PointStd",e);return ze.log("Point std (24h) retrieved successfully",{std:t.data.std}),t.data}catch(t){ze.error("Failed to get point std (24h)",t),Ne(t)}},Nt=async e=>{try{ze.log("Fetching point count (24h)",e);const t=await Ae.post("/api/Monitoring/PointCount",e);return ze.log("Point count (24h) retrieved successfully",{count:t.data.count}),t.data}catch(t){ze.error("Failed to get point count (24h)",t),Ne(t)}},It=async e=>{try{ze.log("Calculating state duration",e);const t=await Ae.post("/api/Monitoring/CalculateStateDuration",e,{timeout:6e4});return ze.log("State duration calculated successfully",{success:t.data.success,totalDurationSeconds:t.data.totalDurationSeconds,matchedValue:t.data.matchedValue}),t.data}catch(t){ze.error("Failed to calculate state duration",t),Ne(t)}},Et=async(e={})=>{try{return(await Ae.post("/api/Monitoring/PushUpdate",e)).data}catch(t){Ne(t)}},Tt=async()=>{try{return(await Ae.post("/api/Monitoring/ModbusControllers")).data}catch(e){Ne(e)}},Mt=async e=>{try{return(await Ae.post("/api/Monitoring/AddModbusController",e)).data}catch(t){Ne(t)}},Ft=async e=>{try{return(await Ae.post("/api/Monitoring/EditModbusController",e)).data}catch(t){Ne(t)}},Dt=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteModbusController",e)).data}catch(t){Ne(t)}},Rt=async e=>{try{return(await Ae.post("/api/Monitoring/GetModbusMaps",e)).data}catch(t){Ne(t)}},$t=async e=>{try{return(await Ae.post("/api/Monitoring/BatchEditModbusMaps",e)).data}catch(t){Ne(t)}},Pt=async e=>{try{return(await Ae.post("/api/Monitoring/GetModbusMappingsByItemId",e)).data}catch(t){Ne(t)}},Ot=async()=>{try{return(await Ae.post("/api/Monitoring/GetControllers",{controllerType:2})).data}catch(e){Ne(e)}},Lt=async e=>{try{return(await Ae.post("/api/Monitoring/AddController",{...e,controllerType:2})).data}catch(t){Ne(t)}},Ht=async e=>{try{return(await Ae.post("/api/Monitoring/EditController",{...e,controllerType:2})).data}catch(t){Ne(t)}},_t=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteController",{...e,controllerType:2})).data}catch(t){Ne(t)}},Gt=async e=>{try{return(await Ae.post("/api/Monitoring/GetMappings",{...e,controllerType:2})).data}catch(t){Ne(t)}},Ut=async e=>{try{return(await Ae.post("/api/Monitoring/BatchEditMappings",{...e,controllerType:2})).data}catch(t){Ne(t)}},Bt=async e=>{try{return(await Ae.post("/api/Monitoring/GetSharp7MappingsByItemId",e)).data}catch(t){Ne(t)}},zt=async()=>{try{return(await Ae.post("/api/Monitoring/GetModbusGateways",{})).data}catch(e){Ne(e)}},Wt=async e=>{try{return(await Ae.post("/api/Monitoring/AddModbusGateway",e)).data}catch(t){Ne(t)}},Vt=async e=>{try{return(await Ae.post("/api/Monitoring/EditModbusGateway",e)).data}catch(t){Ne(t)}},qt=async e=>{try{return(await Ae.post("/api/Monitoring/DeleteModbusGateway",e)).data}catch(t){Ne(t)}},Kt=async e=>{try{return(await Ae.post("/api/Monitoring/GetModbusGatewayMappings",e)).data}catch(t){Ne(t)}},Qt=async e=>{try{return(await Ae.post("/api/Monitoring/BatchEditModbusGatewayMappings",e)).data}catch(t){Ne(t)}},Xt=ae();function Yt(){const[e,t]=s.useState([]),[a,r]=s.useState(!1),[i,n]=s.useState(null),o=$e(e=>e.groups),l=$e(e=>e.items),c=$e(e=>e.alarms),d=$e(e=>e.isDataSynced),u=$e(e=>e.lastSyncTime),m=$e(e=>e.activeAlarms),g=$e(e=>e.backgroundRefresh),p=$e(e=>e.alarmRefreshTrigger),h=$e(e=>e.setGroups),f=$e(e=>e.setItems),y=$e(e=>e.setAlarms),x=$e(e=>e.setDataSynced),b=$e(e=>e.clearDataSyncStatus),v=$e(e=>e.updateActiveAlarms),w=$e(e=>e.setActiveAlarmsList),S=$e(e=>e.setActiveAlarmsStreamStatus),k=$e(e=>e.setActiveAlarmsStreamError),j=$e(e=>e.setActiveAlarmsFetching),C=$e(e=>e.setActiveAlarmsFetchError),A=$e(e=>e.resetActiveAlarmsStream),N=$e(e=>e.updateBackgroundRefreshConfig),I=$e(e=>e.setLastRefreshTime),E=$e(e=>e.triggerAlarmRefresh),T=$e(e=>e.clearAllMonitoringData),M=s.useCallback(async()=>{try{Xt.log("Syncing groups from API...");const e=await We();h(e.groups),Xt.log("Groups synced successfully:",{count:e.groups.length})}catch(e){throw Xt.error("Failed to sync groups:",e),e}},[h]),F=s.useCallback(async()=>{try{Xt.log("Syncing items from API...");const e=await Ve();f(e.items),Xt.log("Items synced successfully:",{count:e.items.length})}catch(e){throw Xt.error("Failed to sync items:",e),e}},[f]),D=s.useCallback(async()=>{try{Xt.log("Syncing alarms from API...");const e=await Je();y(e.data.data),Xt.log("Alarms synced successfully:",{count:e.data.data.length})}catch(e){throw Xt.error("Failed to sync alarms:",e),e}},[y]),R=s.useCallback(async()=>{try{j(!0);const e=$e.getState(),t=e.items,a=t.map(e=>e.id).filter(e=>null!=e);if(Xt.log("Fetching active alarm count with itemIds filter:",{itemCount:t.length,itemIdsCount:a.length}),0===a.length)return Xt.warn("No itemIds available - skipping active alarm count fetch"),v(0,Date.now(),null),C(null),void j(!1);const r=(await Ze({itemIds:a})).data.data||[];let i=null;if(r.length>0){const t=e.alarms;for(const e of r)if(e.alarmId){const a=t.find(t=>t.id===e.alarmId);if(a?.alarmPriority){if(2===a.alarmPriority){i=2;break}1!==a.alarmPriority||i||(i=1)}}}Xt.log("Active alarm count fetched successfully (filtered by itemIds):",{count:r.length,highestPriority:2===i?"High":1===i?"Low":"None",itemIdsUsed:a.length}),w(r),v(r.length,Date.now(),i),C(null)}catch(e){Xt.error("Failed to fetch active alarm count:",e);const t=e instanceof Error?e.message:"Failed to fetch alarm count";C(t)}finally{j(!1)}},[v,w,j,C]),$=s.useCallback(async e=>{try{r(!0),n(null),Xt.log("Fetching values for items:",{count:e.length});const a=await qe({itemIds:e});t(a.values),Xt.log("Values fetched successfully:",{count:a.values.length})}catch(a){Xt.error("Failed to fetch values:",a);const e=a instanceof Error?a.message:"Failed to fetch values";n({message:e})}finally{r(!1)}},[]),P=M,O=F,L=D,H=s.useCallback(e=>{},[]);return{state:{groups:o,items:l,alarms:c,values:e,isDataSynced:d,lastSyncTime:u,activeAlarms:{alarmCount:m.alarmCount,lastUpdate:m.lastUpdate,streamStatus:m.streamStatus,streamError:m.streamError,fetchError:m.fetchError,isFetching:m.isFetching,highestPriority:m.highestPriority,list:m.list},backgroundRefresh:{enabled:g.enabled,refreshInterval:g.refreshInterval,lastRefreshTime:g.lastRefreshTime},alarmRefreshTrigger:p,groupsLoading:!1,itemsLoading:!1,alarmsLoading:!1,valuesLoading:a,groupsError:null,itemsError:null,alarmsError:null,valuesError:i},syncGroups:M,syncItems:F,syncAlarms:D,fetchGroups:P,fetchItems:O,fetchAlarms:L,fetchValues:$,setCurrentFolderId:H,setDataSynced:x,clearDataSyncStatus:b,updateActiveAlarms:v,setActiveAlarmsStreamStatus:S,setActiveAlarmsStreamError:k,resetActiveAlarmsStream:A,fetchActiveAlarmCount:R,updateBackgroundRefreshConfig:N,setLastRefreshTime:I,triggerAlarmRefresh:E,clearAllMonitoringData:T,StreamStatus:Fe}}const Jt=ae(),Zt=({size:e=40,animated:t=!0,className:a,"data-id-ref":r="monitoring-logo"})=>{const i=p();return Jt.debug("Rendering MonitoringLogo",{size:e,animated:t,theme:i.palette.mode}),n.jsx(h,{component:"div",className:a,"data-id-ref":r,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:e,height:e},children:n.jsxs("svg",{width:e,height:e,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-id-ref":`${r}-svg`,style:t?{transformOrigin:"center",animation:"logoBreathing 4s ease-in-out infinite"}:{},children:[n.jsxs("defs",{children:[n.jsxs("filter",{id:`glow-${r}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:`strong-glow-${r}`,x:"-100%",y:"-100%",width:"300%",height:"300%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsx("style",{children:"\n            @keyframes logoBreathing {\n              0%, 100% { transform: scale(1); }\n              50% { transform: scale(1.08); }\n            }\n            @keyframes rotateClockwise {\n              from { transform: rotate(0deg); }\n              to { transform: rotate(360deg); }\n            }\n            @keyframes rotateCounterClockwise {\n              from { transform: rotate(0deg); }\n              to { transform: rotate(-360deg); }\n            }\n          "})]}),n.jsx("g",{style:t?{transformOrigin:"50px 50px",animation:"rotateClockwise 20s linear infinite"}:{},children:n.jsx("circle",{cx:"50",cy:"50",r:"45",fill:i.palette.primary.main,fillOpacity:"0.1",stroke:i.palette.primary.main,strokeWidth:"2",filter:t?`url(#glow-${r})`:void 0,"data-id-ref":`${r}-background-circle`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"stroke-width",values:"2;4;2",dur:"3s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"0.3;1;0.3",dur:"3s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke",values:`${i.palette.primary.main};${i.palette.secondary.main};${i.palette.info.main};${i.palette.primary.main}`,dur:"6s",repeatCount:"indefinite"})]})})}),t&&n.jsxs(n.Fragment,{children:[n.jsxs("circle",{cx:"50",cy:"50",r:"30",fill:"none",stroke:i.palette.primary.light,strokeWidth:"4",strokeOpacity:"1",filter:`url(#strong-glow-${r})`,"data-id-ref":`${r}-pulse-ring-1`,children:[n.jsx("animate",{attributeName:"r",values:"10;45;10",dur:"2s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"1;0.01;1",dur:"2s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke-width",values:"5;0.5;5",dur:"2s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke",values:`${i.palette.success.main};${i.palette.warning.main};${i.palette.error.main};${i.palette.success.main}`,dur:"4s",repeatCount:"indefinite"})]}),n.jsxs("circle",{cx:"50",cy:"50",r:"25",fill:"none",stroke:i.palette.secondary.main,strokeWidth:"3",strokeOpacity:"0.9",filter:`url(#strong-glow-${r})`,"data-id-ref":`${r}-pulse-ring-2`,children:[n.jsx("animate",{attributeName:"r",values:"8;42;8",dur:"2.3s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"1;0.01;1",dur:"2.3s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"stroke-width",values:"4;0.3;4",dur:"2.3s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"stroke",values:`${i.palette.info.main};${i.palette.secondary.main};${i.palette.primary.main};${i.palette.info.main}`,dur:"5s",repeatCount:"indefinite"})]}),n.jsxs("circle",{cx:"50",cy:"50",r:"20",fill:"none",stroke:i.palette.info.light,strokeWidth:"2.5",strokeOpacity:"0.8",filter:`url(#glow-${r})`,"data-id-ref":`${r}-pulse-ring-3`,children:[n.jsx("animate",{attributeName:"r",values:"6;38;6",dur:"2.7s",repeatCount:"indefinite",begin:"1.2s"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"0.9;0.01;0.9",dur:"2.7s",repeatCount:"indefinite",begin:"1.2s"}),n.jsx("animate",{attributeName:"stroke-width",values:"3;0.2;3",dur:"2.7s",repeatCount:"indefinite",begin:"1.2s"})]}),n.jsxs("circle",{cx:"50",cy:"50",r:"15",fill:"none",stroke:i.palette.warning.light,strokeWidth:"2",strokeOpacity:"0.7",filter:`url(#glow-${r})`,"data-id-ref":`${r}-pulse-ring-4`,children:[n.jsx("animate",{attributeName:"r",values:"4;35;4",dur:"3.1s",repeatCount:"indefinite",begin:"1.8s"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"0.8;0.01;0.8",dur:"3.1s",repeatCount:"indefinite",begin:"1.8s"}),n.jsx("animate",{attributeName:"stroke-width",values:"2.5;0.1;2.5",dur:"3.1s",repeatCount:"indefinite",begin:"1.8s"})]})]}),n.jsxs("g",{"data-id-ref":`${r}-central-symbol`,style:t?{transformOrigin:"50px 45px"}:{},children:[n.jsx("rect",{x:"35",y:"35",width:"30",height:"20",rx:"2",fill:i.palette.common.white,stroke:i.palette.primary.main,strokeWidth:"2",filter:t?`url(#glow-${r})`:void 0,"data-id-ref":`${r}-monitor-screen`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"stroke-width",values:"2;4;2",dur:"2.5s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke",values:`${i.palette.primary.main};${i.palette.success.main};${i.palette.info.main};${i.palette.primary.main}`,dur:"4s",repeatCount:"indefinite"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.15;0.95;1.05;1",dur:"3s",repeatCount:"indefinite",additive:"sum"}),n.jsx("animate",{attributeName:"fill",values:`${i.palette.common.white};${i.palette.primary.light};${i.palette.common.white}`,dur:"4s",repeatCount:"indefinite"})]})}),n.jsx("rect",{x:"47",y:"55",width:"6",height:"8",fill:i.palette.primary.main,"data-id-ref":`${r}-monitor-stand`}),n.jsx("rect",{x:"42",y:"63",width:"16",height:"3",rx:"1.5",fill:i.palette.primary.main,"data-id-ref":`${r}-monitor-base`}),n.jsxs("g",{"data-id-ref":`${r}-chart-lines`,children:[n.jsx("polyline",{points:"38,48 42,44 46,46 50,42 54,45 58,43 62,47",fill:"none",stroke:i.palette.success.main,strokeWidth:"3",strokeLinecap:"round",filter:`url(#glow-${r})`,"data-id-ref":`${r}-chart-line-1`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"stroke-dasharray",values:"0,100;40,60;0,100",dur:"1.8s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke-width",values:"3;5;3",dur:"1.8s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"0.9;1;0.9",dur:"1.8s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"points",values:"38,48 42,44 46,46 50,42 54,45 58,43 62,47;38,46 42,42 46,48 50,44 54,43 58,45 62,49;38,50 42,46 46,44 50,46 54,47 58,41 62,45;38,48 42,44 46,46 50,42 54,45 58,43 62,47",dur:"4s",repeatCount:"indefinite"})]})}),n.jsx("polyline",{points:"38,50 40,47 44,49 48,46 52,48 56,45 60,49 62,46",fill:"none",stroke:i.palette.warning.main,strokeWidth:"2.5",strokeLinecap:"round",strokeOpacity:"1",filter:`url(#glow-${r})`,"data-id-ref":`${r}-chart-line-2`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"stroke-dasharray",values:"0,100;35,65;0,100",dur:"2.2s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"stroke-width",values:"2.5;4;2.5",dur:"2.2s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"stroke-opacity",values:"0.8;1;0.8",dur:"2.2s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"points",values:"38,50 40,47 44,49 48,46 52,48 56,45 60,49 62,46;38,52 40,45 44,51 48,48 52,46 56,47 60,47 62,48;38,48 40,49 44,47 48,44 52,50 56,43 60,51 62,44;38,50 40,47 44,49 48,46 52,48 56,45 60,49 62,46",dur:"4.5s",repeatCount:"indefinite",begin:"1s"})]})}),n.jsx("polyline",{points:"39,52 43,49 47,51 51,48 55,50 59,47",fill:"none",stroke:i.palette.info.main,strokeWidth:"2",strokeLinecap:"round",strokeOpacity:"0.9",filter:`url(#glow-${r})`,"data-id-ref":`${r}-chart-line-3`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"stroke-dasharray",values:"0,100;25,75;0,100",dur:"2.8s",repeatCount:"indefinite",begin:"1.2s"}),n.jsx("animate",{attributeName:"stroke-width",values:"2;3.5;2",dur:"2.8s",repeatCount:"indefinite",begin:"1.2s"}),n.jsx("animate",{attributeName:"points",values:"39,52 43,49 47,51 51,48 55,50 59,47;39,50 43,51 47,49 51,50 55,48 59,49;39,54 43,47 47,53 51,46 55,52 59,45;39,52 43,49 47,51 51,48 55,50 59,47",dur:"3.8s",repeatCount:"indefinite",begin:"1.8s"})]})})]}),n.jsx("circle",{cx:"40",cy:"39",r:"1.5",fill:i.palette.success.main,filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-status-dot-1`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"1s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"r",values:"1.5;4;0.5;1.5",dur:"1s",repeatCount:"indefinite"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.5;0.8;1",dur:"1s",repeatCount:"indefinite"})]})}),n.jsx("circle",{cx:"45",cy:"39",r:"1.5",fill:i.palette.warning.main,filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-status-dot-2`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"fill-opacity",values:"0.1;1;0.01",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),n.jsx("animate",{attributeName:"r",values:"1.5;4.5;0.3;1.5",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.8;0.6;1",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})]})}),n.jsx("circle",{cx:"50",cy:"39",r:"1.5",fill:i.palette.info.main,filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-status-dot-3`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"1.4s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animate",{attributeName:"r",values:"1.5;5;0.2;1.5",dur:"1.4s",repeatCount:"indefinite",begin:"0.6s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;2;0.5;1",dur:"1.4s",repeatCount:"indefinite",begin:"0.6s"})]})}),n.jsx("circle",{cx:"55",cy:"39",r:"1.5",fill:i.palette.error.main,filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-status-dot-4`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"fill-opacity",values:"0.2;1;0.01",dur:"0.9s",repeatCount:"indefinite",begin:"0.9s"}),n.jsx("animate",{attributeName:"r",values:"1.5;3.5;0.4;1.5",dur:"0.9s",repeatCount:"indefinite",begin:"0.9s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.6;0.7;1",dur:"0.9s",repeatCount:"indefinite",begin:"0.9s"})]})}),n.jsx("circle",{cx:"60",cy:"39",r:"1",fill:i.palette.secondary.main,filter:t?`url(#glow-${r})`:void 0,"data-id-ref":`${r}-status-dot-5`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"fill-opacity",values:"0.5;1;0.01",dur:"1.1s",repeatCount:"indefinite",begin:"1.2s"}),n.jsx("animate",{attributeName:"r",values:"1;3;0.1;1",dur:"1.1s",repeatCount:"indefinite",begin:"1.2s"})]})})]}),n.jsxs("g",{"data-id-ref":`${r}-corner-indicators`,children:[n.jsx("circle",{cx:"20",cy:"20",r:"3",fill:i.palette.success.main,fillOpacity:"1",filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-corner-indicator-1`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"r",values:"0.5;8;0.5",dur:"1.8s",repeatCount:"indefinite"}),n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"1.8s",repeatCount:"indefinite"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;2.5;0.3;1",dur:"1.8s",repeatCount:"indefinite"})]})}),n.jsx("circle",{cx:"80",cy:"20",r:"2.5",fill:i.palette.warning.main,fillOpacity:"1",filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-corner-indicator-2`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"r",values:"0.3;7;0.3",dur:"2s",repeatCount:"indefinite",begin:"0.45s"}),n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"2s",repeatCount:"indefinite",begin:"0.45s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;2.2;0.4;1",dur:"2s",repeatCount:"indefinite",begin:"0.45s"})]})}),n.jsx("circle",{cx:"20",cy:"80",r:"2",fill:i.palette.info.main,fillOpacity:"1",filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-corner-indicator-3`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"r",values:"0.4;6.5;0.4",dur:"1.9s",repeatCount:"indefinite",begin:"0.9s"}),n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"1.9s",repeatCount:"indefinite",begin:"0.9s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;2.8;0.2;1",dur:"1.9s",repeatCount:"indefinite",begin:"0.9s"})]})}),n.jsx("circle",{cx:"80",cy:"80",r:"2.8",fill:i.palette.error.main,fillOpacity:"1",filter:t?`url(#strong-glow-${r})`:void 0,"data-id-ref":`${r}-corner-indicator-4`,children:t&&n.jsxs(n.Fragment,{children:[n.jsx("animate",{attributeName:"r",values:"0.6;9;0.6",dur:"2.1s",repeatCount:"indefinite",begin:"1.35s"}),n.jsx("animate",{attributeName:"fill-opacity",values:"1;0.01;1",dur:"2.1s",repeatCount:"indefinite",begin:"1.35s"}),n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;3;0.1;1",dur:"2.1s",repeatCount:"indefinite",begin:"1.35s"})]})}),n.jsxs("g",{style:t?{transformOrigin:"50px 50px",animation:"rotateCounterClockwise 15s linear infinite"}:{},children:[n.jsx("circle",{cx:"15",cy:"50",r:"1",fill:i.palette.secondary.light,fillOpacity:"0.6",children:t&&n.jsx("animate",{attributeName:"r",values:"0.5;2.5;0.5",dur:"3s",repeatCount:"indefinite"})}),n.jsx("circle",{cx:"85",cy:"50",r:"1",fill:i.palette.primary.light,fillOpacity:"0.6",children:t&&n.jsx("animate",{attributeName:"r",values:"0.5;2.5;0.5",dur:"3s",repeatCount:"indefinite",begin:"1.5s"})}),n.jsx("circle",{cx:"50",cy:"15",r:"1",fill:i.palette.warning.light,fillOpacity:"0.6",children:t&&n.jsx("animate",{attributeName:"r",values:"0.5;2.5;0.5",dur:"3s",repeatCount:"indefinite",begin:"0.75s"})}),n.jsx("circle",{cx:"50",cy:"85",r:"1",fill:i.palette.success.light,fillOpacity:"0.6",children:t&&n.jsx("animate",{attributeName:"r",values:"0.5;2.5;0.5",dur:"3s",repeatCount:"indefinite",begin:"2.25s"})})]})]})]})})},ea=ae(),ta=({onToggleSidebar:e})=>{const{t,language:a}=ne(),{user:r,logout:i}=He(),o=J(),[l,c]=s.useState(null),[d,u]=s.useState({open:!1,message:"",severity:"success"}),[m,g]=s.useState(!1),p=()=>{c(null)},A=()=>{u({...d,open:!1})};return n.jsxs(n.Fragment,{children:[n.jsx(f,{position:"static",className:"custom-navbar shadow",elevation:0,sx:{borderRadius:0,width:"100%"},"data-id-ref":"responsive-navbar-root",children:n.jsx(y,{maxWidth:!1,disableGutters:!0,sx:{px:{xs:2,sm:3}},"data-id-ref":"responsive-navbar-container",children:n.jsxs(x,{disableGutters:!0,sx:{minHeight:"50px !important",padding:0},children:[e&&n.jsx(b,{edge:"start",color:"inherit","aria-label":"Toggle sidebar",onClick:e,className:"sidebar-toggle-btn touch-target",sx:{mr:2,display:{lg:"none"},minWidth:{xs:48,sm:44},minHeight:{xs:48,sm:44}},"data-id-ref":"responsive-navbar-sidebar-toggle-btn",children:n.jsx(P,{"data-id-ref":"responsive-navbar-sidebar-toggle-icon"})}),n.jsxs(h,{onClick:()=>o("/dashboard/monitoring"),sx:{flexGrow:1,display:"flex",alignItems:"center",gap:2,cursor:"pointer",transition:"opacity 0.2s ease","&:hover":{opacity:.8}},"data-id-ref":"responsive-navbar-brand",children:[n.jsx(Zt,{size:45,animated:!0,"data-id-ref":"responsive-navbar-logo"}),n.jsx(v,{variant:"h6",component:"div",className:"navbar-brand-gradient",sx:{fontWeight:700,background:e=>`linear-gradient(45deg, ${e.palette.common.white}, ${e.palette.primary.light})`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 2px 4px rgba(0,0,0,0.1)",display:{xs:"none",sm:"block"}},"data-id-ref":"responsive-navbar-brand-text",children:t("monitoring")})]}),n.jsxs(h,{sx:{display:"flex",alignItems:"center"},"data-id-ref":"responsive-navbar-user-nav",children:[n.jsxs(b,{onClick:e=>{c(e.currentTarget)},color:"inherit",className:"user-dropdown-toggle touch-target","aria-controls":"user-menu","aria-haspopup":"true","aria-expanded":Boolean(l),sx:{minWidth:{xs:48,sm:44},minHeight:{xs:48,sm:44},paddingX:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-user-dropdown",children:[n.jsx(O,{sx:{mr:1},"data-id-ref":"responsive-navbar-user-icon"}),n.jsx(v,{variant:"body2",component:"span",sx:{display:{xs:"none",sm:"inline"},color:"common.white",fontWeight:500},"data-id-ref":"responsive-navbar-user-dropdown-title",children:(()=>{if("fa"===a){if(r?.firstNameFa&&r?.lastNameFa)return`${r.firstNameFa} ${r.lastNameFa}`;if(r?.firstNameFa)return r.firstNameFa;if(r?.lastNameFa)return r.lastNameFa}return r?.firstName&&r?.lastName?`${r.firstName} ${r.lastName}`:r?.firstName?r.firstName:r?.lastName?r.lastName:r?.userName||""})()})]}),n.jsxs(w,{id:"user-menu",anchorEl:l,open:Boolean(l),onClose:p,className:"user-dropdown",anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{elevation:8,sx:{mt:1.5,minWidth:{xs:180,sm:200},maxWidth:{xs:"calc(100vw - 32px)",sm:"none"}}}},"data-id-ref":"responsive-navbar-user-menu",children:[n.jsxs(S,{onClick:()=>{p(),o("/dashboard/profile")},className:"touch-target",sx:{minHeight:{xs:48,sm:44},px:{xs:2,sm:2},py:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-user-profile-link",children:[n.jsx(L,{sx:{mr:1.5,fontSize:20},"aria-hidden":"true","data-id-ref":"responsive-navbar-user-profile-icon"}),t("profile")]}),n.jsxs(S,{onClick:()=>{p(),o("/dashboard/settings")},className:"touch-target",sx:{minHeight:{xs:48,sm:44},px:{xs:2,sm:2},py:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-user-settings-link",children:[n.jsx(H,{sx:{mr:1.5,fontSize:20},"aria-hidden":"true","data-id-ref":"responsive-navbar-user-settings-icon"}),t("settingsMenu")]}),n.jsx(k,{"data-id-ref":"responsive-navbar-user-divider-1"}),n.jsxs(S,{onClick:()=>{p(),o(`/dashboard/sync?force=true&redirect=${encodeURIComponent(window.location.pathname)}`)},className:"touch-target",sx:{minHeight:{xs:48,sm:44},px:{xs:2,sm:2},py:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-user-force-sync-link",children:[n.jsx(_,{sx:{mr:1.5,fontSize:20},"aria-hidden":"true","data-id-ref":"responsive-navbar-user-force-sync-icon"}),t("forceSync")]}),(r?.roles?.includes("admin")||r?.roles?.includes("Admin"))&&n.jsxs(S,{onClick:async()=>{if(p(),!m){g(!0),ea.info("Push Update clicked",{user:r?.userName,roles:r?.roles});try{const e=await Et({message:`Manual push update triggered by ${r?.userName||"administrator"}`});if(e.success){ea.log("Push update successful - all clients will start background sync",{clientsNotified:e.clientsNotified,timestamp:e.timestamp});const a=e.clientsNotified>0?`${t("pushUpdateSuccess")} (${e.clientsNotified} ${t("pushUpdateClientsNotified")})`:t("pushUpdateSuccessNoClients");u({open:!0,message:a,severity:"success"})}else ea.warn("Push update returned unsuccessful response",{message:e.message}),u({open:!0,message:e.message||t("pushUpdateError")||"Failed to send update notification",severity:"error"})}catch(e){ea.error("Push update failed",{error:e,user:r?.userName}),u({open:!0,message:t("pushUpdateError")||"Failed to send update notification to clients",severity:"error"})}finally{g(!1)}}},className:"touch-target",sx:{minHeight:{xs:48,sm:44},px:{xs:2,sm:2},py:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-user-push-update-link",children:[n.jsx(G,{sx:{mr:1.5,fontSize:20},"aria-hidden":"true","data-id-ref":"responsive-navbar-user-push-update-icon"}),t("pushUpdate")]}),n.jsx(k,{"data-id-ref":"responsive-navbar-user-divider-2"}),n.jsxs(S,{onClick:async()=>{p(),await i(),await new Promise(e=>setTimeout(e,50)),o("/login",{replace:!0})},className:"touch-target",sx:{color:"error.main",minHeight:{xs:48,sm:44},px:{xs:2,sm:2},py:{xs:1.5,sm:1}},"data-id-ref":"responsive-navbar-logout-link",children:[n.jsx(U,{sx:{mr:1.5,fontSize:20},"aria-hidden":"true","data-id-ref":"responsive-navbar-logout-icon"}),t("logout")]})]})]})]})})}),n.jsx(j,{open:d.open,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"bottom",horizontal:"center"},"data-id-ref":"responsive-navbar-push-update-snackbar",children:n.jsx(C,{onClose:A,severity:d.severity,variant:"filled","data-id-ref":"responsive-navbar-push-update-snackbar-alert",children:d.message})})]})},aa=ae(),ra=()=>"Notification"in window,ia=()=>ra()?Notification.permission:(aa.warn("Notification API not supported in this browser"),"denied"),sa=async()=>{if(!ra())return aa.warn("Cannot request notification permission - API not supported"),"denied";try{aa.log("Requesting notification permission...");const e=await Notification.requestPermission();return aa.log("Notification permission result:",e),e}catch(e){return aa.error("Failed to request notification permission:",e),"denied"}},na=()=>"granted"===ia(),oa=e=>{if(!ra())return aa.warn("Cannot show notification - API not supported"),null;if(!na())return aa.warn("Cannot show notification - permission not granted"),null;try{aa.log("Showing alarm notification:",{title:e.title,tag:e.tag});const t=new Notification(e.title,{body:e.body,icon:e.icon||"/icons/alarm-icon.png",tag:e.tag||"alarm-notification",requireInteraction:e.requireInteraction??!1,silent:e.silent??!1,badge:"/icons/badge-icon.png"});return e.requireInteraction||setTimeout(()=>{t.close()},1e4),t.onclick=()=>{aa.log("Notification clicked:",e.tag),window.focus(),t.close()},t.onclose=()=>{aa.log("Notification closed:",e.tag)},t.onerror=e=>{aa.error("Notification error:",e)},t}catch(t){return aa.error("Failed to show notification:",t),null}},la=(e,t,a)=>{const r=a(2===t?"alarms.priority.high":1===t?"alarms.priority.low":"alarms.priority.unknown");return{title:1===e?a("notifications.alarm.single",{priority:r}):a("notifications.alarm.multiple",{count:e,priority:r}),body:1===e?a("notifications.alarm.singleBody"):a("notifications.alarm.multipleBody",{count:e}),tag:"active-alarms",requireInteraction:2===t,silent:!1}},ca=ae(),da={enabled:!1,lastUpdated:Date.now()},ua=e()(t(e=>({preferences:da,setEnabled:t=>{ca.info("Setting notification enabled:",t),e(e=>({preferences:{...e.preferences,enabled:t,lastUpdated:Date.now()}}))},reset:()=>{ca.info("Resetting notification preferences"),e({preferences:da})}}),{name:"notification-preferences",version:1})),ma=ae(),ga=o`
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7);
  }
  50% {
    transform: scale(1.1);
    box-shadow: 0 0 0 6px rgba(211, 47, 47, 0);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(211, 47, 47, 0);
  }
`,pa=({isOpen:e,onToggle:t})=>{const{t:a}=ne(),r=p(),i=Z(),o=J(),{state:l}=Yt(),{alarmCount:c,fetchError:d,isFetching:u,highestPriority:m}=l.activeAlarms,g=A(r.breakpoints.down("lg")),{preferences:f}=ua();s.useEffect(()=>{ma.log("[Sidebar] Theme direction initialized:",{direction:r.direction,language:document.documentElement.lang,documentDir:document.documentElement.dir,isRTL:"rtl"===r.direction})},[r.direction]);const y=s.useRef(c),[x,w]=s.useState(!1),S=s.useRef(null);s.useEffect(()=>{if(y.current<c&&c>0)return S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{w(!0);const e=setTimeout(()=>w(!1),1e3);return()=>clearTimeout(e)},1e3),()=>{S.current&&clearTimeout(S.current)};y.current=c},[c]),s.useEffect(()=>{if(y.current<c&&c>0){const e=na(),t=f.enabled;if(e&&t){const e=la(c,m,a);oa(e)}}},[c,m,a,f.enabled]);const j=[{path:"/dashboard/monitoring",key:"monitoring",icon:n.jsx(z,{})},{path:"/dashboard/active-alarms",key:"activeAlarms",icon:n.jsx(W,{})},{path:"/dashboard/alarm-log",key:"alarmLog",icon:n.jsx(V,{})},{path:"/dashboard/audit-trail",key:"auditTrail",icon:n.jsx(q,{})},{path:"/dashboard/management/users",key:"management",icon:n.jsx(H,{})}],C=e=>{o(e),g&&t()},P=n.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column",backgroundColor:"background.paper"},"data-id-ref":"sidebar-root-container",children:[n.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2.5,py:2,borderBottom:1,borderColor:"divider",minHeight:64},"data-id-ref":"sidebar-header",children:[n.jsx(v,{variant:"h6",component:"div",sx:{fontWeight:700,color:"primary.main",letterSpacing:.5},"data-id-ref":"sidebar-title",children:a("dashboard")}),g&&n.jsx(b,{onClick:t,edge:"end",className:"touch-target","aria-label":a("common.buttons.close"),size:"small","data-id-ref":"sidebar-toggle-close-btn",sx:{minWidth:{xs:48,sm:44},minHeight:{xs:48,sm:44},color:"text.secondary","&:hover":{color:"primary.main"}},children:n.jsx(B,{"data-id-ref":"sidebar-toggle-close-icon"})})]}),n.jsx(k,{"data-id-ref":"sidebar-divider"}),n.jsx(h,{component:"nav",sx:{flex:1,overflowY:"auto",overflowX:"hidden",py:1},"data-id-ref":"sidebar-nav",children:n.jsx(N,{sx:{px:1},"data-id-ref":"sidebar-nav-list",children:j.map(e=>{const t="/dashboard/management/users"===(r=e.path)?i.pathname.startsWith("/dashboard/management"):i.pathname===r;var r;return n.jsx(I,{disablePadding:!0,sx:{mb:.5},"data-id-ref":`sidebar-nav-item-${e.key}`,children:n.jsxs(E,{onClick:()=>C(e.path),selected:t,"data-id-ref":`sidebar-nav-link-${e.key}`,sx:{borderRadius:2,py:1.5,px:2,transition:"all 0.2s ease-in-out","&.Mui-selected":{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}},"&:hover":{backgroundColor:t?"primary.dark":"action.hover"}},children:[n.jsx(T,{"data-id-ref":`sidebar-nav-icon-${e.key}`,sx:{minWidth:40,color:t?"primary.contrastText":"text.secondary",transition:"color 0.2s ease-in-out"},children:"activeAlarms"===e.key?n.jsx(M,{title:d?`${a("common.error")}: ${d}`:u?a("loading"):"",arrow:!0,placement:"right","data-id-ref":"sidebar-active-alarms-tooltip",children:n.jsxs(h,{sx:{position:"relative",display:"inline-flex"},children:[n.jsx(F,{badgeContent:c,invisible:0===c,color:d?"warning":2===m?"error":1===m?"warning":"error",max:999,"data-id-ref":"sidebar-active-alarms-badge",sx:{"& .MuiBadge-badge":{fontSize:"0.65rem",fontWeight:700,minWidth:20,height:20,animation:x?`${ga} 0.6s ease-in-out`:"none",transition:"all 0.3s ease-in-out"}},children:e.icon}),u&&n.jsx(D,{size:20,thickness:4,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-10px",marginLeft:"-10px",color:t?"primary.contrastText":"primary.main"},"data-id-ref":"sidebar-active-alarms-loading"})]})}):e.icon}),n.jsx(R,{primary:a(e.key),"data-id-ref":`sidebar-nav-text-${e.key}`,primaryTypographyProps:{fontWeight:t?600:500,fontSize:"0.9rem",sx:{color:t?"primary.contrastText":"text.primary"}}})]})},e.key)})})})]});return n.jsx($,{variant:g?"temporary":"persistent",anchor:"rtl"===r.direction?"right":"left",open:e,onClose:t,"data-id-ref":"sidebar-drawer",sx:{width:e?280:0,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",border:"none",boxShadow:r.shadows[4],insetInlineStart:0,insetInlineEnd:"auto"}},ModalProps:{keepMounted:!0},children:P})},ha=({isOpen:e,onToggle:t})=>{const{t:a}=ne(),r=p(),i=Z(),s=J(),o=A(r.breakpoints.down("lg")),l=[{path:"/dashboard/management/users",key:"users",icon:n.jsx(K,{})},{path:"/dashboard/management/modbus-controllers",key:"modbusControllers.title",icon:n.jsx(Q,{})},{path:"/dashboard/management/sharp7-controllers",key:"sharp7Controllers.title",icon:n.jsx(X,{})},{path:"/dashboard/management/modbus-gateway",key:"modbusGateway.title",icon:n.jsx(Y,{})}],c=e=>{s(e),o&&t()},d=n.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column",backgroundColor:"background.paper"},"data-id-ref":"management-sidebar-root-container",children:[n.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2.5,py:2,borderBottom:1,borderColor:"divider",minHeight:64},"data-id-ref":"management-sidebar-header",children:[n.jsx(v,{variant:"h6",component:"div",sx:{fontWeight:700,color:"primary.main",letterSpacing:.5},"data-id-ref":"management-sidebar-title",children:a("management")}),o&&n.jsx(b,{onClick:t,edge:"end",className:"touch-target","aria-label":a("common.buttons.close"),size:"small","data-id-ref":"management-sidebar-toggle-close-btn",sx:{minWidth:{xs:48,sm:44},minHeight:{xs:48,sm:44},color:"text.secondary","&:hover":{color:"primary.main"}},children:n.jsx(B,{"data-id-ref":"management-sidebar-toggle-close-icon"})})]}),n.jsx(k,{"data-id-ref":"management-sidebar-divider"}),n.jsx(h,{component:"nav",sx:{flex:1,overflowY:"auto",overflowX:"hidden",py:1},"data-id-ref":"management-sidebar-nav",children:n.jsx(N,{sx:{px:1},"data-id-ref":"management-sidebar-nav-list",children:l.map(e=>{const t=(r=e.path,i.pathname===r);var r;return n.jsx(I,{disablePadding:!0,sx:{mb:.5},"data-id-ref":`management-sidebar-nav-item-${e.key}`,children:n.jsxs(E,{onClick:()=>c(e.path),selected:t,"data-id-ref":`management-sidebar-nav-link-${e.key}`,sx:{borderRadius:2,py:1.5,px:2,transition:"all 0.2s ease-in-out","&.Mui-selected":{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}},"&:hover":{backgroundColor:t?"primary.dark":"action.hover"}},children:[n.jsx(T,{"data-id-ref":`management-sidebar-nav-icon-${e.key}`,sx:{minWidth:40,color:t?"primary.contrastText":"text.secondary",transition:"color 0.2s ease-in-out"},children:e.icon}),n.jsx(R,{primary:a(e.key),"data-id-ref":`management-sidebar-nav-text-${e.key}`,primaryTypographyProps:{fontWeight:t?600:500,fontSize:"0.9rem",sx:{color:t?"primary.contrastText":"text.primary"}}})]})},e.key)})})})]});return n.jsx($,{variant:o?"temporary":"persistent",anchor:"rtl"===r.direction?"right":"left",open:e,onClose:t,"data-id-ref":"management-sidebar-drawer",sx:{width:e?280:0,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",border:"none",boxShadow:r.shadows[4],position:"absolute",insetInlineStart:0,insetInlineEnd:"auto"}},ModalProps:{keepMounted:!0},children:d})},fa=ae();function ya(e){const{state:{groups:t,items:a,isDataSynced:r},fetchGroups:i,fetchItems:n}=Yt(),o=s.useRef(!1),l=s.useRef(!1),c=s.useCallback(async()=>{if(e&&!l.current){if(r&&(t.length>0||a.length>0))return fa.log("Data already synced, skipping fetch:",{groupsCount:t.length,itemsCount:a.length,isDataSynced:r}),void(o.current=!0);l.current=!0;try{await Promise.all([i(),n()]),o.current=!0}catch(s){fa.error("Failed to load global monitoring data:",s)}finally{l.current=!1}}},[e,r,t.length,a.length,i,n]),d=s.useCallback(()=>{o.current=!1,c()},[c]);return s.useEffect(()=>{e&&!o.current?c():e||(o.current=!1)},[e,c]),{refreshData:d,isInitialized:r&&(t.length>0||a.length>0)||o.current&&!0}}const xa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const e=p(),t=Z(),a=A(e.breakpoints.down("lg")),[r,i]=s.useState(!a),{isAuthenticated:o}=He(),l=t.pathname.startsWith("/dashboard/management");ya(o);const c=()=>{i(!r)};return s.useEffect(()=>{i(!a)},[a]),n.jsxs(h,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"background.default"},"data-id-ref":"dashboard-layout-root-container",children:[l?n.jsx(ha,{isOpen:r,onToggle:c}):n.jsx(pa,{isOpen:r,onToggle:c}),n.jsxs(h,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",width:"100%",minHeight:"100vh",overflow:"hidden"},"data-id-ref":"dashboard-layout-main-content-area",children:[n.jsx(ta,{onToggleSidebar:c}),n.jsx(h,{sx:{flexGrow:1,overflow:"auto",backgroundColor:"background.default",height:0,minHeight:0},"data-id-ref":"dashboard-layout-page-content-main",children:n.jsx(ee,{})})]})]})}},Symbol.toStringTag,{value:"Module"}));export{vt as $,qe as A,et as B,Ae as C,Ne as D,Tt as E,Ot as F,zt as G,qt as H,ua as I,ra as J,ia as K,sa as L,la as M,oa as N,Ee as O,Qe as P,Ke as Q,ta as R,Fe as S,kt as T,jt as U,Ct as V,At as W,Nt as X,It as Y,xt as Z,bt as _,ne as a,wt as a0,St as a1,tt as a2,at as a3,rt as a4,it as a5,st as a6,Pt as a7,Bt as a8,Ft as a9,Mt as aa,Dt as ab,Rt as ac,Ht as ad,Lt as ae,_t as af,Gt as ag,Ut as ah,Vt as ai,Wt as aj,Kt as ak,Qt as al,$t as am,Oe as an,xa as ao,Se as b,ae as c,ue as d,Yt as e,$e as f,yt as g,We as h,Ve as i,Je as j,He as k,se as l,Pe as m,Ze as n,ct as o,ot as p,lt as q,Ye as r,ut as s,pt as t,ie as u,Xe as v,dt as w,nt as x,ht as y,ft as z};
