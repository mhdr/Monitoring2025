import{bI as t,bQ as a}from"./vendor-TAwwu7tv.js";import{a as e,e as i,P as s,c as r}from"./layout-C1_h6sDC.js";import{S as n}from"./SeparatedDateTimePicker-Br7Be0Cr.js";import{SyncfusionGridWrapper as d}from"./SyncfusionGridWrapper-je9qfgPl.js";import{f as l,a as o}from"./dateFormatting-Oyh3Sj-d.js";import{u as c,d as m,B as x,a as u,v as f,c as h,q as b,I as g,a7 as p,r as j,a8 as y,x as D,j as v}from"./mui-core-im59jMHH.js";import{W as w,ap as S,ac as C,ad as F,R as k,c as I,ae as H,af as z}from"./mui-icons-v3eeVnKX.js";import{c as M}from"./react-router-B0bL9ISA.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const T=r(),E=()=>{const{t:r,language:E}=e(),$=c(),[W]=M(),N=W.get("itemId"),L=m($.breakpoints.down("md")),{state:R}=i(),B=R.items.find(t=>t.id===N),[G,P]=t.useState(null),[A,q]=t.useState([]),[Q,V]=t.useState(!1),[Y,J]=t.useState("last24Hours"),[K,O]=t.useState(""),[U,X]=t.useState(""),[Z,_]=t.useState(L),tt=t.useRef(null),at=t.useMemo(()=>{const t=Math.floor(Date.now()/1e3);let a,e=t;switch(Y){case"last24Hours":default:a=t-86400;break;case"last7Days":a=t-604800;break;case"last30Days":a=t-2592e3;break;case"custom":K&&U?(a=Math.floor(new Date(K).getTime()/1e3),e=Math.floor(new Date(U).getTime()/1e3)):a=t-86400}return{startDate:a,endDate:e}},[Y,K,U]),et=t.useMemo(()=>{const t=B;return t?"fa"===E&&t.unitFa?t.unitFa:t.unit??"":""},[B,E]),it=async()=>{if(N){P(null),V(!0);try{const{startDate:t,endDate:a}=at;if(t>=a)return P(r("startDateAfterEnd")),void V(!1);const e={itemId:N,startDate:t,endDate:a},i=await s(e);q(i.values||[]),P(null),V(!1)}catch(t){T.error("Error fetching history data:",t),P(r("errorLoadingData")),V(!1)}}else P(r("itemNotFound"))};t.useEffect(()=>{it()},[N,Y]);const st=t.useMemo(()=>[{field:"valueFormatted",headerText:et?`${r("value")} (${et})`:r("value"),width:150,minWidth:120,allowSorting:!0,allowFiltering:!0},{field:"timeFormatted",headerText:r("time"),width:200,minWidth:150,allowSorting:!0,allowFiltering:!0}],[r,et]),rt=t.useMemo(()=>[...A].sort((t,a)=>a.time-t.time).map((t,a)=>{const e=l(t.time,E,"short"),i=o(t.value,E,{minimumFractionDigits:2,maximumFractionDigits:2});return{id:a,time:t.time,timeFormatted:e,value:t.value,valueFormatted:i}}),[A,E]),nt=t=>{J(t),"custom"!==t&&(O(""),X(""))},dt=t=>{const a=new Date(1e3*t);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}T${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return t.useEffect(()=>{if("custom"===Y&&!K&&!U){const{startDate:t,endDate:a}=at;O(dt(t)),X(dt(a))}},[Y,K,U,at]),N?a.jsxs(x,{sx:{height:"100%",display:"flex",flexDirection:"column",p:L?1:3,maxWidth:"100%"},"data-id-ref":"data-table-page-container",children:[G&&a.jsx(h,{severity:"error",onClose:()=>P(null),sx:{mb:3},"data-id-ref":"data-table-error-alert",children:G}),a.jsxs(b,{sx:{mb:3},"data-id-ref":"data-table-date-range-card",children:[a.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,borderBottom:1,borderColor:"divider"},children:[a.jsx(u,{variant:"subtitle1",fontWeight:"bold","data-id-ref":"data-table-date-range-label",children:r("dateRange")}),L&&a.jsx(g,{size:"small",onClick:()=>_(t=>!t),"aria-expanded":!Z,"data-id-ref":"data-table-date-range-toggle-button",children:Z?a.jsx(C,{}):a.jsx(F,{})})]}),a.jsx(p,{in:!L||!Z,children:a.jsx(j,{sx:{p:L?2:3},"data-id-ref":"data-table-date-range-card-body",children:a.jsxs(x,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"flex-end"},gap:2},children:[a.jsxs(y,{variant:"outlined",size:"small",sx:{flexWrap:"wrap"},"data-id-ref":"data-table-preset-button-group",children:[a.jsx(f,{variant:"last24Hours"===Y?"contained":"outlined",onClick:()=>nt("last24Hours"),"data-id-ref":"data-table-preset-24h-button",children:r("last24Hours")}),a.jsx(f,{variant:"last7Days"===Y?"contained":"outlined",onClick:()=>nt("last7Days"),"data-id-ref":"data-table-preset-7d-button",children:r("last7Days")}),a.jsx(f,{variant:"last30Days"===Y?"contained":"outlined",onClick:()=>nt("last30Days"),"data-id-ref":"data-table-preset-30d-button",children:r("last30Days")}),a.jsx(f,{variant:"custom"===Y?"contained":"outlined",onClick:()=>nt("custom"),"data-id-ref":"data-table-preset-custom-button",children:r("customRange")})]}),"custom"===Y&&a.jsxs(a.Fragment,{children:[a.jsx(n,{id:"startDate",value:K,onChange:O,"data-id-ref":"data-table-start-date",className:"",dateLabel:r("startDate"),timeLabel:r("startTime")}),a.jsx(n,{id:"endDate",value:U,onChange:X,"data-id-ref":"data-table-end-date",className:"",dateLabel:r("endDate"),timeLabel:r("endTime")})]}),a.jsx(f,{variant:"contained",color:"success",size:"small",onClick:it,disabled:Q,startIcon:a.jsx(k,{}),sx:{ml:{md:"auto"},minWidth:{xs:"100%",md:"auto"}},"data-id-ref":"data-table-refresh-button",children:r(Q?"fetchingData":"refresh")})]})})})]}),a.jsxs(b,{sx:{flexGrow:1,display:"flex",flexDirection:"column",minHeight:0},"data-id-ref":"data-table-table-card",children:[a.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2,py:L?1:2,borderBottom:1,borderColor:"divider"},"data-id-ref":"data-table-table-card-header",children:[a.jsx(u,{variant:"h6",component:"h5","data-id-ref":"data-table-table-title",children:r("dataTableTitle")}),a.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1},children:A.length>0&&!Q&&a.jsxs(a.Fragment,{children:[a.jsx(D,{label:`${A.length} ${r("dataPoints")}`,color:"secondary",size:"small","data-id-ref":"data-table-data-count"}),!L&&a.jsxs(a.Fragment,{children:[a.jsx(g,{size:"small",color:"primary",onClick:()=>tt.current?.csvExport({fileName:"historical-data.csv"}),"data-id-ref":"data-table-export-csv-button",title:r("export")+" CSV",children:a.jsx(I,{})}),a.jsx(g,{size:"small",color:"success",onClick:()=>tt.current?.excelExport({fileName:"historical-data.xlsx"}),"data-id-ref":"data-table-export-excel-button",title:r("export")+" Excel",children:a.jsx(H,{})})]})]})})]}),a.jsx(j,{sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:0,p:L?1:2},"data-id-ref":"data-table-table-card-body",children:Q?a.jsx(x,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"300px"},"data-id-ref":"data-table-loading-container",children:a.jsx(v,{size:60})}):0===A.length?a.jsxs(x,{sx:{textAlign:"center"},"data-id-ref":"data-table-no-data-container",children:[a.jsx(z,{sx:{fontSize:60,color:"text.disabled",mb:3},"data-id-ref":"data-table-no-data-icon"}),a.jsx(u,{color:"text.secondary","data-id-ref":"data-table-no-data-text",children:r("noData")})]}):a.jsx(x,{sx:{width:"100%",height:"100%",minHeight:L?"300px":"400px"},children:a.jsx(d,{ref:tt,columns:st,data:rt,height:"100%",allowPaging:!0,pageSettings:{pageSize:L?20:50},allowSorting:!0,allowFiltering:!0,allowResizing:!0,allowExcelExport:!0,"data-id-ref":"data-table-grid"})})})]})]}):a.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:400,p:3},"data-id-ref":"data-table-no-item-container",children:a.jsxs(x,{sx:{textAlign:"center"},"data-id-ref":"data-table-no-item-content",children:[a.jsx(w,{sx:{fontSize:80,color:"warning.main",mb:3},"data-id-ref":"data-table-no-item-icon"}),a.jsx(u,{variant:"h5",gutterBottom:!0,"data-id-ref":"data-table-no-item-title",children:r("itemNotFound")}),a.jsx(u,{variant:"body1",color:"text.secondary",sx:{mb:4},"data-id-ref":"data-table-no-item-description",children:"fa"===E?"برای مشاهده جدول داده‌ها، لطفاً از صفحه مانیتورینگ یک پوینت را انتخاب کنید.":"To view data table, please select a monitoring item from the Monitoring page."}),a.jsx(f,{variant:"contained",color:"primary",href:"/dashboard/monitoring",startIcon:a.jsx(S,{}),"data-id-ref":"data-table-no-item-back-button",children:"fa"===E?"بازگشت به مانیتورینگ":"Go to Monitoring"})]})})};export{E as default};
