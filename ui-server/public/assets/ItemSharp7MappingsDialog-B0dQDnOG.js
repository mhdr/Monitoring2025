const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ItemAddEditSharp7MappingDialog-B2cGrTwI.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/i18n-BrX_VL2O.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/api-D5q9v5qU.js","assets/ItemDeleteSharp7MappingDialog-C90liY4E.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./i18n-BrX_VL2O.js";import{bI as a,bQ as t}from"./vendor-TAwwu7tv.js";import{a as i,c as s,a8 as n,F as r}from"./layout-C1_h6sDC.js";import{SyncfusionGridWrapper as l}from"./SyncfusionGridWrapper-je9qfgPl.js";import{D as o,b as p}from"./api-D5q9v5qU.js";import{B as d,h as m,I as c,z as h,E as g,a as u,F as x,c as f,v as j,j as y,O as b}from"./mui-core-im59jMHH.js";import{E as C,G as S,C as w,a8 as T}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./react-router-B0bL9ISA.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const M=s(),I=a.lazy(()=>e(()=>import("./ItemAddEditSharp7MappingDialog-B2cGrTwI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),k=a.lazy(()=>e(()=>import("./ItemDeleteSharp7MappingDialog-C90liY4E.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8]))),D=({open:e,item:s,onClose:D,onMappingsChange:_})=>{const{t:v}=i(),[z,E]=a.useState([]),[N,F]=a.useState([]),[W,$]=a.useState(!1),[A,P]=a.useState(null),[R,B]=a.useState(null),[O,G]=a.useState(!1),[H,L]=a.useState(!1),[V,Q]=a.useState(null),[q,J]=a.useState(!1);a.useEffect(()=>{e&&(async()=>{try{const e=await r();e?.data&&(F(e.data),M.log("Controllers fetched",{count:e.data.length}))}catch(e){M.error("Failed to fetch controllers",{error:e})}})()},[e]);const K=a.useCallback(async()=>{if(s?.id){$(!0),P(null);try{M.log("Fetching mappings for item",{itemId:s.id});const e=await n({itemId:s.id});e?.data&&(E(e.data),M.log("Mappings fetched",{count:e.data.length}),_?.(e.data.length))}catch(e){M.error("Failed to fetch mappings",{error:e}),P(v("itemSharp7Mappings.errors.fetchMappingsFailed"))}finally{$(!1)}}},[s?.id,v,_]);a.useEffect(()=>{e&&s?.id&&K()},[e,s?.id,K]);const U=a.useMemo(()=>{const e=new Map;return z.forEach(a=>{const t=e.get(a.controllerId)||[];t.push(a.position),e.set(a.controllerId,t)}),e},[z]),X=a.useCallback(()=>{Q(null),J(!1),G(!0)},[]),Y=a.useCallback(e=>{Q(e),J(!0),G(!0)},[]),Z=a.useCallback(e=>{Q(e),L(!0)},[]),ee=e=>{G(!1),L(!1),Q(null),J(!1),e&&K()},ae=e=>{B(e),setTimeout(()=>B(null),5e3)},te=a.useCallback(e=>{switch(e){case o.Bit:return v("sharp7Controllers.dataType.bit");case o.Real:return v("sharp7Controllers.dataType.real");case o.Integer:return v("sharp7Controllers.dataType.integer");default:return""}},[v]),ie=a.useCallback(e=>t.jsxs(d,{"data-id-ref":`item-sharp7-mapping-actions-${e.id}`,sx:{display:"flex",gap:.5,py:.5},children:[t.jsx(m,{title:v("common.buttons.edit"),children:t.jsx(c,{"data-id-ref":`item-sharp7-mapping-edit-btn-${e.id}`,size:"small",color:"primary",onClick:()=>Y(e),children:t.jsx(C,{fontSize:"small"})})}),t.jsx(m,{title:v("common.buttons.delete"),children:t.jsx(c,{"data-id-ref":`item-sharp7-mapping-delete-btn-${e.id}`,size:"small",color:"error",onClick:()=>Z(e),children:t.jsx(S,{fontSize:"small"})})})]}),[v,Y,Z]),se=a.useMemo(()=>z.map(e=>({...e,controllerDisplay:`${e.controllerName} (${e.ipAddress} - DB${e.dbAddress})`,dataTypeName:e.dataType?te(e.dataType):"",bitDisplay:null!=e.bit?e.bit.toString():"N/A",operationTypeName:e.operationType===p.Read?v("sharp7Controllers.mappings.read"):v("sharp7Controllers.mappings.write")})),[z,v,te]),ne=a.useMemo(()=>[{field:"controllerDisplay",headerText:v("itemSharp7Mappings.controllerName"),width:200,minWidth:180,allowSorting:!0},{field:"dataTypeName",headerText:v("itemSharp7Mappings.dataType"),width:110,minWidth:100,allowSorting:!0},{field:"position",headerText:v("sharp7Controllers.mappings.position"),width:100,minWidth:80,allowSorting:!0},{field:"bitDisplay",headerText:v("itemSharp7Mappings.bit"),width:80,minWidth:70,allowSorting:!0},{field:"operationTypeName",headerText:v("sharp7Controllers.mappings.operationType"),width:120,minWidth:100,allowSorting:!0},{field:"id",headerText:v("common.actions"),width:120,minWidth:120,allowSorting:!1,allowFiltering:!1,template:ie}],[v,ie]);return t.jsxs(t.Fragment,{children:[t.jsxs(h,{open:e,onClose:D,maxWidth:"md",fullWidth:!0,"data-id-ref":"item-sharp7-mappings-dialog",PaperProps:{sx:{height:{xs:"100%",sm:"70vh"},maxHeight:{xs:"100%",sm:"70vh"}}},children:[t.jsxs(g,{"data-id-ref":"item-sharp7-mappings-dialog-title",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pr:1},children:[t.jsxs(d,{children:[t.jsx(u,{variant:"h6",component:"span",children:v("itemSharp7Mappings.title")}),s&&t.jsxs(u,{variant:"subtitle2",color:"text.secondary",component:"div",children:[s.pointNumber," - ",s.name]})]}),t.jsx(c,{"data-id-ref":"item-sharp7-mappings-close-btn",onClick:D,size:"small",children:t.jsx(w,{})})]}),t.jsxs(x,{"data-id-ref":"item-sharp7-mappings-dialog-content",sx:{display:"flex",flexDirection:"column",p:2},children:[A&&t.jsx(f,{"data-id-ref":"item-sharp7-mappings-error",severity:"error",onClose:()=>P(null),sx:{mb:2},children:A}),R&&t.jsx(f,{"data-id-ref":"item-sharp7-mappings-success",severity:"success",onClose:()=>B(null),sx:{mb:2},children:R}),t.jsx(d,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:t.jsx(j,{"data-id-ref":"item-sharp7-add-mapping-btn",variant:"contained",size:"small",startIcon:t.jsx(T,{}),onClick:X,disabled:0===N.length,children:v("sharp7Controllers.mappings.addMapping")})}),W?t.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(y,{})}):0===z.length?t.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(u,{"data-id-ref":"item-sharp7-no-mappings",color:"text.secondary",children:v("itemSharp7Mappings.noMappings")})}):t.jsx(d,{sx:{flex:1,minHeight:200},children:t.jsx(l,{dataSource:se,columns:ne,height:"100%",allowPaging:!1,allowSorting:!0,allowResizing:!0,"data-id-ref":"item-sharp7-mappings-grid"})})]}),t.jsx(b,{"data-id-ref":"item-sharp7-mappings-dialog-actions",children:t.jsx(j,{"data-id-ref":"item-sharp7-mappings-close-action-btn",onClick:D,children:v("common.buttons.close")})})]}),t.jsx(a.Suspense,{fallback:null,children:O&&s&&t.jsx(I,{open:O,editMode:q,mapping:V,itemId:s.id,itemName:`${s.pointNumber} - ${s.name}`,controllers:N,existingPositionsByController:U,onClose:ee,onSuccess:ae})}),t.jsx(a.Suspense,{fallback:null,children:H&&s&&t.jsx(k,{open:H,mapping:V,onClose:ee,onSuccess:ae})})]})};export{D as default};
