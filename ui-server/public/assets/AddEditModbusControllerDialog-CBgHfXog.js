import{bI as e,bQ as s}from"./vendor-TAwwu7tv.js";import{a as d,c as r,a9 as n,aa as a}from"./layout-C1_h6sDC.js";import{z as t,E as o,F as i,w as l,c as u,aa as c,t as m,J as p,K as b,N as h,b as x,G as f,V as j,O as C,v as y,j as g}from"./mui-core-im59jMHH.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./mui-icons-v3eeVnKX.js";import"./react-router-B0bL9ISA.js";const v=r(),T=({open:r,editMode:T,controller:A,onClose:B,onSuccess:I})=>{const{t:L}=d(),[z,W]=e.useState(!1),[q,D]=e.useState(null),[R,E]=e.useState({name:"",ipAddress:"",port:502,startAddress:0,dataLength:1,dataType:1,endianness:0,connectionType:1,modbusType:0,unitIdentifier:1,addressBase:0,isDisabled:!1}),[S,F]=e.useState({});e.useEffect(()=>{r&&(E(T&&A?{name:A.name||"",ipAddress:A.ipAddress||"",port:A.port||502,startAddress:A.startAddress||0,dataLength:A.dataLength||1,dataType:A.dataType??1,endianness:A.endianness??0,connectionType:A.connectionType??1,modbusType:A.modbusType??0,unitIdentifier:A.unitIdentifier??1,addressBase:A.addressBase??0,isDisabled:A.isDisabled??!1}:{name:"",ipAddress:"",port:502,startAddress:0,dataLength:1,dataType:1,endianness:0,connectionType:1,modbusType:0,unitIdentifier:1,addressBase:0,isDisabled:!1}),F({}),D(null))},[r,T,A]);const k=e=>s=>{const d="number"===s.target.type?""===s.target.value?"":Number(s.target.value):s.target.value;E(s=>({...s,[e]:d})),S[e]&&F(s=>({...s,[e]:void 0}))},w=e=>s=>{E(d=>({...d,[e]:Number(s.target.value)}))},M=()=>{const e={};var s;return R.name.trim()||(e.name=L("modbusControllers.validation.nameRequired")),R.ipAddress.trim()?(s=R.ipAddress.trim(),/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(s)||(e.ipAddress=L("modbusControllers.validation.ipAddressInvalid"))):e.ipAddress=L("modbusControllers.validation.ipAddressRequired"),R.port||0===R.port?(R.port<1||R.port>65535)&&(e.port=L("modbusControllers.validation.portRange")):e.port=L("modbusControllers.validation.portRequired"),void 0===R.startAddress||null===R.startAddress?e.startAddress=L("modbusControllers.validation.startAddressRequired"):R.startAddress<0&&(e.startAddress=L("modbusControllers.validation.startAddressMin")),R.dataLength?R.dataLength<1&&(e.dataLength=L("modbusControllers.validation.dataLengthMin")):e.dataLength=L("modbusControllers.validation.dataLengthRequired"),void 0!==R.dataType&&null!==R.dataType||(e.dataType=L("modbusControllers.validation.dataTypeRequired")),(R.unitIdentifier<0||R.unitIdentifier>247)&&(e.unitIdentifier=L("modbusControllers.validation.unitIdentifierRange")),F(e),0===Object.keys(e).length},P=()=>{B(!1)};return s.jsxs(t,{open:r,onClose:P,maxWidth:"md",fullWidth:!0,"data-id-ref":"add-edit-modbus-controller-dialog",children:[s.jsx(o,{"data-id-ref":"add-edit-modbus-controller-dialog-title",children:L(T?"modbusControllers.dialogs.editTitle":"modbusControllers.dialogs.addTitle")}),s.jsx(i,{"data-id-ref":"add-edit-modbus-controller-dialog-content",children:s.jsxs(l,{spacing:3,sx:{mt:2},children:[q&&s.jsx(u,{"data-id-ref":"add-edit-modbus-controller-error",severity:"error",onClose:()=>D(null),children:q}),s.jsx(c,{container:!0,spacing:2,children:s.jsx(c,{size:12,children:s.jsx(m,{"data-id-ref":"modbus-name-input",label:L("modbusControllers.fields.name"),value:R.name,onChange:k("name"),error:Boolean(S.name),helperText:S.name,required:!0,fullWidth:!0})})}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{size:{xs:12,sm:8},children:s.jsx(m,{"data-id-ref":"modbus-ip-input",label:L("modbusControllers.fields.ipAddress"),value:R.ipAddress,onChange:k("ipAddress"),error:Boolean(S.ipAddress),helperText:S.ipAddress,required:!0,fullWidth:!0,placeholder:"192.168.1.100"})}),s.jsx(c,{size:{xs:12,sm:4},children:s.jsx(m,{"data-id-ref":"modbus-port-input",label:L("modbusControllers.fields.port"),type:"number",value:R.port,onChange:k("port"),error:Boolean(S.port),helperText:S.port,required:!0,fullWidth:!0,inputProps:{min:1,max:65535}})})]}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{size:{xs:12,sm:6},children:s.jsxs(p,{fullWidth:!0,children:[s.jsx(b,{"data-id-ref":"modbus-connection-type-label",children:L("modbusControllers.fields.connectionType")}),s.jsxs(h,{"data-id-ref":"modbus-connection-type-select",value:R.connectionType,onChange:w("connectionType"),label:L("modbusControllers.fields.connectionType"),children:[s.jsx(x,{value:1,children:L("modbusControllers.connectionTypes.tcp")}),s.jsx(x,{value:2,children:L("modbusControllers.connectionTypes.tcpOverRtu")})]})]})}),s.jsx(c,{size:{xs:12,sm:6},children:s.jsxs(p,{fullWidth:!0,children:[s.jsx(b,{"data-id-ref":"modbus-type-label",children:L("modbusControllers.fields.modbusType")}),s.jsxs(h,{"data-id-ref":"modbus-type-select",value:R.modbusType,onChange:w("modbusType"),label:L("modbusControllers.fields.modbusType"),children:[s.jsx(x,{value:0,children:L("modbusControllers.modbusTypes.none")}),s.jsx(x,{value:1,children:L("modbusControllers.modbusTypes.ascii")}),s.jsx(x,{value:2,children:L("modbusControllers.modbusTypes.rtu")})]})]})})]}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{size:{xs:12,sm:6},children:s.jsx(m,{"data-id-ref":"modbus-start-address-input",label:L("modbusControllers.fields.startAddress"),type:"number",value:R.startAddress,onChange:k("startAddress"),error:Boolean(S.startAddress),helperText:S.startAddress,required:!0,fullWidth:!0,inputProps:{min:0}})}),s.jsx(c,{size:{xs:12,sm:6},children:s.jsx(m,{"data-id-ref":"modbus-data-length-input",label:L("modbusControllers.fields.dataLength"),type:"number",value:R.dataLength,onChange:k("dataLength"),error:Boolean(S.dataLength),helperText:S.dataLength,required:!0,fullWidth:!0,inputProps:{min:1}})})]}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{size:{xs:12,sm:6},children:s.jsxs(p,{fullWidth:!0,error:Boolean(S.dataType),children:[s.jsx(b,{"data-id-ref":"modbus-data-type-label",children:L("modbusControllers.fields.dataType")}),s.jsxs(h,{"data-id-ref":"modbus-data-type-select",value:R.dataType,onChange:w("dataType"),label:L("modbusControllers.fields.dataType"),children:[s.jsx(x,{value:1,children:L("modbusControllers.dataTypes.boolean")}),s.jsx(x,{value:2,children:L("modbusControllers.dataTypes.int")}),s.jsx(x,{value:3,children:L("modbusControllers.dataTypes.float")})]})]})}),s.jsx(c,{size:{xs:12,sm:6},children:s.jsxs(p,{fullWidth:!0,children:[s.jsx(b,{"data-id-ref":"modbus-endianness-label",children:L("modbusControllers.fields.endianness")}),s.jsxs(h,{"data-id-ref":"modbus-endianness-select",value:R.endianness,onChange:w("endianness"),label:L("modbusControllers.fields.endianness"),children:[s.jsx(x,{value:0,children:L("modbusControllers.endianness.none")}),s.jsx(x,{value:1,children:L("modbusControllers.endianness.bigEndian")}),s.jsx(x,{value:2,children:L("modbusControllers.endianness.littleEndian")}),s.jsx(x,{value:3,children:L("modbusControllers.endianness.midBigEndian")}),s.jsx(x,{value:4,children:L("modbusControllers.endianness.midLittleEndian")})]})]})})]}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{size:{xs:12,sm:6},children:s.jsx(m,{"data-id-ref":"modbus-unit-identifier-input",label:L("modbusControllers.fields.unitIdentifier"),type:"number",value:R.unitIdentifier,onChange:k("unitIdentifier"),error:Boolean(S.unitIdentifier),helperText:S.unitIdentifier,fullWidth:!0,inputProps:{min:0,max:247}})}),s.jsx(c,{size:{xs:12,sm:6},children:s.jsxs(p,{fullWidth:!0,children:[s.jsx(b,{"data-id-ref":"modbus-address-base-label",children:L("modbusControllers.fields.addressBase")}),s.jsxs(h,{"data-id-ref":"modbus-address-base-select",value:R.addressBase,onChange:w("addressBase"),label:L("modbusControllers.fields.addressBase"),children:[s.jsx(x,{value:0,children:L("modbusControllers.addressBases.base0")}),s.jsx(x,{value:1,children:L("modbusControllers.addressBases.base1")}),s.jsx(x,{value:2,children:L("modbusControllers.addressBases.base40001")}),s.jsx(x,{value:3,children:L("modbusControllers.addressBases.base40000")})]})]})})]}),s.jsx(c,{container:!0,spacing:2,children:s.jsx(c,{size:12,children:s.jsx(f,{"data-id-ref":"modbus-disabled-switch",control:s.jsx(j,{checked:R.isDisabled,onChange:(N="isDisabled",e=>{E(s=>({...s,[N]:e.target.checked}))}),color:"warning"}),label:L("modbusControllers.fields.isDisabled")})})})]})}),s.jsxs(C,{"data-id-ref":"add-edit-modbus-controller-dialog-actions",children:[s.jsx(y,{"data-id-ref":"modbus-cancel-btn",onClick:P,disabled:z,children:L("common.buttons.cancel")}),s.jsx(y,{"data-id-ref":"modbus-save-btn",onClick:async()=>{if(M()){W(!0),D(null);try{if(T&&A){v.log("Editing controller",{controllerId:A.id,name:R.name});const e=await n({id:A.id,name:R.name.trim(),ipAddress:R.ipAddress.trim(),port:R.port,startAddress:R.startAddress,dataLength:R.dataLength,dataType:R.dataType,endianness:R.endianness,connectionType:R.connectionType,modbusType:R.modbusType,unitIdentifier:R.unitIdentifier,addressBase:R.addressBase,isDisabled:R.isDisabled});e.isSuccessful?(v.log("Controller edited successfully",{controllerId:A.id}),I(L("modbusControllers.success.updated")),B(!0)):D(e.errorMessage||L("modbusControllers.errors.updateFailed"))}else{v.log("Creating controller",{name:R.name});const e=await a({name:R.name.trim(),ipAddress:R.ipAddress.trim(),port:R.port,startAddress:R.startAddress,dataLength:R.dataLength,dataType:R.dataType,endianness:R.endianness,connectionType:R.connectionType,modbusType:R.modbusType,unitIdentifier:R.unitIdentifier,addressBase:R.addressBase,isDisabled:R.isDisabled});e.isSuccessful?(v.log("Controller created successfully",{id:e.controllerId}),I(L("modbusControllers.success.created")),B(!0)):D(e.errorMessage||L("modbusControllers.errors.createFailed"))}}catch(e){v.error("Failed to save controller",{error:e}),D(L(T?"modbusControllers.errors.updateFailed":"modbusControllers.errors.createFailed"))}finally{W(!1)}}},variant:"contained",color:"primary",disabled:z,startIcon:z&&s.jsx(g,{size:20}),children:L(z?"common.loading":"common.buttons.save")})]})]});var N};export{T as default};
