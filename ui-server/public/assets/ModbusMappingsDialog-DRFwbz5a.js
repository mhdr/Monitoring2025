const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddEditModbusMappingDialog-X0vbLIZA.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/i18n-BrX_VL2O.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/DeleteModbusMappingDialog-Bg_Xw8a_.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./i18n-BrX_VL2O.js";import{bI as s,bQ as i}from"./vendor-TAwwu7tv.js";import{a as t,c as o,ac as a,i as n}from"./layout-C1_h6sDC.js";import{SyncfusionGridWrapper as l}from"./SyncfusionGridWrapper-je9qfgPl.js";import{b as r}from"./api-D5q9v5qU.js";import{B as d,h as m,I as p,z as c,E as u,a as x,F as g,c as f,v as h,j,O as b}from"./mui-core-im59jMHH.js";import{E as y,G as C,C as S,a8 as w}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./react-router-B0bL9ISA.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const I=o(),k=s.lazy(()=>e(()=>import("./AddEditModbusMappingDialog-X0vbLIZA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),M=s.lazy(()=>e(()=>import("./DeleteModbusMappingDialog-Bg_Xw8a_.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),T=({open:e,controller:o,onClose:T})=>{const{t:_}=t(),[v,z]=s.useState([]),[E,F]=s.useState([]),[W,D]=s.useState(!1),[P,A]=s.useState(null),[N,R]=s.useState(null),[O,$]=s.useState(!1),[G,H]=s.useState(!1),[L,V]=s.useState(null),[B,Q]=s.useState(!1);s.useEffect(()=>{e&&(async()=>{try{const e=await n();if(e?.items){const s=e.items.filter(e=>3===e.interfaceType);F(s),I.log("Modbus items fetched",{count:s.length})}}catch(e){I.error("Failed to fetch items",{error:e})}})()},[e]);const q=s.useCallback(async()=>{if(o?.id){D(!0),A(null);try{I.log("Fetching mappings",{controllerId:o.id});const e=await a({controllerId:o.id});e?.data&&(z(e.data),I.log("Mappings fetched",{count:e.data.length}))}catch(e){I.error("Failed to fetch mappings",{error:e}),A(_("modbusControllers.errors.fetchMappingsFailed"))}finally{D(!1)}}},[o?.id,_]);s.useEffect(()=>{e&&o?.id&&q()},[e,o?.id,q]);const J=s.useCallback(()=>{V(null),Q(!1),$(!0)},[]),K=s.useCallback(e=>{V(e),Q(!0),$(!0)},[]),U=s.useCallback(e=>{V(e),H(!0)},[]),X=e=>{$(!1),H(!1),V(null),Q(!1),e&&q()},Y=e=>{R(e),setTimeout(()=>R(null),5e3)},Z=s.useMemo(()=>v.map(e=>e.position),[v]),ee=s.useCallback(e=>i.jsxs(d,{"data-id-ref":`mapping-actions-${e.id}`,sx:{display:"flex",gap:.5,py:.5},children:[i.jsx(m,{title:_("common.buttons.edit"),children:i.jsx(p,{"data-id-ref":`mapping-edit-btn-${e.id}`,size:"small",color:"primary",onClick:()=>K(e),children:i.jsx(y,{fontSize:"small"})})}),i.jsx(m,{title:_("common.buttons.delete"),children:i.jsx(p,{"data-id-ref":`mapping-delete-btn-${e.id}`,size:"small",color:"error",onClick:()=>U(e),children:i.jsx(C,{fontSize:"small"})})})]}),[_,K,U]),se=s.useMemo(()=>v.map(e=>{const s=E.find(s=>s.id===e.itemId);return{...e,itemName:s?.name||e.itemId||"",operationTypeName:e.operationType===r.Read?_("modbusControllers.mappings.read"):_("modbusControllers.mappings.write")}}),[v,E,_]),ie=s.useMemo(()=>[{field:"position",headerText:_("modbusControllers.mappings.position"),width:100,minWidth:80,allowSorting:!0},{field:"itemName",headerText:_("modbusControllers.mappings.item"),width:200,minWidth:150,allowSorting:!0},{field:"operationTypeName",headerText:_("modbusControllers.mappings.operationType"),width:120,minWidth:100,allowSorting:!0},{field:"id",headerText:_("common.actions"),width:120,minWidth:120,allowSorting:!1,allowFiltering:!1,template:ee}],[_,ee]);return i.jsxs(i.Fragment,{children:[i.jsxs(c,{open:e,onClose:T,maxWidth:"md",fullWidth:!0,"data-id-ref":"modbus-mappings-dialog",PaperProps:{sx:{height:{xs:"100%",sm:"80vh"},maxHeight:{xs:"100%",sm:"80vh"}}},children:[i.jsxs(u,{"data-id-ref":"modbus-mappings-dialog-title",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pr:1},children:[i.jsxs(d,{children:[i.jsx(x,{variant:"h6",component:"span",children:_("modbusControllers.mappings.title")}),o&&i.jsxs(x,{variant:"subtitle2",color:"text.secondary",component:"div",children:[o.name," - ",o.ipAddress,":",o.port]})]}),i.jsx(p,{"data-id-ref":"modbus-mappings-close-btn",onClick:T,size:"small",children:i.jsx(S,{})})]}),i.jsxs(g,{"data-id-ref":"modbus-mappings-dialog-content",sx:{display:"flex",flexDirection:"column",p:2},children:[P&&i.jsx(f,{"data-id-ref":"modbus-mappings-error",severity:"error",onClose:()=>A(null),sx:{mb:2},children:P}),N&&i.jsx(f,{"data-id-ref":"modbus-mappings-success",severity:"success",onClose:()=>R(null),sx:{mb:2},children:N}),i.jsx(d,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsx(h,{"data-id-ref":"modbus-add-mapping-btn",variant:"contained",size:"small",startIcon:i.jsx(w,{}),onClick:J,children:_("modbusControllers.mappings.addMapping")})}),W?i.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:i.jsx(j,{})}):0===v.length?i.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:i.jsx(x,{"data-id-ref":"modbus-no-mappings",color:"text.secondary",children:_("modbusControllers.mappings.noMappings")})}):i.jsx(d,{sx:{flex:1,minHeight:300},children:i.jsx(l,{dataSource:se,columns:ie,height:"100%",allowPaging:!1,allowSorting:!0,allowResizing:!0,"data-id-ref":"modbus-mappings-grid"})})]}),i.jsx(b,{"data-id-ref":"modbus-mappings-dialog-actions",children:i.jsx(h,{"data-id-ref":"modbus-mappings-close-action-btn",onClick:T,children:_("common.buttons.close")})})]}),i.jsx(s.Suspense,{fallback:null,children:O&&o&&i.jsx(k,{open:O,editMode:B,mapping:L,controllerId:o.id,modbusItems:E,existingPositions:Z,onClose:X,onSuccess:Y})}),i.jsx(s.Suspense,{fallback:null,children:G&&o&&i.jsx(M,{open:G,mapping:L,controllerId:o.id,modbusItems:E,onClose:X,onSuccess:Y})})]})};export{T as default};
