import{bI as a,bQ as t}from"./vendor-TAwwu7tv.js";import{a as e,e as s,P as n,c as r}from"./layout-C1_h6sDC.js";import{f as i}from"./dateFormatting-Oyh3Sj-d.js";import{S as o}from"./SeparatedDateTimePicker-Br7Be0Cr.js";import{E as d}from"./EChartsWrapper-CXD6P99r.js";import{C as l}from"./CardHeader-m1cb-2SA.js";import{u as m,d as c,B as f,a as u,v as x,c as h,q as y,I as p,a7 as g,r as j,a8 as v,x as b}from"./mui-core-im59jMHH.js";import{W as D,ap as S,ac as $,ad as M,R as F}from"./mui-icons-v3eeVnKX.js";import{c as w}from"./react-router-B0bL9ISA.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./echarts-DOIPydnp.js";const A=r(),C=()=>{const{t:r,language:C}=e(),I=m(),[T]=w(),k=T.get("itemId"),H=c(I.breakpoints.down("md")),{state:L}=s(),z=L.items.find(a=>a.id===k),N=L.itemsLoading,[E,R]=a.useState(null),[W,G]=a.useState([]),[B,P]=a.useState(!1),[Z,q]=a.useState("last24Hours"),[Q,V]=a.useState(""),[X,Y]=a.useState(""),[J,K]=a.useState(H),O=a.useMemo(()=>{const a=Math.floor(Date.now()/1e3);let t,e=a;switch(Z){case"last24Hours":default:t=a-86400;break;case"last7Days":t=a-604800;break;case"last30Days":t=a-2592e3;break;case"custom":Q&&X?(t=Math.floor(new Date(Q).getTime()/1e3),e=Math.floor(new Date(X).getTime()/1e3)):t=a-86400}return{startDate:t,endDate:e}},[Z,Q,X]),U=a.useMemo(()=>{const{startDate:a,endDate:t}=O,e=i(a,C,"short"),s=i(t,C,"short");return"fa"===C?`${r("from")} ${e} ${r("to")} ${s}`:`${r("from")}: ${e} ${r("to")}: ${s}`},[O,C,r]),_=a.useMemo(()=>z?"fa"===C&&z.nameFa?z.nameFa:z.name:r("itemNotFoundInStore"),[z,N,C,r]),aa=a.useMemo(()=>z?`${r("pointNumber")}: ${z.pointNumber}`:"",[z,r]),ta=a.useMemo(()=>{const a=[];return _&&a.push(_),aa&&a.push(aa),a.push(U),a.join(" — ")},[_,aa,U]),ea=a.useMemo(()=>{const a=z;return a?"fa"===C&&a.unitFa?a.unitFa:a.unit??"":""},[z,C]),sa=async()=>{if(k){R(null),P(!0);try{const{startDate:a,endDate:t}=O;if(a>=t)return R(r("startDateAfterEnd")),void P(!1);const e={itemId:k,startDate:a,endDate:t},s=await n(e);G(s.values||[]),R(null),P(!1)}catch(a){A.error("Error fetching history data:",a),R(r("errorLoadingData")),P(!1)}}else R(r("itemNotFound"))};a.useEffect(()=>{sa()},[k,Z]);const na=a.useMemo(()=>{const a="fa"===C,t=W.map(a=>i(a.time,C,"short")),e=W.map(a=>{const t=parseFloat(a.value||"0");return isNaN(t)?null:t});return{title:H?void 0:{text:ta,left:"center",textStyle:{fontSize:16,fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0}},tooltip:{trigger:"axis",formatter:a=>{if(Array.isArray(a)&&a.length>0){const t=a[0];let e=String(t.value);if("fa"===C){const a=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"];e=e.replace(/\d/g,t=>a[parseInt(t)])}const s=ea?` ${ea}`:"";return`${r("time")}: ${t.axisValue}<br/>${r("value")}: ${e}${s}`}return""},textStyle:{fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0}},grid:{left:H?a?"8%":"4%":a?"15%":"10%",right:H?a?"4%":"8%":a?"10%":"15%",bottom:H?"8%":"15%",top:H?"8%":"15%",containLabel:!0},xAxis:{type:"category",data:t,axisLabel:{rotate:45,fontSize:10,fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0,interval:H?Math.max(0,Math.floor(t.length/Math.max(1,Math.min(6,t.length)))):t.length>50?Math.floor(t.length/20):t.length>20?Math.floor(t.length/10):0}},yAxis:{type:"value",name:ea||void 0,nameLocation:ea?"middle":void 0,nameGap:ea?50:void 0,nameRotate:ea?a?-90:90:void 0,nameTextStyle:{fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0},axisLabel:{fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0}},legend:{show:!1},series:[{name:r("value"),type:"line",data:e,smooth:!0,lineStyle:{color:I.palette.primary.main},itemStyle:{color:I.palette.primary.main},label:{fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0}}],dataZoom:H?void 0:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100,height:30,bottom:10,textStyle:{fontFamily:"fa"===C?"iransansxv, iransansx, Tahoma, Arial, sans-serif":void 0}}],toolbox:H?void 0:{feature:{dataZoom:{yAxisIndex:"none",title:{zoom:r("zoom"),back:r("reset")}},restore:{title:r("reset")},saveAsImage:{title:r("export")}},right:a?"auto":20,left:a?20:"auto"}}},[W,C,r,ea,ta,H,I.palette.primary.main]),ra=a=>{q(a),"custom"!==a&&(V(""),Y(""))},ia=a=>{const t=new Date(1e3*a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return a.useEffect(()=>{if("custom"===Z&&!Q&&!X){const{startDate:a,endDate:t}=O;V(ia(a)),Y(ia(t))}},[Z,Q,X,O]),k?t.jsxs(f,{sx:{height:"100%",display:"flex",flexDirection:"column",p:H?1:3,maxWidth:"100%"},"data-id-ref":"trend-analysis-page-container",children:[E&&t.jsx(h,{severity:"error",onClose:()=>R(null),sx:{mb:3},"data-id-ref":"trend-analysis-error-alert",children:E}),t.jsxs(y,{sx:{mb:3},"data-id-ref":"trend-analysis-date-range-card",children:[t.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,borderBottom:1,borderColor:"divider"},children:[t.jsx(u,{variant:"subtitle1",fontWeight:"bold","data-id-ref":"trend-analysis-date-range-label",children:r("dateRange")}),H&&t.jsx(p,{size:"small",onClick:()=>K(a=>!a),"aria-expanded":!J,"data-id-ref":"trend-analysis-date-range-toggle-button",children:J?t.jsx($,{}):t.jsx(M,{})})]}),t.jsx(g,{in:!H||!J,children:t.jsx(j,{sx:{p:H?2:3},"data-id-ref":"trend-analysis-date-range-card-body",children:t.jsxs(f,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"flex-end"},gap:2},children:[t.jsxs(v,{variant:"outlined",size:"small",sx:{flexWrap:"wrap"},"data-id-ref":"trend-analysis-preset-button-group",children:[t.jsx(x,{variant:"last24Hours"===Z?"contained":"outlined",onClick:()=>ra("last24Hours"),"data-id-ref":"trend-analysis-preset-24h-button",children:r("last24Hours")}),t.jsx(x,{variant:"last7Days"===Z?"contained":"outlined",onClick:()=>ra("last7Days"),"data-id-ref":"trend-analysis-preset-7d-button",children:r("last7Days")}),t.jsx(x,{variant:"last30Days"===Z?"contained":"outlined",onClick:()=>ra("last30Days"),"data-id-ref":"trend-analysis-preset-30d-button",children:r("last30Days")}),t.jsx(x,{variant:"custom"===Z?"contained":"outlined",onClick:()=>ra("custom"),"data-id-ref":"trend-analysis-preset-custom-button",children:r("customRange")})]}),"custom"===Z&&t.jsxs(t.Fragment,{children:[t.jsx(o,{id:"startDate",value:Q,onChange:V,"data-id-ref":"trend-analysis-start-date",className:"",dateLabel:r("startDate"),timeLabel:r("startTime")}),t.jsx(o,{id:"endDate",value:X,onChange:Y,"data-id-ref":"trend-analysis-end-date",className:"",dateLabel:r("endDate"),timeLabel:r("endTime")})]}),t.jsx(x,{variant:"contained",color:"success",size:"small",onClick:sa,disabled:B,startIcon:t.jsx(F,{}),sx:{ml:{md:"auto"},minWidth:{xs:"100%",md:"auto"}},"data-id-ref":"trend-analysis-refresh-button",children:r(B?"fetchingData":"refresh")})]})})})]}),t.jsxs(y,{sx:{flexGrow:1,display:"flex",flexDirection:"column",minHeight:0},"data-id-ref":"trend-analysis-chart-card",children:[t.jsx(l,{title:r("trendAnalysisTitle"),action:W.length>0&&!B?t.jsx(b,{label:`${W.length} ${r("dataPoints")}`,color:"secondary",size:"small","data-id-ref":"trend-analysis-data-count"}):void 0,dataIdRef:"trend-analysis-chart-header"}),t.jsx(j,{sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:0,p:H?1:2},"data-id-ref":"trend-analysis-chart-card-body",children:t.jsx(d,{option:na,loading:B,error:E,emptyMessage:r("noData"),height:"100%",width:"100%",onRetry:sa,dataIdRef:"trend-analysis-chart"})})]})]}):t.jsx(f,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:400,p:3},"data-id-ref":"trend-analysis-no-item-container",children:t.jsxs(f,{sx:{textAlign:"center"},"data-id-ref":"trend-analysis-no-item-content",children:[t.jsx(D,{sx:{fontSize:80,color:"warning.main",mb:3},"data-id-ref":"trend-analysis-no-item-icon"}),t.jsx(u,{variant:"h5",gutterBottom:!0,"data-id-ref":"trend-analysis-no-item-title",children:r("itemNotFound")}),t.jsx(u,{variant:"body1",color:"text.secondary",sx:{mb:4},"data-id-ref":"trend-analysis-no-item-description",children:"fa"===C?"برای مشاهده تحلیل روند، لطفاً از صفحه مانیتورینگ یک پوینت را انتخاب کنید.":"To view trend analysis, please select a monitoring item from the Monitoring page."}),t.jsx(x,{variant:"contained",color:"primary",href:"/dashboard/monitoring",startIcon:t.jsx(S,{}),"data-id-ref":"trend-analysis-no-item-back-button",children:"fa"===C?"بازگشت به مانیتورینگ":"Go to Monitoring"})]})})};export{C as default};
