const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddEditUserDialog-B02VH0KL.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/i18n-BrX_VL2O.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/SyncfusionGridWrapper-je9qfgPl.js","assets/index-uPr0P1lU.js","assets/syncfusion-Czakt5fS.js","assets/css/syncfusion-Db7U--rQ.css","assets/css/index-Do90pmhC.css","assets/css/SyncfusionGridWrapper-BHykEdu7.css","assets/DeleteUserDialog-DYq_satO.js","assets/AssignRolesDialog-CdNH01HZ.js","assets/ResetPasswordDialog-WyzGWt2d.js","assets/ManagePermissionsDialog-DL54L6zc.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./i18n-BrX_VL2O.js";import{bI as s,bQ as a}from"./vendor-TAwwu7tv.js";import{c as t,C as r,a as l,k as i}from"./layout-C1_h6sDC.js";import{SyncfusionGridWrapper as n}from"./SyncfusionGridWrapper-je9qfgPl.js";import{B as o,x as d,I as u,C as c,q as g,_ as m,v as f,a as h,r as p,w as x,t as j,W as y,J as w,K as b,N as S,b as C,c as M,j as _}from"./mui-core-im59jMHH.js";import{E as F,ag as z,ah as k,ai as D,aj as I,Y as v,G as U,a8 as A,ak as P,al as T}from"./mui-icons-v3eeVnKX.js";const E=t();async function R(e){try{E.log("Fetching users with filters:",e);const s=await r.post("/api/Auth/users",e);return E.log("Users fetched successfully:",s.data),s.data}catch(s){throw E.error("Failed to fetch users:",s),s}}async function W(e){try{return E.log("Creating new user:",e.userName),await r.post("/api/Auth/register",e),E.log("User created successfully"),{success:!0}}catch(s){throw E.error("Failed to create user:",s),s}}async function N(e){try{E.log("Editing user:",e.userId);const s=await r.post("/api/Auth/edit-user",e);return E.log("User edited successfully:",s.data),s.data}catch(s){throw E.error("Failed to edit user:",s),s}}async function $(e){try{E.log("Deleting user:",e);const s={userId:e},a=await r.post("/api/Auth/delete-user",s);return E.log("User deleted successfully:",a.data),a.data}catch(s){throw E.error("Failed to delete user:",s),s}}async function O(e,s){try{E.log("Updating user roles:",{userId:e,roles:s});const a={userId:e,roles:s},t=await r.post("/api/Auth/update-user-roles",a);return E.log("User roles updated successfully:",t.data),t.data}catch(a){throw E.error("Failed to update user roles:",a),a}}async function L(e){try{E.log("Resetting user password:",e);const s={userName:e},a=await r.post("/api/Auth/reset-password",s);return E.log("User password reset successfully:",a.data),a.data}catch(s){throw E.error("Failed to reset user password:",s),s}}async function V(e,s){try{E.log("Toggling user status:",{userId:e,disable:s});const a={userId:e,disable:s},t=await r.post("/api/Auth/toggle-user-status",a);return E.log("User status toggled successfully:",t.data),t.data}catch(a){throw E.error("Failed to toggle user status:",a),a}}async function G(){try{E.log("Fetching roles");const e=await r.get("/api/Auth/roles");return E.log("Roles fetched successfully:",e.data),e.data}catch(e){throw E.error("Failed to fetch roles:",e),e}}async function J(e){try{E.log("Fetching user permissions:",e);const s={userId:e},a=await r.post("/api/Monitoring/GetPermissions",s);return E.log("User permissions fetched successfully:",a.data),a.data}catch(s){throw E.error("Failed to fetch user permissions:",s),s}}async function K(e,s){try{E.log("Saving user permissions:",{userId:e,itemCount:s.length});const a={userId:e,itemPermissions:s},t=await r.post("/api/Monitoring/SavePermissions",a);return E.log("User permissions saved successfully:",t.data),t.data}catch(a){throw E.error("Failed to save user permissions:",a),a}}const q=t(),B=s.lazy(()=>e(()=>import("./AddEditUserDialog-B02VH0KL.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),H=s.lazy(()=>e(()=>import("./DeleteUserDialog-DYq_satO.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Q=s.lazy(()=>e(()=>import("./AssignRolesDialog-CdNH01HZ.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Y=s.lazy(()=>e(()=>import("./ResetPasswordDialog-WyzGWt2d.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),X=s.lazy(()=>e(()=>import("./ManagePermissionsDialog-DL54L6zc.js"),__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Z=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:e,language:t}=l(),{user:r}=i(),[E,W]=s.useState([]),[N,$]=s.useState([]),[O,L]=s.useState(!1),[J,K]=s.useState(null),[Z,ee]=s.useState(""),[se,ae]=s.useState(""),te=!0,[re,le]=s.useState(!1),[ie,ne]=s.useState(!1),[oe,de]=s.useState(!1),[ue,ce]=s.useState(!1),[ge,me]=s.useState(!1),[fe,he]=s.useState(null),[pe,xe]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const e=await G();e.success&&e.roles&&($(e.roles),q.log("Roles fetched successfully",{count:e.roles.length}))}catch(e){q.error("Failed to fetch roles",{error:e})}})()},[]);const je=s.useCallback(async()=>{L(!0),K(null);try{q.log("Fetching users",{searchTerm:Z,roleFilter:se,includeDisabled:te});const s=await R({searchTerm:Z||void 0,role:se||void 0,includeDisabled:te,page:1,pageSize:500});s.success&&s.users?(W(s.users),q.log("Users fetched successfully",{count:s.users.length})):K(s.errorMessage||e("userManagement.errors.fetchFailed"))}catch(s){q.error("Failed to fetch users",{error:s}),K(e("userManagement.errors.fetchFailed"))}finally{L(!1)}},[Z,se,te,e]);s.useEffect(()=>{je()},[je]);const ye=s.useCallback(()=>{he(null),xe(!1),le(!0)},[]),we=s.useCallback(e=>{he(e),xe(!0),le(!0)},[]),be=s.useCallback(e=>{he(e),ne(!0)},[]),Se=s.useCallback(e=>{he(e),de(!0)},[]),Ce=s.useCallback(e=>{he(e),ce(!0)},[]),Me=s.useCallback(e=>{he(e),me(!0)},[]),_e=s.useCallback(async s=>{if(s.id)try{q.log("Toggle user status",{userId:s.id,currentStatus:s.isDisabled});const a=!s.isDisabled,t=await V(s.id,a);t.success?(q.log("User status toggled successfully",{userId:s.id,disabled:a}),je()):K(t.message||e("userManagement.errors.toggleStatusFailed"))}catch(a){q.error("Failed to toggle user status",{error:a,userId:s.id}),K(e("userManagement.errors.toggleStatusFailed"))}else q.error("Cannot toggle status: user ID is missing")},[e,je]),Fe=e=>{le(!1),ne(!1),de(!1),ce(!1),me(!1),he(null),xe(!1),e&&je()},ze="fa"===t,ke=s.useCallback(e=>{const s=e,t=s.roles||[];return a.jsx(o,{"data-id-ref":`user-roles-${s.id}`,sx:{display:"flex",gap:.5,flexWrap:"wrap",py:.5},children:t.map(e=>a.jsx(d,{label:e,size:"small",color:"primary",variant:"outlined"},e))})},[]),De=s.useCallback(s=>{const t=s,r=t.isDisabled||!1;return a.jsx(d,{"data-id-ref":`user-status-${t.id}`,label:e(r?"userManagement.disabled":"userManagement.active"),color:r?"error":"success",size:"small"})},[e]),Ie=s.useCallback(s=>{const t=s;if(!t)return null;const l=t.id===r?.id;return a.jsxs(o,{"data-id-ref":`user-actions-${t.id}`,sx:{display:"flex",gap:.5,py:.5},children:[a.jsx(u,{"data-id-ref":`edit-user-btn-${t.id}`,size:"small",color:"primary",onClick:()=>we(t),title:e("userManagement.editUser"),disabled:l,children:a.jsx(F,{fontSize:"small"})}),a.jsx(u,{"data-id-ref":`assign-roles-btn-${t.id}`,size:"small",color:"secondary",onClick:()=>Se(t),title:e("userManagement.assignRoles"),disabled:l,children:a.jsx(z,{fontSize:"small"})}),a.jsx(u,{"data-id-ref":`manage-permissions-btn-${t.id}`,size:"small",color:"info",onClick:()=>Me(t),title:e("permissionsManagement.managePermissions"),disabled:l,children:a.jsx(k,{fontSize:"small"})}),a.jsx(u,{"data-id-ref":`reset-password-btn-${t.id}`,size:"small",color:"warning",onClick:()=>Ce(t),title:e("userManagement.actions.resetPassword"),disabled:l,children:a.jsx(D,{fontSize:"small"})}),a.jsx(u,{"data-id-ref":`toggle-status-btn-${t.id}`,size:"small",color:t.isDisabled?"success":"warning",onClick:()=>_e(t),title:t.isDisabled?e("userManagement.actions.enable"):e("userManagement.actions.disable"),disabled:l,children:t.isDisabled?a.jsx(I,{fontSize:"small"}):a.jsx(v,{fontSize:"small"})}),a.jsx(u,{"data-id-ref":`delete-user-btn-${t.id}`,size:"small",color:"error",onClick:()=>be(t),title:e("userManagement.deleteUser"),disabled:l,children:a.jsx(U,{fontSize:"small"})})]})},[r,e,we,Se,Me,Ce,_e,be]),ve=s.useMemo(()=>[{headerText:e("userManagement.fields.username"),field:"userName",width:150,minWidth:150,allowFiltering:!0,allowSorting:!0},{headerText:e("userManagement.fields.firstName"),field:ze?"firstNameFa":"firstName",width:150,minWidth:150,allowFiltering:!0,allowSorting:!0},{headerText:e("userManagement.fields.lastName"),field:ze?"lastNameFa":"lastName",width:150,minWidth:150,allowFiltering:!0,allowSorting:!0},{headerText:e("userManagement.fields.roles"),field:"roles",width:200,minWidth:200,allowSorting:!0,template:ke},{headerText:e("userManagement.fields.status"),field:"isDisabled",width:120,minWidth:120,allowSorting:!0,template:De},{headerText:e("common.actions"),field:"id",width:320,minWidth:320,allowSorting:!1,allowFiltering:!1,template:Ie}],[e,ze,ke,De,Ie]);return a.jsxs(c,{maxWidth:!1,"data-id-ref":"users-page-container",sx:{height:"100%",width:"100%",py:3,px:{xs:2,sm:3}},children:[a.jsxs(g,{"data-id-ref":"users-page-card",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[a.jsx(m,{"data-id-ref":"users-page-card-header",title:a.jsx(h,{variant:"h4",component:"h1","data-id-ref":"users-page-title",children:e("userManagement.title")}),action:a.jsx(f,{"data-id-ref":"create-user-btn",variant:"contained",color:"primary",startIcon:a.jsx(A,{}),onClick:ye,sx:{minWidth:140},children:e("userManagement.createUser")})}),a.jsxs(p,{"data-id-ref":"users-page-card-body",sx:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:2},children:[a.jsxs(x,{"data-id-ref":"users-filters",direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[a.jsx(j,{"data-id-ref":"search-users-input",placeholder:e("userManagement.filters.searchPlaceholder"),value:Z,onChange:e=>{ee(e.target.value)},size:"small",sx:{flex:1,minWidth:200},InputProps:{startAdornment:a.jsx(y,{position:"start",children:a.jsx(T,{})}),endAdornment:Z&&a.jsx(y,{position:"end",children:a.jsx(u,{"data-id-ref":"clear-search-btn",size:"small",onClick:()=>{ee("")},edge:"end",children:a.jsx(P,{})})})}}),a.jsxs(w,{size:"small",sx:{minWidth:150},children:[a.jsx(b,{"data-id-ref":"role-filter-label",children:e("userManagement.filters.role")}),a.jsxs(S,{"data-id-ref":"role-filter-select",value:se,onChange:e=>{ae(e.target.value)},label:e("userManagement.filters.role"),children:[a.jsx(C,{value:"",children:e("userManagement.filters.allRoles")}),N.map(e=>a.jsx(C,{value:e.name||"",children:e.name},e.id))]})]})]}),J&&a.jsx(M,{"data-id-ref":"users-error-alert",severity:"error",onClose:()=>K(null),sx:{mb:2},children:J}),O&&a.jsx(o,{"data-id-ref":"users-loading",sx:{display:"flex",justifyContent:"center",py:4},children:a.jsx(_,{})}),!O&&a.jsx(o,{"data-id-ref":"users-grid-container",sx:{flex:1,minHeight:400},children:a.jsx(n,{idRef:"users-grid",data:E,columns:ve,height:"100%",allowPaging:!0,pageSettings:{pageSize:50,pageSizes:[25,50,100,200]},allowSorting:!0,allowFiltering:!0,allowResizing:!0})})]})]}),a.jsx(s.Suspense,{fallback:null,children:re&&a.jsx(B,{open:re,editMode:pe,user:fe,onClose:Fe})}),a.jsx(s.Suspense,{fallback:null,children:ie&&a.jsx(H,{open:ie,user:fe,onClose:Fe})}),a.jsx(s.Suspense,{fallback:null,children:oe&&a.jsx(Q,{open:oe,user:fe,roles:N,onClose:Fe})}),a.jsx(s.Suspense,{fallback:null,children:ue&&a.jsx(Y,{open:ue,user:fe,onClose:Fe})}),a.jsx(s.Suspense,{fallback:null,children:ge&&a.jsx(X,{open:ge,user:fe,onClose:Fe})})]})}},Symbol.toStringTag,{value:"Module"}));export{Z as U,W as c,$ as d,N as e,J as g,L as r,K as s,O as u};
