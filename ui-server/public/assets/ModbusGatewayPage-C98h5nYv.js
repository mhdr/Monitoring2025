const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModbusGatewayDialog-CL-20nHG.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/i18n-BrX_VL2O.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/ModbusGatewayMappingsDialog-CE_7kDGO.js","assets/SyncfusionGridWrapper-je9qfgPl.js","assets/index-uPr0P1lU.js","assets/syncfusion-Czakt5fS.js","assets/css/syncfusion-Db7U--rQ.css","assets/css/index-Do90pmhC.css","assets/css/SyncfusionGridWrapper-BHykEdu7.css","assets/api-D5q9v5qU.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./i18n-BrX_VL2O.js";import{bI as a,cJ as t,bQ as s}from"./vendor-TAwwu7tv.js";import{c as l,a as i,G as n,H as d}from"./layout-C1_h6sDC.js";import{s as o}from"./index-uPr0P1lU.js";import{SyncfusionGridWrapper as r}from"./SyncfusionGridWrapper-je9qfgPl.js";import{x as c,B as u,h as m,I as y,C as g,q as f,_ as w,v as h,a as x,r as b,w as p,t as j,W as C,c as S,j as G}from"./mui-core-im59jMHH.js";import{S as k,E as v,G as T,a8 as I,ak as W,al as z}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./react-router-B0bL9ISA.js";import"./syncfusion-Czakt5fS.js";const R=l(),$=()=>{const[e,s]=a.useState({}),[l,i]=a.useState(!1),n=a.useCallback(e=>{R.log("Processing gateway status update",{gatewayId:e.gatewayId,connectedClients:e.connectedClients}),s(a=>({...a,[e.gatewayId]:e}))},[]),d=a.useCallback(a=>e[a],[e]),r=a.useCallback(()=>{s({})},[]);return a.useEffect(()=>{o.onGatewayStatusUpdate(n);const e=()=>{const e=o.getState();i(e===t.Connected)};e();const a=setInterval(e,2e3);return R.log("Subscribed to gateway status updates"),()=>{o.offGatewayStatusUpdate(),clearInterval(a),R.log("Unsubscribed from gateway status updates")}},[n]),{gatewayStatuses:e,isConnected:l,getGatewayStatus:d,clearStatuses:r}},M=l(),F=a.lazy(()=>e(()=>import("./ModbusGatewayDialog-CL-20nHG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),_=a.lazy(()=>e(()=>import("./ModbusGatewayMappingsDialog-CE_7kDGO.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16]))),D=()=>{const{t:e,language:t}=i(),[l,o]=a.useState([]),[R,D]=a.useState(!1),[P,E]=a.useState(null),[A,L]=a.useState(null),[U,B]=a.useState(""),O=a.useRef(null),[V,H]=a.useState(!1),[q,J]=a.useState(!1),[Q,K]=a.useState(null),[N,X]=a.useState(!1),[Y,Z]=a.useState(!1),[ee,ae]=a.useState(null),{gatewayStatuses:te,isConnected:se}=$(),le=a.useMemo(()=>l.map(e=>{const a=te[e.id];return a?{...e,connectedClients:a.connectedClients,lastReadTime:a.lastReadTime,lastWriteTime:a.lastWriteTime}:e}),[l,te]),ie=a.useCallback(async()=>{D(!0),E(null);try{M.log("Fetching Modbus gateways");const a=await n();a?.data?(o(a.data),M.log("Gateways fetched successfully",{count:a.data.length})):E(e("modbusGateway.errors.fetchFailed"))}catch(a){M.error("Failed to fetch gateways",{error:a}),E(e("modbusGateway.errors.fetchFailed"))}finally{D(!1)}},[e]);a.useEffect(()=>{ie()},[ie]);const ne=a.useCallback(()=>{K(null),X(!1),H(!0)},[]),de=a.useCallback(e=>{K(e),X(!0),H(!0)},[]),oe=a.useCallback(e=>{K(e),J(!0)},[]),re=a.useCallback(async()=>{if(Q)try{const a=await d({gatewayId:Q.id});a.isSuccessful?(L(e("modbusGateway.success.deleted")),ie()):E(a.errorMessage||e("modbusGateway.errors.deleteFailed"))}catch(a){M.error("Failed to delete gateway",{error:a}),E(e("modbusGateway.errors.deleteFailed"))}finally{J(!1),K(null)}},[Q,e,ie]),ce=a.useCallback(e=>{ae(e),Z(!0)},[]),ue=a.useCallback(a=>{if(!a)return e("modbusGateway.realtime.neverRead");try{const e=new Date(a),s=(new Date).getTime()-e.getTime(),l=Math.floor(s/1e3),i=Math.floor(l/60),n=Math.floor(i/60),d=Math.floor(n/24);return l<60?"fa"===t?"چند لحظه پیش":"just now":i<60?"fa"===t?`${i} دقیقه پیش`:`${i} min ago`:n<24?"fa"===t?`${n} ساعت پیش`:`${n} hr ago`:"fa"===t?`${d} روز پیش`:`${d} days ago`}catch{return e("modbusGateway.realtime.neverRead")}},[t,e]),me=a.useMemo(()=>{if(!U)return le;const e=U.toLowerCase();return le.filter(a=>a.name?.toLowerCase().includes(e)||a.listenIP?.toLowerCase().includes(e)||String(a.port).includes(e))},[le,U]),ye=a.useCallback(a=>{const t=a,l=t.isEnabled;return s.jsx(c,{"data-id-ref":`gateway-status-chip-${t.id}`,label:e(l?"modbusGateway.status.enabled":"modbusGateway.status.disabled"),color:l?"success":"default",size:"small"})},[e]),ge=a.useCallback(e=>{const a=e,t=a.connectedClients||0;return s.jsx(c,{"data-id-ref":`gateway-clients-chip-${a.id}`,label:t,color:t>0?"primary":"default",size:"small",variant:t>0?"filled":"outlined"})},[]),fe=a.useCallback(a=>{const t=a,l=t.lastReadTime,i=t.lastWriteTime;if(!l&&!i)return s.jsx("span",{children:e("modbusGateway.realtime.neverRead")});const n=[l,i].filter(Boolean).map(e=>new Date(e).getTime()).sort((e,a)=>a-e)[0];return s.jsx("span",{children:ue(new Date(n).toISOString())})},[e,ue]),we=a.useCallback(e=>{const a=e,t=a.coilCount||0;return s.jsx(c,{"data-id-ref":`gateway-coil-count-chip-${a.id}`,label:t,color:t>0?"secondary":"default",size:"small",variant:t>0?"filled":"outlined"})},[]),he=a.useCallback(e=>{const a=e,t=a.discreteInputCount||0;return s.jsx(c,{"data-id-ref":`gateway-di-count-chip-${a.id}`,label:t,color:t>0?"info":"default",size:"small",variant:t>0?"filled":"outlined"})},[]),xe=a.useCallback(e=>{const a=e,t=a.holdingRegisterCount||0;return s.jsx(c,{"data-id-ref":`gateway-hr-count-chip-${a.id}`,label:t,color:t>0?"warning":"default",size:"small",variant:t>0?"filled":"outlined"})},[]),be=a.useCallback(e=>{const a=e,t=a.inputRegisterCount||0;return s.jsx(c,{"data-id-ref":`gateway-ir-count-chip-${a.id}`,label:t,color:t>0?"success":"default",size:"small",variant:t>0?"filled":"outlined"})},[]),pe=a.useCallback(a=>{const t=a;return s.jsxs(u,{"data-id-ref":`gateway-actions-${t.id}`,sx:{display:"flex",gap:.5,py:.5},children:[s.jsx(m,{title:e("modbusGateway.manageMappings"),children:s.jsx(y,{"data-id-ref":`gateway-mappings-btn-${t.id}`,size:"small",color:"info",onClick:()=>ce(t),children:s.jsx(k,{fontSize:"small"})})}),s.jsx(m,{title:e("modbusGateway.editGateway"),children:s.jsx(y,{"data-id-ref":`gateway-edit-btn-${t.id}`,size:"small",color:"primary",onClick:()=>de(t),children:s.jsx(v,{fontSize:"small"})})}),s.jsx(m,{title:e("modbusGateway.deleteGateway"),children:s.jsx(y,{"data-id-ref":`gateway-delete-btn-${t.id}`,size:"small",color:"error",onClick:()=>oe(t),children:s.jsx(T,{fontSize:"small"})})})]})},[e,ce,de,oe]),je=a.useMemo(()=>[{headerText:e("modbusGateway.fields.name"),field:"name",width:150,minWidth:150,allowFiltering:!0,allowSorting:!0},{headerText:e("modbusGateway.fields.listenIP"),field:"listenIP",width:120,minWidth:120,allowFiltering:!0,allowSorting:!0},{headerText:e("modbusGateway.fields.port"),field:"port",width:90,minWidth:90,allowFiltering:!0,allowSorting:!0,type:"number"},{headerText:e("modbusGateway.fields.unitId"),field:"unitId",width:80,minWidth:80,allowSorting:!0,type:"number"},{headerText:e("modbusGateway.fields.status"),field:"isEnabled",width:100,minWidth:100,allowSorting:!0,template:ye},{headerText:e("modbusGateway.fields.connectedClients"),field:"connectedClients",width:110,minWidth:110,allowSorting:!0,type:"number",template:ge},{headerText:e("modbusGateway.fields.lastActivity"),field:"lastReadTime",width:130,minWidth:130,allowSorting:!0,template:fe},{headerText:e("modbusGateway.fields.coilCount"),field:"coilCount",width:100,minWidth:100,allowSorting:!0,type:"number",template:we},{headerText:e("modbusGateway.fields.discreteInputCount"),field:"discreteInputCount",width:100,minWidth:100,allowSorting:!0,type:"number",template:he},{headerText:e("modbusGateway.fields.holdingRegisterCount"),field:"holdingRegisterCount",width:100,minWidth:100,allowSorting:!0,type:"number",template:xe},{headerText:e("modbusGateway.fields.inputRegisterCount"),field:"inputRegisterCount",width:100,minWidth:100,allowSorting:!0,type:"number",template:be},{headerText:e("modbusGateway.fields.mappingCount"),field:"mappingCount",width:100,minWidth:100,allowSorting:!0,type:"number"},{headerText:e("common.actions"),field:"id",width:150,minWidth:150,allowSorting:!1,allowFiltering:!1,template:pe}],[e,ye,ge,fe,we,he,xe,be,pe]);return s.jsxs(g,{maxWidth:!1,"data-id-ref":"modbus-gateway-page-container",sx:{height:"100%",width:"100%",py:3,px:{xs:2,sm:3}},children:[s.jsxs(f,{"data-id-ref":"modbus-gateway-page-card",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[s.jsx(w,{"data-id-ref":"modbus-gateway-page-card-header",title:s.jsxs(u,{children:[s.jsx(x,{variant:"h4",component:"h1","data-id-ref":"modbus-gateway-page-title",children:e("modbusGateway.title")}),s.jsxs(x,{variant:"body2",color:"text.secondary","data-id-ref":"modbus-gateway-page-subtitle",sx:{mt:.5},children:[e("modbusGateway.subtitle"),se&&s.jsx(c,{"data-id-ref":"gateway-realtime-indicator",label:"Live",color:"success",size:"small",sx:{ml:1}})]})]}),action:s.jsx(h,{"data-id-ref":"gateway-add-btn",variant:"contained",color:"primary",startIcon:s.jsx(I,{}),onClick:ne,sx:{minWidth:140},children:e("modbusGateway.addGateway")})}),s.jsxs(b,{"data-id-ref":"modbus-gateway-page-card-body",sx:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:2},children:[s.jsx(p,{"data-id-ref":"gateway-filters",direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:s.jsx(j,{"data-id-ref":"gateway-search-input",placeholder:e("modbusGateway.searchPlaceholder"),value:U,onChange:e=>{B(e.target.value)},size:"small",sx:{flex:1,minWidth:200},InputProps:{startAdornment:s.jsx(C,{position:"start",children:s.jsx(z,{})}),endAdornment:U&&s.jsx(C,{position:"end",children:s.jsx(y,{"data-id-ref":"gateway-clear-search-btn",size:"small",onClick:()=>{B("")},edge:"end",children:s.jsx(W,{})})})}})}),P&&s.jsx(S,{"data-id-ref":"gateway-error-alert",severity:"error",onClose:()=>E(null),sx:{mb:2},children:P}),A&&s.jsx(S,{"data-id-ref":"gateway-success-alert",severity:"success",onClose:()=>L(null),sx:{mb:2},children:A}),R&&s.jsx(u,{"data-id-ref":"gateway-loading",sx:{display:"flex",justifyContent:"center",py:4},children:s.jsx(G,{})}),!R&&0===me.length&&s.jsxs(u,{"data-id-ref":"gateway-empty-state",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,textAlign:"center"},children:[s.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:e("modbusGateway.noGatewaysFound")}),s.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:3},children:e("modbusGateway.addFirstGateway")}),s.jsx(h,{"data-id-ref":"gateway-add-first-btn",variant:"contained",startIcon:s.jsx(I,{}),onClick:ne,children:e("modbusGateway.addGateway")})]}),!R&&me.length>0&&s.jsx(u,{"data-id-ref":"gateway-grid-container",sx:{flex:1,minHeight:400},children:s.jsx(r,{idRef:"modbus-gateways",data:me,columns:je,onGridReady:e=>{O.current=e},height:"100%",allowPaging:!0,pageSettings:{pageSize:25,pageSizes:[10,25,50,100]},allowSorting:!0,allowFiltering:!0,allowResizing:!0})})]})]}),s.jsx(a.Suspense,{fallback:null,children:V&&s.jsx(F,{open:V,editMode:N,gateway:Q,onClose:e=>{H(!1),K(null),X(!1),e&&ie()},onSuccess:e=>L(e)})}),q&&Q&&s.jsx(a.Suspense,{fallback:null,children:s.jsx(u,{"data-id-ref":"gateway-delete-confirm-overlay",sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300},onClick:()=>J(!1),children:s.jsxs(f,{"data-id-ref":"gateway-delete-confirm-dialog",sx:{maxWidth:400,mx:2},onClick:e=>e.stopPropagation(),children:[s.jsx(w,{title:e("modbusGateway.dialogs.deleteTitle")}),s.jsxs(b,{children:[s.jsx(x,{variant:"body1",sx:{mb:2},children:e("modbusGateway.dialogs.deleteMessage",{name:Q.name})}),s.jsx(x,{variant:"body2",color:"error",children:e("modbusGateway.dialogs.deleteWarning")}),s.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:3},children:[s.jsx(h,{"data-id-ref":"gateway-delete-cancel-btn",variant:"outlined",onClick:()=>J(!1),children:e("cancel")}),s.jsx(h,{"data-id-ref":"gateway-delete-confirm-btn",variant:"contained",color:"error",onClick:re,children:e("delete")})]})]})]})})}),s.jsx(a.Suspense,{fallback:null,children:Y&&ee&&s.jsx(_,{open:Y,gateway:ee,onClose:()=>{Z(!1),ae(null)},onSuccess:e=>L(e)})})]})};export{D as default};
