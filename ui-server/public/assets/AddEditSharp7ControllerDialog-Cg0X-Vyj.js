import{bI as e,bQ as a}from"./vendor-TAwwu7tv.js";import{a as r,c as s,ad as d,ae as t}from"./layout-C1_h6sDC.js";import{z as l,E as i,F as o,w as n,c as p,aa as h,t as c,J as u,K as b,N as m,b as x,W as f,I as C,G as j,V as D,O as S,v as g,j as A}from"./mui-core-im59jMHH.js";import{az as v,V as y}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./react-router-B0bL9ISA.js";const z=s(),T=({open:s,editMode:T,controller:w,onClose:q,onSuccess:W})=>{const{t:B}=r(),[I,k]=e.useState(!1),[F,H]=e.useState(null),[M,R]=e.useState(!1),[E,P]=e.useState({name:"",ipAddress:"",dbAddress:0,dbStartData:0,dbSizeData:1,dataType:1,username:"",password:"",isDisabled:!1}),[N,O]=e.useState({});e.useEffect(()=>{s&&(P(T&&w?{name:w.name||"",ipAddress:w.ipAddress||"",dbAddress:w.dbAddress||0,dbStartData:w.dbStartData||0,dbSizeData:w.dbSizeData||1,dataType:w.dataType??1,username:w.username||"",password:"",isDisabled:w.isDisabled??!1}:{name:"",ipAddress:"",dbAddress:0,dbStartData:0,dbSizeData:1,dataType:1,username:"",password:"",isDisabled:!1}),O({}),H(null),R(!1))},[s,T,w]);const V=e=>a=>{const r="number"===a.target.type?""===a.target.value?"":Number(a.target.value):a.target.value;P(a=>({...a,[e]:r})),N[e]&&O(a=>({...a,[e]:void 0}))},G=()=>{const e={};var a;return E.name.trim()||(e.name=B("sharp7Controllers.validation.nameRequired")),E.ipAddress.trim()?(a=E.ipAddress.trim(),/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)||(e.ipAddress=B("sharp7Controllers.validation.ipAddressInvalid"))):e.ipAddress=B("sharp7Controllers.validation.ipAddressRequired"),void 0===E.dbAddress||null===E.dbAddress?e.dbAddress=B("sharp7Controllers.validation.dbAddressRequired"):E.dbAddress<0&&(e.dbAddress=B("sharp7Controllers.validation.dbAddressMin")),void 0===E.dbStartData||null===E.dbStartData?e.dbStartData=B("sharp7Controllers.validation.dbStartDataRequired"):E.dbStartData<0&&(e.dbStartData=B("sharp7Controllers.validation.dbStartDataMin")),E.dbSizeData?E.dbSizeData<1&&(e.dbSizeData=B("sharp7Controllers.validation.dbSizeDataMin")):e.dbSizeData=B("sharp7Controllers.validation.dbSizeDataRequired"),void 0!==E.dataType&&null!==E.dataType||(e.dataType=B("sharp7Controllers.validation.dataTypeRequired")),O(e),0===Object.keys(e).length},J=()=>{q(!1)};return a.jsxs(l,{open:s,onClose:J,maxWidth:"md",fullWidth:!0,"data-id-ref":"add-edit-sharp7-controller-dialog",children:[a.jsx(i,{"data-id-ref":"add-edit-sharp7-controller-dialog-title",children:B(T?"sharp7Controllers.dialogs.editTitle":"sharp7Controllers.dialogs.addTitle")}),a.jsx(o,{"data-id-ref":"add-edit-sharp7-controller-dialog-content",children:a.jsxs(n,{spacing:3,sx:{mt:2},children:[F&&a.jsx(p,{"data-id-ref":"add-edit-sharp7-controller-error",severity:"error",onClose:()=>H(null),children:F}),a.jsx(h,{container:!0,spacing:2,children:a.jsx(h,{size:12,children:a.jsx(c,{"data-id-ref":"sharp7-name-input",label:B("sharp7Controllers.fields.name"),value:E.name,onChange:V("name"),error:Boolean(N.name),helperText:N.name,required:!0,fullWidth:!0})})}),a.jsx(h,{container:!0,spacing:2,children:a.jsx(h,{size:12,children:a.jsx(c,{"data-id-ref":"sharp7-ip-input",label:B("sharp7Controllers.fields.ipAddress"),value:E.ipAddress,onChange:V("ipAddress"),error:Boolean(N.ipAddress),helperText:N.ipAddress,required:!0,fullWidth:!0,placeholder:"192.168.1.100"})})}),a.jsxs(h,{container:!0,spacing:2,children:[a.jsx(h,{size:{xs:12,sm:4},children:a.jsx(c,{"data-id-ref":"sharp7-db-address-input",label:B("sharp7Controllers.fields.dbAddress"),type:"number",value:E.dbAddress,onChange:V("dbAddress"),error:Boolean(N.dbAddress),helperText:N.dbAddress||B("sharp7Controllers.fields.dbAddressHelper"),required:!0,fullWidth:!0,inputProps:{min:0}})}),a.jsx(h,{size:{xs:12,sm:4},children:a.jsx(c,{"data-id-ref":"sharp7-db-start-data-input",label:B("sharp7Controllers.fields.dbStartData"),type:"number",value:E.dbStartData,onChange:V("dbStartData"),error:Boolean(N.dbStartData),helperText:N.dbStartData||B("sharp7Controllers.fields.dbStartDataHelper"),required:!0,fullWidth:!0,inputProps:{min:0}})}),a.jsx(h,{size:{xs:12,sm:4},children:a.jsx(c,{"data-id-ref":"sharp7-db-size-data-input",label:B("sharp7Controllers.fields.dbSizeData"),type:"number",value:E.dbSizeData,onChange:V("dbSizeData"),error:Boolean(N.dbSizeData),helperText:N.dbSizeData||B("sharp7Controllers.fields.dbSizeDataHelper"),required:!0,fullWidth:!0,inputProps:{min:1}})})]}),a.jsx(h,{container:!0,spacing:2,children:a.jsx(h,{size:12,children:a.jsxs(u,{fullWidth:!0,error:Boolean(N.dataType),children:[a.jsx(b,{"data-id-ref":"sharp7-data-type-label",children:B("sharp7Controllers.fields.dataType")}),a.jsxs(m,{"data-id-ref":"sharp7-data-type-select",value:E.dataType,onChange:(K="dataType",e=>{P(a=>({...a,[K]:Number(e.target.value)}))}),label:B("sharp7Controllers.fields.dataType"),children:[a.jsx(x,{value:1,children:B("sharp7Controllers.dataTypes.boolean")}),a.jsx(x,{value:2,children:B("sharp7Controllers.dataTypes.int")}),a.jsx(x,{value:3,children:B("sharp7Controllers.dataTypes.float")})]})]})})}),a.jsxs(h,{container:!0,spacing:2,children:[a.jsx(h,{size:{xs:12,sm:6},children:a.jsx(c,{"data-id-ref":"sharp7-username-input",label:B("sharp7Controllers.fields.username"),value:E.username,onChange:V("username"),error:Boolean(N.username),helperText:N.username||B("sharp7Controllers.fields.usernameHelper"),fullWidth:!0})}),a.jsx(h,{size:{xs:12,sm:6},children:a.jsx(c,{"data-id-ref":"sharp7-password-input",label:B("sharp7Controllers.fields.password"),type:M?"text":"password",value:E.password,onChange:V("password"),error:Boolean(N.password),helperText:N.password||B(T?"sharp7Controllers.fields.passwordHelperEdit":"sharp7Controllers.fields.passwordHelper"),fullWidth:!0,InputProps:{endAdornment:a.jsx(f,{position:"end",children:a.jsx(C,{"data-id-ref":"sharp7-toggle-password-visibility",onClick:()=>{R(e=>!e)},edge:"end",size:"small",children:M?a.jsx(v,{}):a.jsx(y,{})})})}})})]}),a.jsx(h,{container:!0,spacing:2,children:a.jsx(h,{size:12,children:a.jsx(j,{"data-id-ref":"sharp7-disabled-switch",control:a.jsx(D,{checked:E.isDisabled,onChange:(e=>a=>{P(r=>({...r,[e]:a.target.checked}))})("isDisabled"),color:"warning"}),label:B("sharp7Controllers.fields.isDisabled")})})})]})}),a.jsxs(S,{"data-id-ref":"add-edit-sharp7-controller-dialog-actions",children:[a.jsx(g,{"data-id-ref":"sharp7-cancel-btn",onClick:J,disabled:I,children:B("common.buttons.cancel")}),a.jsx(g,{"data-id-ref":"sharp7-save-btn",onClick:async()=>{if(G()){k(!0),H(null);try{if(T&&w){z.log("Editing controller",{controllerId:w.id,name:E.name});const e=await d({id:w.id,name:E.name.trim(),ipAddress:E.ipAddress.trim(),dbAddress:E.dbAddress,dbStartData:E.dbStartData,dbSizeData:E.dbSizeData,dataType:E.dataType,username:E.username.trim()||null,password:E.password||null,isDisabled:E.isDisabled});e.isSuccessful?(z.log("Controller edited successfully",{controllerId:w.id}),W(B("sharp7Controllers.success.updated")),q(!0)):H(e.errorMessage||B("sharp7Controllers.errors.updateFailed"))}else{z.log("Creating controller",{name:E.name});const e=await t({name:E.name.trim(),ipAddress:E.ipAddress.trim(),dbAddress:E.dbAddress,dbStartData:E.dbStartData,dbSizeData:E.dbSizeData,dataType:E.dataType,username:E.username.trim()||null,password:E.password||null,isDisabled:E.isDisabled});e.isSuccessful?(z.log("Controller created successfully",{id:e.controllerId}),W(B("sharp7Controllers.success.created")),q(!0)):H(e.errorMessage||B("sharp7Controllers.errors.createFailed"))}}catch(e){z.error("Failed to save controller",{error:e}),H(B(T?"sharp7Controllers.errors.updateFailed":"sharp7Controllers.errors.createFailed"))}finally{k(!1)}}},variant:"contained",color:"primary",disabled:I,startIcon:I&&a.jsx(A,{size:20}),children:B(I?"common.loading":"common.buttons.save")})]})]});var K};export{T as default};
