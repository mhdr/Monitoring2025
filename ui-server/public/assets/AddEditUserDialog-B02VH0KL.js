import{bI as e,bQ as a}from"./vendor-TAwwu7tv.js";import{a as s,c as r}from"./layout-C1_h6sDC.js";import{e as t,c as i}from"./UsersPage-BulyG3ME.js";import{z as n,E as m,F as o,w as d,c as l,t as u,W as f,I as N,O as c,v as p,j as g}from"./mui-core-im59jMHH.js";import{az as h,V as w}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./react-router-B0bL9ISA.js";import"./SyncfusionGridWrapper-je9qfgPl.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const F=r(),j=({open:r,editMode:j,user:x,onClose:M})=>{const{t:v}=s(),[P,b]=e.useState(!1),[C,y]=e.useState(null),[q,W]=e.useState(!1),[I,B]=e.useState(!1),[R,S]=e.useState({userName:"",firstName:"",lastName:"",firstNameFa:"",lastNameFa:"",password:"",confirmPassword:""}),[T,k]=e.useState({});e.useEffect(()=>{r&&(S(j&&x?{userName:x.userName||"",firstName:x.firstName||"",lastName:x.lastName||"",firstNameFa:x.firstNameFa||"",lastNameFa:x.lastNameFa||"",password:"",confirmPassword:""}:{userName:"",firstName:"",lastName:"",firstNameFa:"",lastNameFa:"",password:"",confirmPassword:""}),k({}),y(null),W(!1),B(!1))},[r,j,x]);const U=e=>a=>{S(s=>({...s,[e]:a.target.value})),T[e]&&k(a=>({...a,[e]:void 0}))},z=()=>{const e={};return R.userName.trim()?R.userName.length<3&&(e.userName=v("userManagement.validation.usernameMinLength")):e.userName=v("userManagement.validation.usernameRequired"),R.firstName.trim()||(e.firstName=v("userManagement.validation.firstNameRequired")),R.lastName.trim()||(e.lastName=v("userManagement.validation.lastNameRequired")),R.firstNameFa.trim()||(e.firstNameFa=v("userManagement.validation.firstNameFaRequired")),R.lastNameFa.trim()||(e.lastNameFa=v("userManagement.validation.lastNameFaRequired")),j||(R.password?R.password.length<6&&(e.password=v("userManagement.validation.passwordMinLength")):e.password=v("userManagement.validation.passwordRequired"),R.confirmPassword?R.password!==R.confirmPassword&&(e.confirmPassword=v("userManagement.validation.passwordsMustMatch")):e.confirmPassword=v("userManagement.validation.confirmPasswordRequired")),k(e),0===Object.keys(e).length},E=()=>{M(!1)};return a.jsxs(n,{open:r,onClose:E,maxWidth:"sm",fullWidth:!0,"data-id-ref":"add-edit-user-dialog",children:[a.jsx(m,{"data-id-ref":"add-edit-user-dialog-title",children:v(j?"userManagement.editUser":"userManagement.createUser")}),a.jsx(o,{"data-id-ref":"add-edit-user-dialog-content",children:a.jsxs(d,{spacing:2,sx:{mt:2},children:[C&&a.jsx(l,{"data-id-ref":"add-edit-user-error",severity:"error",onClose:()=>y(null),children:C}),a.jsx(u,{"data-id-ref":"user-username-input",label:v("userManagement.fields.username"),value:R.userName,onChange:U("userName"),error:Boolean(T.userName),helperText:T.userName||v("userManagement.hints.username"),required:!0,fullWidth:!0,disabled:j,autoComplete:"username"}),a.jsx(u,{"data-id-ref":"user-firstName-input",label:v("userManagement.fields.firstName"),value:R.firstName,onChange:U("firstName"),error:Boolean(T.firstName),helperText:T.firstName||v("userManagement.hints.firstName"),required:!0,fullWidth:!0,autoComplete:"given-name"}),a.jsx(u,{"data-id-ref":"user-lastName-input",label:v("userManagement.fields.lastName"),value:R.lastName,onChange:U("lastName"),error:Boolean(T.lastName),helperText:T.lastName||v("userManagement.hints.lastName"),required:!0,fullWidth:!0,autoComplete:"family-name"}),a.jsx(u,{"data-id-ref":"user-firstNameFa-input",label:v("userManagement.fields.firstNameFa"),value:R.firstNameFa,onChange:U("firstNameFa"),error:Boolean(T.firstNameFa),helperText:T.firstNameFa||v("userManagement.hints.firstNameFa"),required:!0,fullWidth:!0}),a.jsx(u,{"data-id-ref":"user-lastNameFa-input",label:v("userManagement.fields.lastNameFa"),value:R.lastNameFa,onChange:U("lastNameFa"),error:Boolean(T.lastNameFa),helperText:T.lastNameFa||v("userManagement.hints.lastNameFa"),required:!0,fullWidth:!0}),!j&&a.jsxs(a.Fragment,{children:[a.jsx(u,{"data-id-ref":"user-password-input",label:v("userManagement.fields.password"),type:q?"text":"password",value:R.password,onChange:U("password"),error:Boolean(T.password),helperText:T.password||v("userManagement.hints.password"),required:!0,fullWidth:!0,autoComplete:"new-password",InputProps:{endAdornment:a.jsx(f,{position:"end",children:a.jsx(N,{"data-id-ref":"toggle-password-visibility",onClick:()=>{W(e=>!e)},edge:"end","aria-label":v(q?"common.hidePassword":"common.showPassword"),children:q?a.jsx(h,{}):a.jsx(w,{})})})}}),a.jsx(u,{"data-id-ref":"user-confirmPassword-input",label:v("userManagement.fields.confirmPassword"),type:I?"text":"password",value:R.confirmPassword,onChange:U("confirmPassword"),error:Boolean(T.confirmPassword),helperText:T.confirmPassword||v("userManagement.hints.confirmPassword"),required:!0,fullWidth:!0,autoComplete:"new-password",InputProps:{endAdornment:a.jsx(f,{position:"end",children:a.jsx(N,{"data-id-ref":"toggle-confirm-password-visibility",onClick:()=>{B(e=>!e)},edge:"end","aria-label":v(I?"common.hidePassword":"common.showPassword"),children:I?a.jsx(h,{}):a.jsx(w,{})})})}})]})]})}),a.jsxs(c,{"data-id-ref":"add-edit-user-dialog-actions",children:[a.jsx(p,{"data-id-ref":"cancel-user-btn",onClick:E,disabled:P,children:v("common.buttons.cancel")}),a.jsx(p,{"data-id-ref":"save-user-btn",onClick:async()=>{if(z()){b(!0),y(null);try{if(j&&x){F.log("Editing user",{userId:x.id,userName:R.userName});const e=await t({userId:x.id||"",firstName:R.firstName.trim(),lastName:R.lastName.trim(),firstNameFa:R.firstNameFa.trim(),lastNameFa:R.lastNameFa.trim(),userName:R.userName.trim()});e.success?(F.log("User edited successfully",{userId:x.id}),M(!0)):y(e.message||v("userManagement.errors.editFailed"))}else{F.log("Creating user",{userName:R.userName});const e=await i({firstName:R.firstName.trim(),lastName:R.lastName.trim(),firstNameFa:R.firstNameFa.trim(),lastNameFa:R.lastNameFa.trim(),userName:R.userName.trim(),password:R.password,confirmPassword:R.confirmPassword});e.success?(F.log("User created successfully"),M(!0)):y(e.message||v("userManagement.errors.createFailed"))}}catch(e){F.error("Failed to save user",{error:e}),y(v(j?"userManagement.errors.editFailed":"userManagement.errors.createFailed"))}finally{b(!1)}}},variant:"contained",color:"primary",disabled:P,startIcon:P&&a.jsx(g,{size:20}),children:v(P?"common.loading":"common.buttons.save")})]})]})};export{j as default};
