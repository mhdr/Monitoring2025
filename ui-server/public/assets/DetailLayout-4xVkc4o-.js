import{bI as e,bQ as a,bR as t}from"./vendor-TAwwu7tv.js";import{a as i,e as r,c as o,n as s,R as n}from"./layout-C1_h6sDC.js";import{u as l,d,B as c,a as m,I as p,D as u,L as x,e as h,f,g,h as b,i as y,j,k as v,l as k}from"./mui-core-im59jMHH.js";import{C as w,T,o as C,p as I,B as D,N as S,W as M,c as $,q as E}from"./mui-icons-v3eeVnKX.js";import{a as P,u as W,c as z,O as R}from"./react-router-B0bL9ISA.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";const A=o(),B=t`
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7);
  }
  50% {
    transform: scale(1.1);
    box-shadow: 0 0 0 6px rgba(211, 47, 47, 0);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(211, 47, 47, 0);
  }
`,L=({isOpen:t,onToggle:o})=>{const{t:n}=i(),R=l(),L=P(),H=W(),[O]=z(),F=d(R.breakpoints.down("lg")),{state:G}=r(),{alarmCount:q,fetchError:N,isFetching:Q,highestPriority:X}=G.activeAlarms,Y=O.get("itemId"),[J,K]=e.useState(null),U=null!==Y&&null!==J?J:q,V=e.useRef(U),[Z,_]=e.useState(!1),ee=e.useRef(null);e.useEffect(()=>{if(V.current<U&&U>0)return ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{_(!0);const e=setTimeout(()=>_(!1),1e3);return()=>clearTimeout(e)},1e3),()=>{ee.current&&clearTimeout(ee.current)};V.current=U},[U]),e.useEffect(()=>{(async()=>{if(Y)try{A.log("Fetching item-specific alarm count for itemId:",Y);const e=await s({itemIds:[Y]}),a=(e.data?.data||[]).length;A.log("Item-specific alarm count fetched:",{itemId:Y,count:a}),K(a)}catch(e){A.error("Error fetching item-specific alarm count:",e),K(null)}else K(null)})()},[Y]);const ae=e.useMemo(()=>[{path:"/item-detail/trend-analysis",key:"trendAnalysis",icon:a.jsx(T,{})},{path:"/item-detail/data-table",key:"dataTable",icon:a.jsx(C,{})},{path:"/item-detail/live-monitoring",key:"liveMonitoring",icon:a.jsx(I,{})},{path:"/item-detail/statistics",key:"statisticsDetail",icon:a.jsx(D,{})},{path:"/item-detail/alarms",key:"alarmsDetail",icon:a.jsx(S,{})},{path:"/item-detail/active-alarms",key:"activeAlarmsDetail",icon:a.jsx(M,{})},{path:"/item-detail/alarm-log",key:"alarmLogDetail",icon:a.jsx($,{})},{path:"/item-detail/audit-trail",key:"auditTrailDetail",icon:a.jsx(E,{})}].map(e=>({...e,fullPath:Y?`${e.path}?itemId=${Y}`:e.path})),[Y]),te=a.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",backgroundColor:"background.paper"},"data-id-ref":"detail-sidebar-root-container",children:[a.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2.5,py:2,borderBottom:1,borderColor:"divider",minHeight:64},"data-id-ref":"detail-sidebar-header",children:[a.jsx(m,{variant:"h6",component:"div",sx:{fontWeight:700,color:"primary.main",letterSpacing:.5},"data-id-ref":"detail-sidebar-title",children:n("itemDetailTitle")}),F&&a.jsx(p,{onClick:o,edge:"end","aria-label":n("common.buttons.close"),size:"small","data-id-ref":"detail-sidebar-toggle-close-btn",sx:{color:"text.secondary","&:hover":{color:"primary.main"}},children:a.jsx(w,{"data-id-ref":"detail-sidebar-toggle-close-icon"})})]}),a.jsx(u,{"data-id-ref":"detail-sidebar-divider"}),a.jsx(c,{component:"nav",sx:{flex:1,overflowY:"auto",overflowX:"hidden",py:1},"data-id-ref":"detail-sidebar-nav",children:a.jsx(x,{sx:{px:1},"data-id-ref":"detail-sidebar-nav-list",children:ae.map(e=>{const t=(i=e.path,L.pathname===i);var i;return a.jsx(h,{disablePadding:!0,sx:{mb:.5},"data-id-ref":`detail-sidebar-nav-item-${e.key}`,children:a.jsxs(f,{onClick:()=>{return a=e.fullPath,H(a),void(F&&o());var a},selected:t,"data-id-ref":`detail-sidebar-nav-link-${e.key}`,sx:{borderRadius:2,py:1.5,px:2,transition:"all 0.2s ease-in-out","&.Mui-selected":{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}},"&:hover":{backgroundColor:t?"primary.dark":"action.hover"}},children:[a.jsx(g,{"data-id-ref":`detail-sidebar-nav-icon-${e.key}`,sx:{minWidth:40,color:t?"primary.contrastText":"text.secondary",transition:"color 0.2s ease-in-out"},children:"activeAlarmsDetail"===e.key?a.jsx(b,{title:N?`${n("common.error")}: ${N}`:Q?n("loading"):"",arrow:!0,placement:"right","data-id-ref":"detail-sidebar-active-alarms-tooltip",children:a.jsxs(c,{sx:{position:"relative",display:"inline-flex"},children:[a.jsx(y,{badgeContent:U,invisible:0===U,color:N?"warning":2===X?"error":1===X?"warning":"error",max:999,"data-id-ref":"detail-sidebar-active-alarms-badge",sx:{"& .MuiBadge-badge":{fontSize:"0.65rem",fontWeight:700,minWidth:20,height:20,animation:Z?`${B} 0.6s ease-in-out`:"none",transition:"all 0.3s ease-in-out"}},children:e.icon}),Q&&a.jsx(j,{size:20,thickness:4,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-10px",marginLeft:"-10px",color:t?"primary.contrastText":"text.secondary"},"data-id-ref":"detail-sidebar-active-alarms-spinner"})]})}):e.icon}),a.jsx(v,{primary:n(e.key),primaryTypographyProps:{fontWeight:t?600:500,fontSize:"0.9rem",sx:{color:t?"primary.contrastText":"text.primary"}}})]})},e.key)})})})]});return a.jsx(k,{variant:F?"temporary":"persistent",anchor:"left",open:t,onClose:o,"data-id-ref":"detail-sidebar-drawer",sx:{width:t?280:0,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",border:"none",boxShadow:R.shadows[4],left:"0 !important",right:"auto !important",insetInlineStart:0,insetInlineEnd:"auto"}},ModalProps:{keepMounted:!0},children:te})},H=()=>{const t=l(),i=d(t.breakpoints.up("lg")),[r,o]=e.useState(i);e.useEffect(()=>{o(i)},[i]);const s=()=>{o(!r)};return a.jsxs(c,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"background.default"},"data-id-ref":"detail-layout-root-container",children:[a.jsx(L,{isOpen:r,onToggle:s}),a.jsxs(c,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",width:"100%",minHeight:"100vh"},"data-id-ref":"detail-layout-main-content-area",children:[a.jsx(n,{onToggleSidebar:s}),a.jsx(c,{sx:{flexGrow:1,overflow:"auto",backgroundColor:"background.default"},"data-id-ref":"detail-layout-page-content-main",children:a.jsx(R,{})})]})]})};export{H as default};
