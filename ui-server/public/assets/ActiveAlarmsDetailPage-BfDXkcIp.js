import{bI as a,bQ as e,bH as t}from"./vendor-TAwwu7tv.js";import{a as r,e as i,c as l,A as s,m as n,n as o}from"./layout-C1_h6sDC.js";import{u as d}from"./index-uPr0P1lU.js";import{f as c}from"./dateFormatting-Oyh3Sj-d.js";import{V as m}from"./ValueHistoryChart-eybJlHX0.js";import{C as u,B as h,q as f,_ as v,a as x,w as g,v as p,D as y,r as j,j as b,c as A,s as I,x as w,a1 as $,P,a2 as S,a3 as C,a4 as F,a5 as N,a6 as k,h as z,R as D,I as T,y as E,z as W,E as M,F as R,O as L}from"./mui-core-im59jMHH.js";import{R as U,k as V,W as Z,w as X,N as G,a9 as q,T as B,x as H,y as K,z as O,C as Q,aa as _,t as J,ab as Y}from"./mui-icons-v3eeVnKX.js";import{c as aa}from"./react-router-B0bL9ISA.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./syncfusion-Czakt5fS.js";import"./echarts-DOIPydnp.js";const ea=l(),ta=()=>{const[l]=aa(),ta=l.get("itemId"),{language:ra}=r(),{t:ia}=d(),{state:la,updateActiveAlarms:sa}=i(),na=la.activeAlarms,oa="fa"===ra,[da,ca]=a.useState([]),[ma,ua]=a.useState(!0),[ha,fa]=a.useState(null),[va,xa]=a.useState(!1),[ga,pa]=a.useState(null),[ya,ja]=a.useState([]),[ba,Aa]=a.useState([]),[Ia,wa]=a.useState([]),[$a,Pa]=a.useState(new Set),[Sa,Ca]=a.useState(!1),[Fa,Na]=a.useState(new Map),[ka,za]=a.useState(!1),[Da,Ta]=a.useState(null),Ea=a.useRef(null),Wa=a.useMemo(()=>{const a=new Map;return ya.forEach(e=>{const t=oa&&e.nameFa?e.nameFa:e.name;a.set(e.id,t)}),ea.log("Created items lookup map:",{size:a.size}),a},[ya,oa]),Ma=a.useMemo(()=>{const a=new Map;return ba.forEach(e=>{if(e.id){const t=oa&&e.messageFa?e.messageFa:e.message||`${e.alarmType||"Unknown"} Alarm`;a.set(e.id,t)}}),ea.log("Created alarms lookup map:",{size:a.size}),a},[ba,oa]);a.useEffect(()=>{(async()=>{try{ea.log("Loading stored items and alarms from Zustand store...");const[a,e]=await Promise.all([n.getStoredItems(),n.getStoredAlarms()]);a&&Array.isArray(a)?(ja(a),ea.log("Loaded items from Zustand store:",{count:a.length})):(ea.warn("No valid items array found in Zustand store"),ja([]));let t=[];if(e)if(Array.isArray(e))t=e;else if("object"==typeof e&&"data"in e){const a=e;Array.isArray(a.data)&&(t=a.data)}t.length>0?(Aa(t),ea.log("Loaded alarms from Zustand store:",{count:t.length})):(ea.warn("No alarms found in Zustand store"),Aa([]))}catch(a){ea.error("Failed to load stored data from Zustand store:",a),ja([]),Aa([])}})()},[]);const Ra=a.useCallback(async(a,e=!1)=>{try{e&&Ca(!0),ea.log("Fetching instantaneous values for alarmed items...",{isAutoRefresh:e});const t=Array.from(new Set(a.map(a=>a.itemId).filter(a=>null!=a)));if(0===t.length)return ea.warn("No valid itemIds found in alarms"),wa([]),void Ca(!1);ea.log("Fetching values for itemIds:",{count:t.length,itemIds:t});const r=await s({itemIds:t});ea.log("Instantaneous values fetched successfully:",{count:r.values?.length||0,values:r.values});const i=r.values||[],l=new Set;i.forEach(a=>{if(a.itemId&&null!==a.value){const e=Ia.find(e=>e.itemId===a.itemId);e&&e.value!==a.value&&l.add(a.itemId)}}),Pa(l),l.size>0&&setTimeout(()=>{Pa(new Set)},2e3),Na(a=>{const e=new Map(a);return i.forEach(a=>{if(a.itemId&&null!==a.value){const t=parseFloat(a.value);if(!isNaN(t)){const r=e.get(a.itemId)||[];r.push({value:t,time:a.time}),r.length>20&&r.shift(),e.set(a.itemId,r)}}}),e}),wa(i)}catch(t){ea.error("Error fetching instantaneous values:",t),wa([])}finally{Ca(!1)}},[Ia]),La=a.useCallback(async(a=!1)=>{try{a?(xa(!0),ea.log("Refreshing active alarms...")):(ua(!0),ea.log("Fetching active alarms...")),fa(null),ea.log("Retrieving items from Zustand store...");const e=await n.getStoredItems();if(!e||0===e.length)return ea.warn("No items found in Zustand store, cannot fetch active alarms"),fa(ia("activeAlarmsPage.noItemsAvailable")),ca([]),void pa(Date.now());let t;if(ta?(t=[ta],ea.log("Filtering alarms to specific itemId from query string:",ta)):t=e.map(a=>a.id).filter(a=>null!=a),ea.log("Extracted itemIds from stored items:",{totalItems:e.length,itemIdsCount:t.length}),0===t.length)return ea.warn("No valid itemIds found in stored items"),fa(ia("activeAlarmsPage.noItemsAvailable")),ca([]),void pa(Date.now());const r=(await o({itemIds:t})).data.data||[];ea.log("Active alarms fetched successfully:",{count:r.length,alarms:r}),ca(r),pa(Date.now()),ta?ea.log("Skipping global badge update - viewing item-specific alarms",{itemId:ta,itemAlarmCount:r.length}):sa(r.length,Date.now()),r.length>0?Ra(r):wa([])}catch(e){ea.error("Error fetching active alarms:",e),fa(ia("activeAlarmsPage.errorLoadingAlarms"))}finally{ua(!1),xa(!1)}},[ta,ia,Ra,sa]);a.useEffect(()=>(ea.log("⭐⭐⭐ ActiveAlarmsPage MOUNTED ⭐⭐⭐"),La(!1),()=>{ea.log("❌❌❌ ActiveAlarmsPage UNMOUNTING ❌❌❌")}),[]),a.useEffect(()=>{na.lastUpdate&&ga&&na.lastUpdate>ga&&!ma&&!va&&(ea.log("Alarm count changed via stream, refetching active alarms...",{newCount:na.alarmCount,lastUpdate:na.lastUpdate,lastFetch:ga}),La(!0))},[na.lastUpdate,na.alarmCount]);const Ua=()=>{La(!0)},Va=a.useCallback(a=>c(a,ra,"short"),[ra]),Za=a.useMemo(()=>ga?c(ga,ra,"short"):null,[ga,ra]),Xa=a.useCallback(a=>Ia.find(e=>e.itemId===a),[Ia]),Ga=a.useCallback((a,e)=>{if(null==e)return ia("noValue");if(1===a.itemType||2===a.itemType)return"true"===e||"1"===e?oa&&a.onTextFa?a.onTextFa:a.onText||ia("on"):oa&&a.offTextFa?a.offTextFa:a.offText||ia("off");const t=parseFloat(e);if(!isNaN(t)){const e=oa&&a.unitFa?a.unitFa:a.unit||"";return e?`${t} ${e}`:t.toString()}return e},[ia,oa]),qa=a.useCallback((a,e,t)=>{if(!e)return"stable";const r=t.get(a);if(!r||r.length<2)return"stable";const i=parseFloat(e);if(isNaN(i))return"stable";const l=r[r.length-2].value;return i>l?"up":i<l?"down":"stable"},[]),Ba=a.useCallback((a,e,t)=>{if(!e||!t||1===a.itemType||2===a.itemType)return null;const r=parseFloat(t);if(isNaN(r))return null;const i=e.value1?parseFloat(e.value1):null,l=e.value2?parseFloat(e.value2):null,s=oa?a.unitFa:a.unit,n=s?` ${s}`:"";if(3===e.compareType&&null!==i){const a=Math.min(100,Math.max(0,r/i*100));return{percentage:a,color:a>=100?"error":a>=90?"warning":"success",labelKey:"activeAlarmsPage.highLimit",labelValue:`${i}${n}`}}if(4===e.compareType&&null!==i){const a=Math.min(100,Math.max(0,r/i*100));return{percentage:a,color:a<=0?"error":a<=10?"warning":"success",labelKey:"activeAlarmsPage.lowLimit",labelValue:`${i}${n}`}}if(5===e.compareType&&null!==i&&null!==l){const a=Math.abs(l-i),e=Math.min(i,l),t=Math.max(i,l);return{percentage:a>0?(r-e)/a*100:50,color:r<e||r>t?"error":"success",labelKey:"activeAlarmsPage.range",labelValue:`${e} - ${t}${n}`}}return null},[oa]),Ha=a.useCallback(a=>1===a?ia("activeAlarmsPage.priorityWarning"):2===a?ia("activeAlarmsPage.priorityAlarm"):"-",[ia]),Ka=a.useCallback(a=>1===a?"warning":2===a?"error":"default",[]),Oa=a.useCallback(a=>{switch(a){case 1:return ia("activeAlarmsPage.conditionEqual");case 2:return ia("activeAlarmsPage.conditionNotEqual");case 3:return ia("activeAlarmsPage.conditionHigher");case 4:return ia("activeAlarmsPage.conditionLower");case 5:return ia("activeAlarmsPage.conditionBetween");default:return"-"}},[ia]),Qa=a.useCallback(a=>null==a||0===a?ia("activeAlarmsPage.noDelay"):ia("activeAlarmsPage.delaySeconds",{seconds:a}),[ia]),_a=a.useCallback((a,e)=>{if(!a)return"-";const t=a.value1,r=a.value2,i=e?oa?e.unitFa:e.unit:"",l=i?` ${i}`:"";return 5===a.compareType&&t&&r?ia("activeAlarmsPage.thresholdRange",{min:t,max:r})+l:t?ia("activeAlarmsPage.thresholdValue",{value:t})+l:"-"},[ia,oa]);a.useEffect(()=>{if(da.length>0)return ea.log("Starting automatic value refresh interval (5 seconds)"),Ea.current&&window.clearInterval(Ea.current),Ea.current=window.setInterval(()=>{da.length>0&&(ea.log("Auto-refreshing instantaneous values..."),Ra(da,!0))},5e3),()=>{Ea.current&&(ea.log("Clearing value refresh interval"),window.clearInterval(Ea.current),Ea.current=null)};Ea.current&&(ea.log("Clearing value refresh interval (no alarms)"),window.clearInterval(Ea.current),Ea.current=null)},[da,Ra]);const Ja=a=>{const e=ya.find(e=>e.id===a.itemId),t=Fa.get(a.itemId||"");e&&t&&t.length>1?(ea.log(`Opening history modal for item: ${e.name}`,{historyLength:t.length}),Ta({item:e,alarm:a,history:t}),za(!0)):ea.warn("Cannot open history: insufficient data",{hasItem:!!e,historyLength:t?.length||0})};return e.jsxs(u,{maxWidth:!1,sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",py:3,px:{xs:2,sm:3}},"data-id-ref":"active-alarms-page-container",children:[e.jsx(h,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},"data-id-ref":"active-alarms-page-content",children:e.jsxs(f,{sx:{height:"100%",display:"flex",flexDirection:"column"},"data-id-ref":"active-alarms-page-card",children:[e.jsx(v,{title:e.jsx(x,{variant:"h5",component:"h1","data-id-ref":"active-alarms-page-title",children:ia("activeAlarmsPage.title")}),action:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center","data-id-ref":"active-alarms-header-actions",children:[(()=>{let a,t,r;switch(na.streamStatus){case"connected":a=e.jsx(Y,{}),t=ia("activeAlarmsPage.streamConnected"),r="success";break;case"connecting":a=e.jsx(b,{size:16}),t=ia("activeAlarmsPage.streamConnecting"),r="info";break;case"error":a=e.jsx(J,{}),t=ia("activeAlarmsPage.streamError"),r="error";break;default:a=e.jsx(_,{}),t=ia("activeAlarmsPage.streamDisconnected"),r="warning"}return e.jsx(w,{icon:a,label:t,color:r,size:"small",variant:"outlined","data-id-ref":"active-alarms-stream-status-chip"})})(),e.jsx(p,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:Ua,disabled:ma||va,size:"small","data-id-ref":"active-alarms-refresh-button",children:ia(va?"activeAlarmsPage.refreshing":"refresh")})]}),subheader:Za?e.jsx(x,{variant:"caption",color:"text.secondary","data-id-ref":"active-alarms-last-updated",children:`${ia("activeAlarmsPage.lastUpdated")}: ${Za}`}):null,"data-id-ref":"active-alarms-page-header"}),e.jsx(y,{}),e.jsxs(j,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"auto"},"data-id-ref":"active-alarms-page-body",children:[ma&&e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8},"data-id-ref":"active-alarms-loading-state",children:[e.jsx(b,{size:48,sx:{mb:2},"data-id-ref":"active-alarms-loading-spinner"}),e.jsx(x,{variant:"body1",color:"text.secondary","data-id-ref":"active-alarms-loading-text",children:ia("activeAlarmsPage.loadingAlarms")})]}),!ma&&ha&&e.jsxs(A,{severity:"error",action:e.jsx(p,{color:"inherit",size:"small",onClick:Ua,"data-id-ref":"active-alarms-error-retry",children:ia("activeAlarmsPage.retryLoading")}),"data-id-ref":"active-alarms-error-alert",children:[e.jsx(I,{"data-id-ref":"active-alarms-error-title",children:ia("activeAlarmsPage.errorLoadingAlarms")}),ha]}),!ma&&!ha&&0===da.length&&e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8},"data-id-ref":"active-alarms-empty-state",children:[e.jsx(V,{sx:{fontSize:64,color:"success.main",mb:2},"data-id-ref":"active-alarms-empty-icon"}),e.jsx(x,{variant:"h6",gutterBottom:!0,"data-id-ref":"active-alarms-empty-title",children:ia("activeAlarmsPage.noActiveAlarms")}),e.jsx(x,{variant:"body2",color:"text.secondary","data-id-ref":"active-alarms-empty-description",children:ia("activeAlarmsPage.noActiveAlarmsDescription")})]}),!ma&&!ha&&da.length>0&&e.jsxs(h,{sx:{flexGrow:1},"data-id-ref":"active-alarms-content-container",children:[e.jsx(h,{sx:{mb:2},"data-id-ref":"active-alarms-count-container",children:e.jsx(w,{icon:e.jsx(Z,{"data-id-ref":"active-alarms-count-icon"}),label:`${da.length} ${ia("activeAlarmsPage.alarmCount")}`,color:"error","data-id-ref":"active-alarms-count-chip"})}),e.jsx($,{component:P,variant:"outlined","data-id-ref":"active-alarms-table-wrapper",children:e.jsxs(S,{size:"small","data-id-ref":"active-alarms-table",children:[e.jsx(C,{"data-id-ref":"active-alarms-table-head",children:e.jsxs(F,{children:[e.jsx(N,{"data-id-ref":"active-alarms-table-header-item-name",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.itemName")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-alarm-message",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.alarmMessage")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-priority",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.priority")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-condition",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.condition")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-threshold",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.threshold")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-delay",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.delay")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-external-alarm",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.externalAlarm")})}),e.jsx(N,{"data-id-ref":"active-alarms-table-header-triggered-at",children:e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:ia("activeAlarmsPage.triggeredAt")})})]})}),e.jsx(k,{"data-id-ref":"active-alarms-table-body",children:da.map((a,r)=>{const i=a.alarmId?Ma.get(a.alarmId)||a.alarmId:"-",l=a.itemId?Wa.get(a.itemId)||a.itemId:"-",s=ya.find(e=>e.id===a.itemId),n=a.itemId?Xa(a.itemId):null,o=ba.find(e=>e.id===a.alarmId);return e.jsxs(t.Fragment,{children:[e.jsxs(F,{hover:!0,"data-id-ref":`active-alarm-row-${r}`,children:[e.jsx(N,{"data-id-ref":`active-alarm-item-name-${r}`,children:e.jsx(x,{variant:"body2",children:l})}),e.jsx(N,{"data-id-ref":`active-alarm-message-${r}`,children:e.jsx(x,{variant:"body2",children:i})}),e.jsx(N,{"data-id-ref":`active-alarm-priority-${r}`,children:e.jsx(w,{label:Ha(o?.alarmPriority),color:Ka(o?.alarmPriority),size:"small",sx:{minWidth:80},"data-id-ref":`active-alarm-priority-chip-${r}`})}),e.jsx(N,{"data-id-ref":`active-alarm-condition-${r}`,children:e.jsx(x,{variant:"body2",children:Oa(o?.compareType)})}),e.jsx(N,{"data-id-ref":`active-alarm-threshold-${r}`,children:e.jsx(x,{variant:"body2",sx:{fontFamily:oa?"IRANSansX, sans-serif":"monospace"},children:_a(o,s)})}),e.jsx(N,{"data-id-ref":`active-alarm-delay-${r}`,children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},"data-id-ref":`active-alarm-delay-box-${r}`,children:[o?.alarmDelay&&o.alarmDelay>0&&e.jsx(X,{sx:{fontSize:16,color:"text.secondary"},"data-id-ref":`active-alarm-delay-icon-${r}`}),e.jsx(x,{variant:"body2",sx:{fontFamily:oa?"IRANSansX, sans-serif":void 0},"data-id-ref":`active-alarm-delay-text-${r}`,children:Qa(o?.alarmDelay)})]})}),e.jsx(N,{"data-id-ref":`active-alarm-external-${r}`,children:e.jsx(z,{title:ia(o?.hasExternalAlarm?"activeAlarmsPage.externalAlarmEnabled":"activeAlarmsPage.externalAlarmDisabled"),arrow:!0,children:o?.hasExternalAlarm?e.jsx(G,{sx:{fontSize:20,color:"warning.main"},"data-id-ref":`active-alarm-external-icon-active-${r}`}):e.jsx(q,{sx:{fontSize:20,color:"text.disabled"},"data-id-ref":`active-alarm-external-icon-inactive-${r}`})})}),e.jsx(N,{"data-id-ref":`active-alarm-time-${r}`,children:e.jsx(x,{variant:"body2",sx:{fontFamily:oa?"IRANSansX, sans-serif":void 0},children:Va(a.time)})})]}),s&&n&&e.jsx(F,{"data-id-ref":`active-alarm-values-row-${r}`,children:e.jsx(N,{colSpan:8,sx:{bgcolor:"action.hover",borderBottom:r<da.length-1?1:0,borderColor:"divider"},"data-id-ref":`active-alarm-values-cell-${r}`,children:e.jsxs(h,{sx:{py:1,px:1,display:"flex",flexDirection:"column",gap:1},"data-id-ref":`active-alarm-values-container-${r}`,children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},"data-id-ref":`active-alarm-values-header-${r}`,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:"text.secondary"},"data-id-ref":`active-alarm-values-label-${r}`,children:[ia("activeAlarmsPage.instantaneousDataTitle"),":"]}),Sa&&e.jsx(b,{size:12,thickness:4,"data-id-ref":`active-alarm-values-spinner-${r}`})]}),e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},"data-id-ref":`active-alarm-values-details-${r}`,children:[e.jsxs(h,{sx:{display:"flex",gap:.5,alignItems:"center"},"data-id-ref":`active-alarm-point-number-box-${r}`,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:"text.primary"},"data-id-ref":`active-alarm-point-number-label-${r}`,children:[ia("pointNumber"),":"]}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontFamily:oa?"IRANSansX, sans-serif":void 0},"data-id-ref":`active-alarm-point-number-value-${r}`,children:s.pointNumber})]}),e.jsxs(h,{sx:{display:"flex",gap:.5,alignItems:"center"},"data-id-ref":`active-alarm-value-box-${r}`,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:"text.primary"},"data-id-ref":`active-alarm-value-label-${r}`,children:[ia("value"),":"]}),e.jsx(D,{in:!0,timeout:$a.has(a.itemId||"")?500:0,children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},"data-id-ref":`active-alarm-value-content-${r}`,children:[e.jsx(x,{variant:"caption",sx:{color:$a.has(a.itemId||"")?"warning.main":"primary.main",fontWeight:600,transition:"color 0.3s ease-in-out",fontFamily:oa?"IRANSansX, sans-serif":void 0},"data-id-ref":`active-alarm-value-text-${r}`,children:Ga(s,n.value)}),(()=>{const t=qa(a.itemId||"",n.value,Fa);return"up"===t?e.jsx(z,{title:ia("activeAlarmsPage.trendIncreasing"),arrow:!0,children:e.jsx(B,{sx:{fontSize:14,color:"error.main"},"data-id-ref":`active-alarm-trend-up-icon-${r}`})}):"down"===t?e.jsx(z,{title:ia("activeAlarmsPage.trendDecreasing"),arrow:!0,children:e.jsx(H,{sx:{fontSize:14,color:"success.main"},"data-id-ref":`active-alarm-trend-down-icon-${r}`})}):Fa.get(a.itemId||"")?.length&&Fa.get(a.itemId||"").length>=2?e.jsx(z,{title:ia("activeAlarmsPage.trendStable"),arrow:!0,children:e.jsx(K,{sx:{fontSize:14,color:"text.disabled"},"data-id-ref":`active-alarm-trend-flat-icon-${r}`})}):null})(),Fa.get(a.itemId||"")?.length&&Fa.get(a.itemId||"").length>1&&e.jsx(z,{title:ia("activeAlarmsPage.viewHistory"),arrow:!0,children:e.jsx(T,{size:"small",sx:{p:0,ml:.5},onClick:()=>Ja(a),"data-id-ref":`value-history-icon-${r}`,children:e.jsx(O,{sx:{fontSize:14,color:"info.main"},"data-id-ref":`value-history-timeline-icon-${r}`})})})]})})]}),e.jsxs(h,{sx:{display:"flex",gap:.5,alignItems:"center"},"data-id-ref":`active-alarm-time-box-${r}`,children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:"text.primary"},"data-id-ref":`active-alarm-time-label-${r}`,children:[ia("time"),":"]}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontFamily:oa?"IRANSansX, sans-serif":void 0},"data-id-ref":`active-alarm-time-value-${r}`,children:Va(n.time)})]})]}),(()=>{const t=ba.find(e=>e.id===a.alarmId),i=Ba(s,t,n.value);if(i){const a=`${ia(i.labelKey)}: ${i.labelValue}`;return e.jsx(h,{sx:{mt:.5},"data-id-ref":`active-alarm-threshold-viz-${r}`,children:e.jsx(z,{title:a,arrow:!0,placement:"top",children:e.jsxs(h,{"data-id-ref":`active-alarm-threshold-viz-content-${r}`,children:[e.jsx(E,{variant:"determinate",value:i.percentage,color:i.color,sx:{height:6,borderRadius:1,bgcolor:"action.selected"},"data-id-ref":`active-alarm-threshold-progress-${r}`}),e.jsx(x,{variant:"caption",sx:{fontSize:"0.65rem",color:"text.disabled",mt:.5,display:"block"},"data-id-ref":`active-alarm-threshold-label-${r}`,children:a})]})})})}return null})()]})})})]},a.id||`alarm-${r}`)})})]})})]})]})]})}),e.jsxs(W,{open:ka,onClose:()=>za(!1),maxWidth:"md",fullWidth:!0,"data-id-ref":"value-history-modal",children:[e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},"data-id-ref":"value-history-modal-title",children:[Da&&ia("activeAlarmsPage.historyModalTitle",{itemName:oa&&Da.item.nameFa?Da.item.nameFa:Da.item.name}),e.jsx(T,{edge:"end",color:"inherit",onClick:()=>za(!1),"aria-label":"close","data-id-ref":"value-history-modal-close-button",children:e.jsx(Q,{"data-id-ref":"value-history-modal-close-icon"})})]}),e.jsx(R,{dividers:!0,"data-id-ref":"value-history-modal-content",children:Da&&e.jsx(h,{sx:{height:500,width:"100%"},"data-id-ref":"value-history-chart-container",children:e.jsx(m,{history:Da.history,item:Da.item,itemName:oa&&Da.item.nameFa?Da.item.nameFa:Da.item.name,height:"100%",width:"100%"})})}),e.jsx(L,{"data-id-ref":"value-history-modal-actions",children:e.jsx(p,{onClick:()=>za(!1),color:"primary",variant:"contained","data-id-ref":"value-history-modal-close-action",children:ia("common.buttons.close")})})]})]})};export{ta as default};
