import{bI as e,bQ as s}from"./vendor-TAwwu7tv.js";import{a,c as r}from"./layout-C1_h6sDC.js";import{u as o}from"./UsersPage-BulyG3ME.js";import{z as n,E as i,B as l,a as t,F as d,c,ab as u,G as m,H as g,O as f,v as j,j as x}from"./mui-core-im59jMHH.js";import{ag as p}from"./mui-icons-v3eeVnKX.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./react-router-B0bL9ISA.js";import"./SyncfusionGridWrapper-je9qfgPl.js";import"./index-uPr0P1lU.js";import"./syncfusion-Czakt5fS.js";const h=r(),b=({open:r,user:b,roles:y,onClose:v})=>{const{t:N,language:C}=a(),[F,M]=e.useState(!1),[k,I]=e.useState(null),[R,$]=e.useState([]);e.useEffect(()=>{r&&b&&($(b.roles||[]),I(null))},[r,b]);const S=()=>{v(!1)};return s.jsxs(n,{open:r,onClose:S,maxWidth:"sm",fullWidth:!0,"data-id-ref":"assign-roles-dialog",children:[s.jsx(i,{"data-id-ref":"assign-roles-dialog-title",children:s.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{color:"primary"}),s.jsx(t,{variant:"h6",children:N("userManagement.assignRoles")})]})}),s.jsxs(d,{"data-id-ref":"assign-roles-dialog-content",children:[k&&s.jsx(c,{"data-id-ref":"assign-roles-error",severity:"error",onClose:()=>I(null),sx:{mb:2},children:k}),s.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:N("userManagement.dialogs.assignRolesMessage",{userName:b?"fa"===C&&b.firstNameFa&&b.lastNameFa?`${b.firstNameFa} ${b.lastNameFa}`:`${b.firstName||""} ${b.lastName||""}`.trim()||b.userName||"":""})}),s.jsx(u,{"data-id-ref":"roles-checkbox-group",children:y.map(e=>s.jsx(m,{"data-id-ref":`role-checkbox-${e.name}`,control:s.jsx(g,{checked:R.includes(e.name||""),onChange:()=>{return s=e.name||"",void $(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},disabled:F}),label:s.jsxs(l,{children:[s.jsx(t,{variant:"body1",children:e.name}),s.jsx(t,{variant:"caption",color:"text.secondary",children:N("userManagement.roleUserCount",{count:e.userCount})})]})},e.id))}),0===y.length&&s.jsx(c,{severity:"info","data-id-ref":"no-roles-alert",children:N("userManagement.errors.noRolesAvailable")})]}),s.jsxs(f,{"data-id-ref":"assign-roles-dialog-actions",children:[s.jsx(j,{"data-id-ref":"cancel-assign-roles-btn",onClick:S,disabled:F,children:N("common.buttons.cancel")}),s.jsx(j,{"data-id-ref":"save-roles-btn",onClick:async()=>{if(b&&b.id){M(!0),I(null);try{h.log("Updating user roles",{userId:b.id,userName:b.userName,roles:R});const e=await o(b.id,R);e.success?(h.log("User roles updated successfully",{userId:b.id}),v(!0)):I(e.message||N("userManagement.errors.assignRolesFailed"))}catch(e){h.error("Failed to update user roles",{error:e}),I(N("userManagement.errors.assignRolesFailed"))}finally{M(!1)}}else h.error("Cannot update roles: user or user ID is null")},variant:"contained",color:"primary",disabled:F||0===y.length,startIcon:F&&s.jsx(x,{size:20}),children:N(F?"common.loading":"common.buttons.save")})]})]})};export{b as default};
