import{bI as e,bQ as a}from"./vendor-TAwwu7tv.js";import{a as t,ai as i,c as s,aj as d}from"./layout-C1_h6sDC.js";import{z as r,E as n,F as l,w as o,c as u,t as m,aa as c,G as b,V as p,O as y,v as w,j as f}from"./mui-core-im59jMHH.js";import"./date-utils-hKKKzaQW.js";import"./i18n-BrX_VL2O.js";import"./mui-icons-v3eeVnKX.js";import"./react-router-B0bL9ISA.js";const I=s(),g=({open:s,editMode:g,gateway:h,onClose:v,onSuccess:x})=>{const{t:j}=t(),[G,P]=e.useState(!1),[E,C]=e.useState(null),[S,T]=e.useState([]),[q,R]=e.useState({name:"",listenIP:"0.0.0.0",port:502,unitId:1,isEnabled:!0}),[F,W]=e.useState({});e.useEffect(()=>{s&&(R(g&&h?{name:h.name||"",listenIP:h.listenIP||"0.0.0.0",port:h.port||502,unitId:h.unitId||1,isEnabled:h.isEnabled??!0}:{name:"",listenIP:"0.0.0.0",port:502,unitId:1,isEnabled:!0}),W({}),T([]),C(null))},[s,g,h]);const _=e=>a=>{const t="number"===a.target.type?""===a.target.value?"":Number(a.target.value):a.target.value;R(a=>({...a,[e]:t})),F[e]&&W(a=>({...a,[e]:void 0})),T(a=>a.filter(a=>a.field.toLowerCase()!==e.toLowerCase()))},k=()=>{const e={};var a;return q.name.trim()||(e.name=j("modbusGateway.validation.nameRequired")),q.listenIP.trim()?(a=q.listenIP.trim(),/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)||(e.listenIP=j("modbusGateway.validation.listenIPInvalid"))):e.listenIP=j("modbusGateway.validation.listenIPRequired"),""===q.port||void 0===q.port?e.port=j("modbusGateway.validation.portRequired"):"number"==typeof q.port&&(q.port<1||q.port>65535)&&(e.port=j("modbusGateway.validation.portRange")),(q.unitId<1||q.unitId>247)&&(e.unitId=j("modbusGateway.validation.unitIdRange")),W(e),0===Object.keys(e).length},z=e=>{const a=F[e];if(a)return a;const t=S.find(a=>a.field.toLowerCase()===e.toLowerCase());if(t)switch(t.errorCode){case"PORT_IN_USE_DB":return j("modbusGateway.validation.portInUseDb");case"PORT_IN_USE_SYSTEM":return j("modbusGateway.validation.portInUseSystem");default:return t.message}},L=()=>{v(!1)};return a.jsxs(r,{open:s,onClose:L,maxWidth:"sm",fullWidth:!0,"data-id-ref":"modbus-gateway-dialog",children:[a.jsx(n,{"data-id-ref":"modbus-gateway-dialog-title",children:j(g?"modbusGateway.dialogs.editTitle":"modbusGateway.dialogs.addTitle")}),a.jsx(l,{"data-id-ref":"modbus-gateway-dialog-content",children:a.jsxs(o,{spacing:3,sx:{mt:1},children:[E&&a.jsx(u,{severity:"error",onClose:()=>C(null),"data-id-ref":"gateway-dialog-error",children:E}),a.jsx(m,{"data-id-ref":"gateway-name-input",label:j("modbusGateway.fields.name"),value:q.name,onChange:_("name"),fullWidth:!0,required:!0,error:!!z("name"),helperText:z("name"),disabled:G}),a.jsxs(c,{container:!0,spacing:2,children:[a.jsx(c,{size:{xs:12,sm:8},children:a.jsx(m,{"data-id-ref":"gateway-listenip-input",label:j("modbusGateway.fields.listenIP"),value:q.listenIP,onChange:_("listenIP"),fullWidth:!0,required:!0,error:!!z("listenIP"),helperText:z("listenIP")||j("modbusGateway.fields.listenIPHelper"),disabled:G,placeholder:"0.0.0.0"})}),a.jsx(c,{size:{xs:12,sm:4},children:a.jsx(m,{"data-id-ref":"gateway-port-input",label:j("modbusGateway.fields.port"),type:"number",value:q.port,onChange:_("port"),fullWidth:!0,required:!0,error:!!z("port"),helperText:z("port")||j("modbusGateway.fields.portHelper"),disabled:G,inputProps:{min:1,max:65535}})})]}),a.jsx(m,{"data-id-ref":"gateway-unitid-input",label:j("modbusGateway.fields.unitId"),type:"number",value:q.unitId,onChange:_("unitId"),fullWidth:!0,required:!0,error:!!z("unitId"),helperText:z("unitId")||j("modbusGateway.fields.unitIdHelper"),disabled:G,inputProps:{min:1,max:247}}),a.jsx(b,{"data-id-ref":"gateway-enabled-switch",control:a.jsx(p,{checked:q.isEnabled,onChange:(O="isEnabled",e=>{R(a=>({...a,[O]:e.target.checked}))}),disabled:G}),label:j("modbusGateway.fields.isEnabled")})]})}),a.jsxs(y,{"data-id-ref":"modbus-gateway-dialog-actions",children:[a.jsx(w,{"data-id-ref":"gateway-dialog-cancel-btn",onClick:L,disabled:G,children:j("cancel")}),a.jsx(w,{"data-id-ref":"gateway-dialog-save-btn",variant:"contained",onClick:async()=>{if(k()){P(!0),C(null),T([]);try{if(g&&h){const e=await i({id:h.id,name:q.name.trim(),listenIP:q.listenIP.trim(),port:q.port,unitId:q.unitId,isEnabled:q.isEnabled});e.isSuccessful?(I.log("Gateway updated successfully"),x(j("modbusGateway.success.updated")),v(!0)):e.validationErrors&&e.validationErrors.length>0?T(e.validationErrors):C(j("modbusGateway.errors.updateFailed"))}else{const e=await d({name:q.name.trim(),listenIP:q.listenIP.trim(),port:q.port,unitId:q.unitId,isEnabled:q.isEnabled});e.isSuccessful?(I.log("Gateway created successfully",{id:e.gatewayId}),x(j("modbusGateway.success.created")),v(!0)):e.validationErrors&&e.validationErrors.length>0?T(e.validationErrors):C(j("modbusGateway.errors.createFailed"))}}catch(e){I.error("Failed to save gateway",{error:e}),C(j(g?"modbusGateway.errors.updateFailed":"modbusGateway.errors.createFailed"))}finally{P(!1)}}},disabled:G,startIcon:G?a.jsx(f,{size:20}):null,children:j(G?"common.saving":"save")})]})]});var O};export{g as default};
