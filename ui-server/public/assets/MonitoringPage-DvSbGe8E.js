const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ItemModbusMappingsDialog-C2ge8Q5Y.js","assets/i18n-BrX_VL2O.js","assets/vendor-TAwwu7tv.js","assets/date-utils-hKKKzaQW.js","assets/layout-C1_h6sDC.js","assets/mui-core-im59jMHH.js","assets/mui-icons-v3eeVnKX.js","assets/react-router-B0bL9ISA.js","assets/css/layout-BR9HfHKF.css","assets/SyncfusionGridWrapper-je9qfgPl.js","assets/index-uPr0P1lU.js","assets/syncfusion-Czakt5fS.js","assets/css/syncfusion-Db7U--rQ.css","assets/css/index-Do90pmhC.css","assets/css/SyncfusionGridWrapper-BHykEdu7.css","assets/api-D5q9v5qU.js","assets/ItemSharp7MappingsDialog-B0dQDnOG.js"])))=>i.map(i=>d[i]);
import{bL as e,bM as a,bI as t,bQ as i,bH as r}from"./vendor-TAwwu7tv.js";import{c as o,e as n,a as l,o as s,p as d,q as m,k as c,w as u,r as g,s as p,t as f,v as x,x as h,y as b,z as v}from"./layout-C1_h6sDC.js";import{t as j,f as y}from"./dateFormatting-Oyh3Sj-d.js";import{u as I}from"./index-uPr0P1lU.js";import{z as C,E as D,B as w,a as S,F as T,D as F,G as N,H as k,J as z,K as P,N as M,b as E,c as A,O,v as W,j as L,t as G,Q as H,R as B,q as R,U as $,r as K,i as q,w as V,x as U,M as X,g as _,k as Y,V as Z,W as J,I as Q,X as ee,P as ae,Y as te,u as ie,d as re,h as oe,Z as ne,C as le,_ as se,$ as de,a0 as me}from"./mui-core-im59jMHH.js";import{r as ce,F as ue,E as ge,s as pe,W as fe,t as xe,S as he,C as be,k as ve,u as je,N as ye,v as Ie,w as Ce,O as De,T as we,x as Se,y as Te,z as Fe,G as Ne,H as ke,I as ze,J as Pe,K as Me,Q as Ee,X as Ae,Y as Oe,Z as We,_ as Le,$ as Ge,a0 as He,a1 as Be,a2 as Re,a3 as $e,a4 as Ke,a5 as qe,a6 as Ve,c as Ue,a7 as Xe,a8 as _e}from"./mui-icons-v3eeVnKX.js";import{_ as Ye}from"./i18n-BrX_VL2O.js";import{I as Ze,E as Je,a as Qe,A as ea}from"./api-D5q9v5qU.js";import{V as aa}from"./ValueHistoryChart-eybJlHX0.js";import{u as ta,c as ia}from"./react-router-B0bL9ISA.js";import"./date-utils-hKKKzaQW.js";import"./syncfusion-Czakt5fS.js";import"./echarts-DOIPydnp.js";const ra={field:"none",direction:"asc",savedAt:Date.now()},oa=[{field:"none",labelKey:"sort.fields.none"},{field:"name",labelKey:"sort.fields.name"},{field:"value",labelKey:"sort.fields.value"},{field:"alarm",labelKey:"sort.fields.alarm"},{field:"type",labelKey:"sort.fields.type"},{field:"pointNumber",labelKey:"sort.fields.pointNumber"},{field:"timestamp",labelKey:"sort.fields.timestamp"}],na=o(),la=e()(a((e,a)=>({preferences:{},getSortConfig:e=>a().preferences[e]||ra,setSortConfig:(a,t)=>{na.info("Setting sort config for group:",{groupId:a,config:t}),e(e=>({preferences:{...e.preferences,[a]:t}}))},removeSortConfig:a=>{na.info("Removing sort config for group:",a),e(e=>{const{[a]:t,...i}=e.preferences;return{preferences:i}})},clearAllSortPreferences:()=>{na.info("Clearing all sort preferences"),e({preferences:{}})}}),{name:"sort-preferences",version:1})),sa=async e=>la.getState().getSortConfig(e),da=async(e,a)=>{la.getState().setSortConfig(e,a)},ma=async e=>{la.getState().removeSortConfig(e)},ca=o(),ua=(e,a)=>"fa"===a&&e.nameFa?e.nameFa:e.name,ga=(e,a,t,i)=>{const r="fa"===t?"fa-IR":"en-US",o=e.localeCompare(a,r,{sensitivity:"base"});return"asc"===i?o:-o},pa=(e,a,t)=>{const i=e-a;return"asc"===t?i:-i},fa=(e,a,t)=>[...e].sort((e,i)=>{const r=ua(e,a),o=ua(i,a);return ga(r,o,a,t)}),xa=(e,a,t)=>[...e].sort((e,i)=>{const r=a[e.id],o=a[i.id];return null==r&&null==o?0:null==r?1:null==o?-1:pa("boolean"==typeof r?r?1:0:r,"boolean"==typeof o?o?1:0:o,t)}),ha=(e,a,t)=>{const i=new Map;return a.forEach(e=>{if(e.itemId&&!e.isDisabled){const a=i.get(e.itemId)||0;i.set(e.itemId,a+1)}}),[...e].sort((e,a)=>{const r=i.get(e.id)||0,o=i.get(a.id)||0;return pa(r,o,"asc"===t?"desc":"asc")})},ba=(e,a,t)=>[...e].sort((e,i)=>{const r=String(e.itemType),o=String(i.itemType);return ga(r,o,a,t)}),va=(e,a)=>[...e].sort((e,t)=>pa(e.pointNumber,t.pointNumber,a)),ja=(e,a,t)=>[...e].sort((e,i)=>{const r=a[e.id],o=a[i.id];return null==r&&null==o?0:null==r?1:null==o?-1:pa(r,o,t)}),ya=(e,a,t)=>{if(!e||0===e.length)return e;ca.log("Sorting items:",{itemCount:e.length,field:a.field,direction:a.direction,language:t.language});const{field:i,direction:r}=a,{language:o,values:n={},alarms:l=[],timestamps:s={}}=t;try{switch(i){case"name":return fa(e,o,r);case"value":return xa(e,n,r);case"alarm":return ha(e,l,r);case"type":return ba(e,o,r);case"pointNumber":return va(e,r);case"timestamp":return ja(e,s,r);default:return e}}catch(d){return ca.error("Error sorting items:",d),e}},Ia=o(),Ca=e=>{const{groupId:a,language:i,items:r,values:o,alarms:n,timestamps:l}=e,[s,d]=t.useState(ra),[m,c]=t.useState(!0);t.useEffect(()=>{let e=!0;return(async()=>{c(!0);try{const t=await sa(a||"root");e&&(d(t),Ia.log("Loaded sort preference:",{groupId:a||"root",config:t}))}catch(t){Ia.error("Failed to load sort preference:",t),e&&d(ra)}finally{e&&c(!1)}})(),()=>{e=!1}},[a]);const u=t.useMemo(()=>r&&0!==r.length?ya(r,s,{language:i,values:o,alarms:n,timestamps:l}):r,[r,s,i,o,n,l]),g=t.useCallback(e=>{const t={field:e,direction:s.direction,savedAt:Date.now()};d(t),a&&da(a,t).catch(e=>Ia.error("Failed to save sort field:",e)),Ia.log("Changed sort field:",{groupId:a||"root",field:e,direction:t.direction})},[a,s.direction]),p=t.useCallback(e=>{const t={field:s.field,direction:e,savedAt:Date.now()};d(t),a&&da(a,t).catch(e=>Ia.error("Failed to save sort direction:",e)),Ia.log("Changed sort direction:",{groupId:a||"root",field:t.field,direction:e})},[a,s.field]),f=t.useCallback(()=>{const e="asc"===s.direction?"desc":"asc",t={field:s.field,direction:e,savedAt:Date.now()};d(t),a&&da(a,t).catch(e=>Ia.error("Failed to save sort direction:",e))},[s.direction,s.field,a]),x=t.useCallback(()=>{d(ra),a&&ma(a).catch(e=>Ia.error("Failed to clear sort preference:",e)),Ia.log("Reset sort to default:",{groupId:a||"root"})},[a]);return{sortConfig:s,sortedItems:u,setSortField:g,setSortDirection:p,toggleDirection:f,resetSort:x,isLoading:m}},Da=o();function wa(e){const{state:a}=n(),{groups:i,items:r,alarms:o}=a,l=a.activeAlarms.list,s=a.activeAlarms.isFetching;return t.useMemo(()=>{const a={alarmCount:0,warningCount:0,totalAffectedItems:0,hasAlarms:!1,hasWarnings:!1,isLoading:s};if(!i||!r||!o||0===l.length)return{...a,isLoading:s};Da.log(`Calculating alarm status for group: ${e}`,{totalGroups:i.length,totalItems:r.length,totalActiveAlarms:l.length,totalAlarmConfigs:o.length});const t=e=>{const a=[e];return i.filter(a=>a.parentId===e).forEach(e=>{a.push(...t(e.id))}),a},n=t(e);Da.log(`Found ${n.length} descendant groups for ${e}`);const d=r.filter(e=>e.groupId&&n.includes(e.groupId));if(Da.log(`Found ${d.length} items in descendant groups`),0===d.length)return{...a,isLoading:s};const m=new Map;let c=[];if(Array.isArray(o))c=o;else if("object"==typeof o&&"data"in o){const e=o;Array.isArray(e.data)&&(c=e.data)}c.forEach(e=>{e.id&&e.alarmPriority&&m.set(e.id,e.alarmPriority)}),Da.log(`Built alarm priority map with ${m.size} entries`);const u=new Set,g=new Set;l.forEach(e=>{const a=e.itemId,t=e.alarmId;if(!a||!t)return;if(!d.find(e=>e.id===a))return;const i=m.get(t);i?2===i?(u.add(a),Da.log(`Item ${a} has alarm (priority 2)`)):1===i&&(g.add(a),Da.log(`Item ${a} has warning (priority 1)`)):Da.warn(`Could not find priority for alarm ${t}`)});const p=new Set([...u,...g]),f={alarmCount:u.size,warningCount:g.size,totalAffectedItems:p.size,hasAlarms:u.size>0,hasWarnings:g.size>0,isLoading:s};return Da.log(`Alarm status for group ${e}:`,f),f},[e,i,r,o,l,s])}const Sa=o(),Ta=({open:e,onClose:a,groupId:r,groupName:o,currentParentId:d,onSuccess:m})=>{const{t:c}=I(),{language:u}=l(),{state:g,fetchGroups:p}=n(),f=g.groups,[x,h]=t.useState(null),[b,v]=t.useState(!1),[j,y]=t.useState(!1),[G,H]=t.useState(null),[B,R]=t.useState(!1);Sa.log("MoveGroupDialog render",{open:e,groupId:r,groupName:o,currentParentId:d,groupsCount:f.length});const $=t.useMemo(()=>{const e=new Set,a=t=>{f.forEach(i=>{i.parentId===t&&i.id&&(e.add(i.id),a(i.id))})};return a(r),e},[f,r]),K=t.useMemo(()=>{const e=new Map;f.forEach(a=>{a.id&&e.set(a.id,a)});const a=t=>{const i=e.get(t);if(!i)return"";const r=e=>"fa"===u?e.nameFa||e.name||"پوشه بدون نام":e.name||e.nameFa||"Unnamed Folder";if(!i.parentId)return r(i);const o=a(i.parentId),n=r(i);return o?`${o} / ${n}`:n};return f.filter(e=>!!e.id&&e.id!==r&&!$.has(e.id)).map(e=>({id:e.id,name:e.name||e.nameFa||"Unnamed Folder",nameFa:e.nameFa||e.name||"پوشه بدون نام",fullPath:a(e.id),parentId:e.parentId})).sort((e,a)=>e.fullPath.localeCompare(a.fullPath))},[f,r,$,u]),q=t.useMemo(()=>{if(!d)return c("moveGroupDialog.noCurrentParent");const e=f.find(e=>e.id===d);return e?"fa"===u?e.nameFa||e.name||c("moveGroupDialog.unnamedFolder"):e.name||e.nameFa||c("moveGroupDialog.unnamedFolder"):c("moveGroupDialog.unknownFolder")},[d,f,c,u]),V=()=>{j||(h(null),v(!1),H(null),R(!1),a())},U=e=>{switch(e){case 1:return c("moveGroupDialog.errors.groupNotFound");case 2:return c("moveGroupDialog.errors.parentNotFound");case 3:return c("moveGroupDialog.errors.circularReference");case 4:return c("moveGroupDialog.errors.sameParent");default:return c("moveGroupDialog.errors.moveFailed")}},X=async()=>{if(!b&&!x)return void H(c("moveGroupDialog.validation.folderRequired"));const e=b?null:x;Sa.log("Moving group to new parent",{groupId:r,groupName:o,fromParentId:d,toParentId:e,moveToRoot:b}),y(!0),H(null);try{const t=await s({groupId:r,parentId:e});if(t.isSuccessful){Sa.log("Group moved successfully",{groupId:r,toParentId:e}),R(!0);try{await p(),Sa.log("Groups refreshed from backend after move")}catch(a){Sa.error("Failed to refresh groups after move",a)}setTimeout(()=>{m?.(),V()},1e3)}else{Sa.error("Move group failed - API returned unsuccessful",{groupId:r,errorCode:t.error,message:t.message});const e=t.message||U(t.error);H(e)}}catch(t){Sa.error("Error moving group",t);const e=t,a=e?.response?.data?.message||e?.message||c("moveGroupDialog.errors.unknownError");H(a)}finally{y(!1)}};return i.jsxs(C,{open:e,onClose:V,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:{xs:2,sm:3},maxHeight:{xs:"calc(100% - 32px)",sm:"calc(100% - 64px)"}}},"data-id-ref":"move-group-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsx(D,{"data-id-ref":"move-group-dialog-title",sx:{px:{xs:2,sm:3},pt:{xs:2,sm:3}},children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ce,{color:"primary"}),i.jsx(S,{variant:"h6",component:"span",sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:c("moveGroupDialog.title")})]})}),i.jsxs(T,{"data-id-ref":"move-group-dialog-content",sx:{px:{xs:2,sm:3}},children:[i.jsxs(w,{mb:2,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:c("moveGroupDialog.folderLabel")}),i.jsx(S,{variant:"body1",fontWeight:"medium",sx:{fontSize:{xs:"0.9rem",sm:"1rem"},wordBreak:"break-word"},children:o})]}),i.jsxs(w,{mb:3,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:c("moveGroupDialog.currentParentLabel")}),i.jsx(S,{variant:"body1",color:"text.primary",sx:{fontSize:{xs:"0.9rem",sm:"1rem"},wordBreak:"break-word"},children:q})]}),i.jsx(F,{sx:{mb:3}}),i.jsx(N,{control:i.jsx(k,{checked:b,onChange:e=>{v(e.target.checked),e.target.checked&&h(null),H(null)},disabled:j,"data-id-ref":"move-group-dialog-root-checkbox"}),label:c("moveGroupDialog.moveToRoot"),sx:{mb:2}}),i.jsxs(z,{fullWidth:!0,disabled:j||b,"data-id-ref":"move-group-dialog-parent-select",size:"small",children:[i.jsx(P,{id:"move-group-parent-label",children:c("moveGroupDialog.selectParentLabel")}),i.jsxs(M,{labelId:"move-group-parent-label",value:x||"",onChange:e=>{h(e.target.value||null),v(!1),H(null)},label:c("moveGroupDialog.selectParentLabel"),MenuProps:{PaperProps:{style:{maxHeight:300}}},children:[i.jsx(E,{value:"",children:i.jsx("em",{children:c("moveGroupDialog.selectParentPlaceholder")})}),K.map(e=>i.jsx(E,{value:e.id,"data-id-ref":`move-group-dialog-parent-option-${e.id}`,children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ue,{fontSize:"small",color:"action"}),i.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"},wordBreak:"break-word"},children:e.fullPath})]})},e.id))]})]}),G&&i.jsx(A,{severity:"error",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-group-dialog-error",children:G}),B&&i.jsx(A,{severity:"success",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-group-dialog-success",children:c("moveGroupDialog.success")}),0===K.length&&!b&&i.jsx(A,{severity:"info",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-group-dialog-no-folders",children:c("moveGroupDialog.noFoldersAvailable")})]}),i.jsxs(O,{"data-id-ref":"move-group-dialog-actions",sx:{px:{xs:2,sm:3},pb:{xs:2,sm:2},gap:1,flexDirection:{xs:"column",sm:"row"},"& > :not(style)":{width:{xs:"100%",sm:"auto"}}},children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),V()},disabled:j,"data-id-ref":"move-group-dialog-cancel-button",fullWidth:!1,sx:{order:{xs:2,sm:1}},children:c("cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),X()},variant:"contained",disabled:j||!b&&!x,startIcon:j?i.jsx(L,{size:16}):i.jsx(ce,{}),"data-id-ref":"move-group-dialog-move-button",fullWidth:!1,sx:{order:{xs:1,sm:2}},children:c(j?"moveGroupDialog.moving":"moveGroupDialog.moveButton")})]})]})},Fa=o(),Na=({open:e,onClose:a,groupId:r,groupName:o,groupNameFa:l,onSuccess:s})=>{const{t:m}=I(),{fetchGroups:c}=n(),[u,g]=t.useState(o),[p,f]=t.useState(l||""),[x,h]=t.useState(!1),[b,v]=t.useState(null),[j,y]=t.useState(!1);Fa.log("EditGroupDialog render",{open:e,groupId:r,groupName:o,groupNameFa:l}),t.useEffect(()=>{e&&(g(o),f(l||""),v(null),y(!1))},[e,o,l]);const F=()=>{x||(g(o),f(l||""),v(null),y(!1),a())},N=async()=>{const e=u.trim(),a=p.trim();if(e||a)if(e!==o||a!==(l||"")){Fa.log("Editing group names",{groupId:r,oldName:o,newName:e,oldNameFa:l,newNameFa:a}),h(!0),v(null);try{const i=await d({id:r,name:e||null,nameFa:a||null});if(i.success){Fa.log("Group names edited successfully",{groupId:r,newName:e,newNameFa:a}),y(!0);try{await c(),Fa.log("Groups refreshed from backend after edit")}catch(t){Fa.error("Failed to refresh groups after edit",t)}setTimeout(()=>{s?.(),F()},1e3)}else{Fa.error("Edit group failed - API returned unsuccessful",{groupId:r});const e=i.message||m("editGroupDialog.errors.editFailed");v(e)}}catch(i){Fa.error("Error editing group",i);const e=i,a=e?.response?.data?.message||e?.message||m("editGroupDialog.errors.unknownError");v(a)}finally{h(!1)}}else v(m("editGroupDialog.validation.nameUnchanged"));else v(m("editGroupDialog.validation.atLeastOneName"))},k=e=>{"Enter"!==e.key||x||(e.preventDefault(),N())};return i.jsxs(C,{open:e,onClose:F,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:{xs:2,sm:3},maxHeight:{xs:"calc(100% - 32px)",sm:"calc(100% - 64px)"}}},"data-id-ref":"edit-group-dialog",children:[i.jsx(D,{"data-id-ref":"edit-group-dialog-title",sx:{px:{xs:2,sm:3},pt:{xs:2,sm:3}},children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ge,{color:"primary"}),i.jsx(S,{variant:"h6",component:"span",sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:m("editGroupDialog.title")})]})}),i.jsxs(T,{"data-id-ref":"edit-group-dialog-content",sx:{px:{xs:2,sm:3}},children:[i.jsxs(w,{mb:3,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:m("editGroupDialog.currentNamesLabel")}),i.jsxs(w,{display:"flex",flexDirection:"column",gap:1,children:[i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ue,{fontSize:"small",color:"action"}),i.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.85rem",sm:"0.9rem"},wordBreak:"break-word"},children:[i.jsxs("strong",{children:[m("editGroupDialog.englishLabel"),":"]})," ",o||m("editGroupDialog.notSet")]})]}),i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ue,{fontSize:"small",color:"action"}),i.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.85rem",sm:"0.9rem"},wordBreak:"break-word"},children:[i.jsxs("strong",{children:[m("editGroupDialog.persianLabel"),":"]})," ",l||m("editGroupDialog.notSet")]})]})]})]}),i.jsx(G,{autoFocus:!0,margin:"dense",label:m("editGroupDialog.englishNameLabel"),type:"text",fullWidth:!0,value:u,onChange:e=>{g(e.target.value),v(null)},onKeyDown:k,disabled:x,error:!!b&&!j,"data-id-ref":"edit-group-dialog-name-input",size:"small",sx:{mb:2},placeholder:m("editGroupDialog.englishNamePlaceholder")}),i.jsx(G,{margin:"dense",label:m("editGroupDialog.persianNameLabel"),type:"text",fullWidth:!0,value:p,onChange:e=>{f(e.target.value),v(null)},onKeyDown:k,disabled:x,error:!!b&&!j,helperText:b&&!j?b:m("editGroupDialog.atLeastOneRequired"),"data-id-ref":"edit-group-dialog-namefa-input",size:"small",sx:{mb:2},placeholder:m("editGroupDialog.persianNamePlaceholder"),inputProps:{dir:"rtl",style:{textAlign:"right"}}}),j&&i.jsx(A,{severity:"success",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"edit-group-dialog-success",children:m("editGroupDialog.success")})]}),i.jsxs(O,{"data-id-ref":"edit-group-dialog-actions",sx:{px:{xs:2,sm:3},pb:{xs:2,sm:2},gap:1,flexDirection:{xs:"column",sm:"row"},"& > :not(style)":{width:{xs:"100%",sm:"auto"}}},children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),F()},disabled:x,"data-id-ref":"edit-group-dialog-cancel-button",fullWidth:!1,sx:{order:{xs:2,sm:1}},children:m("cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),N()},variant:"contained",disabled:x||!u.trim()&&!p.trim(),startIcon:x?i.jsx(L,{size:16}):i.jsx(ge,{}),"data-id-ref":"edit-group-dialog-save-button",fullWidth:!1,sx:{order:{xs:1,sm:2}},children:m(x?"editGroupDialog.saving":"editGroupDialog.saveButton")})]})]})},ka=o(),za=({open:e,onClose:a,groupId:r,groupName:o,onSuccess:l})=>{const{t:s}=I(),{state:d,fetchGroups:c}=n(),u=d.groups,g=d.items,[p,f]=t.useState(!1),[x,h]=t.useState(null),[b,v]=t.useState(!1);ka.log("DeleteGroupDialog render",{open:e,groupId:r,groupName:o,groupsCount:u.length,itemsCount:g.length});const j=t.useMemo(()=>u.some(e=>e.parentId===r),[u,r]),y=t.useMemo(()=>g.some(e=>e.groupId===r),[g,r]),{subgroupCount:F,itemCount:N}=t.useMemo(()=>({subgroupCount:u.filter(e=>e.parentId===r).length,itemCount:g.filter(e=>e.groupId===r).length}),[u,g,r]),k=!j&&!y,z=()=>{p||(h(null),v(!1),a())},P=async()=>{if(k){ka.log("Deleting group",{groupId:r,groupName:o}),f(!0),h(null);try{const a=await m({id:r});if(a.success){ka.log("Group deleted successfully",{groupId:r}),v(!0);try{await c(),ka.log("Groups refreshed from backend after delete")}catch(e){ka.error("Failed to refresh groups after delete",e)}setTimeout(()=>{l?.(),z()},1e3)}else{ka.error("Delete group failed - API returned unsuccessful",{groupId:r,message:a.message});const e=a.message||s("deleteGroupDialog.errors.deleteFailed");h(e)}}catch(a){ka.error("Error deleting group",a);const e=a,t=e?.response?.data?.message||e?.message||s("deleteGroupDialog.errors.unknownError");h(t)}finally{f(!1)}}else h(s("deleteGroupDialog.errors.hasContent"))};return i.jsxs(C,{open:e,onClose:z,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:{xs:2,sm:3},maxHeight:{xs:"calc(100% - 32px)",sm:"calc(100% - 64px)"}}},"data-id-ref":"delete-group-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsx(D,{"data-id-ref":"delete-group-dialog-title",sx:{px:{xs:2,sm:3},pt:{xs:2,sm:3}},children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(pe,{color:"error"}),i.jsx(S,{variant:"h6",component:"span",sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:s("deleteGroupDialog.title")})]})}),i.jsxs(T,{"data-id-ref":"delete-group-dialog-content",sx:{px:{xs:2,sm:3}},children:[i.jsxs(w,{mb:2,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:s("deleteGroupDialog.folderLabel")}),i.jsx(S,{variant:"body1",fontWeight:"medium",sx:{fontSize:{xs:"0.9rem",sm:"1rem"},wordBreak:"break-word"},children:o})]}),k?i.jsx(A,{severity:"warning",icon:i.jsx(fe,{}),sx:{mb:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"delete-group-dialog-warning",children:i.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:s("deleteGroupDialog.confirmMessage")})}):i.jsxs(A,{severity:"error",sx:{mb:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"delete-group-dialog-cannot-delete",children:[i.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:s("deleteGroupDialog.cannotDeleteMessage")}),j&&i.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.8rem"},mt:1},children:["• ",s("deleteGroupDialog.hasSubgroups",{count:F})]}),y&&i.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.75rem",sm:"0.8rem"},mt:.5},children:["• ",s("deleteGroupDialog.hasItems",{count:N})]})]}),i.jsx(H,{sx:{fontSize:{xs:"0.85rem",sm:"0.9rem"},mb:2},children:s(k?"deleteGroupDialog.description":"deleteGroupDialog.moveOrDeleteContent")}),x&&i.jsx(A,{severity:"error",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"delete-group-dialog-error",children:x}),b&&i.jsx(A,{severity:"success",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"delete-group-dialog-success",children:s("deleteGroupDialog.success")})]}),i.jsxs(O,{"data-id-ref":"delete-group-dialog-actions",sx:{px:{xs:2,sm:3},pb:{xs:2,sm:2},gap:1,flexDirection:{xs:"column",sm:"row"},"& > :not(style)":{width:{xs:"100%",sm:"auto"}}},children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),z()},disabled:p,"data-id-ref":"delete-group-dialog-cancel-button",fullWidth:!1,sx:{order:{xs:2,sm:1}},children:s("cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),P()},variant:"contained",color:"error",disabled:p||!k,startIcon:p?i.jsx(L,{size:16}):i.jsx(pe,{}),"data-id-ref":"delete-group-dialog-delete-button",fullWidth:!1,sx:{order:{xs:1,sm:2}},children:s(p?"deleteGroupDialog.deleting":"deleteGroupDialog.deleteButton")})]})]})},Pa=({group:e,subgroupCount:a,itemCount:t,onClick:o})=>{const{t:n,language:s}=l(),{user:d}=c(),[m,u]=r.useState(3),[g,p]=r.useState(null),[f,x]=r.useState(!1),[h,b]=r.useState(!1),[v,y]=r.useState(!1),{alarmCount:I,warningCount:C,totalAffectedItems:D,hasAlarms:T,hasWarnings:F}=wa(e.id),N=d?.roles?.includes("Admin")??!1,k="fa"===s&&e.nameFa?e.nameFa:e.name,z=e=>"fa"===s?j(e):String(e),P=()=>{p(null)};return i.jsx(B,{in:!0,timeout:300,children:i.jsxs(R,{elevation:m,onMouseEnter:()=>u(8),onMouseLeave:()=>u(3),onContextMenu:e=>{N&&(e.preventDefault(),e.stopPropagation(),p(null===g?{mouseX:e.clientX,mouseY:e.clientY}:null))},sx:{minHeight:160,display:"flex",flexDirection:"column",border:"1px solid",borderColor:"divider",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",...T&&{borderWidth:2,borderStyle:"solid",borderColor:"error.main"},...!T&&F&&{borderWidth:2,borderStyle:"solid",borderColor:"warning.main"}},"data-id-ref":"group-card-root-container",children:[i.jsx($,{onClick:o,title:n("openFolder"),sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:2},"data-id-ref":"group-card-action-area",children:i.jsxs(K,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,width:"100%",textAlign:"center",paddingBottom:2,"&:last-child":{paddingBottom:2}},"data-id-ref":"group-card-content-container",children:[i.jsx(w,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},"data-id-ref":"group-card-icon-container",children:i.jsx(q,{badgeContent:D>0?z(D):null,color:T?"error":"warning",max:99,sx:{"& .MuiBadge-badge":{fontSize:"0.75rem",fontWeight:600,minWidth:20,height:20,padding:"0 6px",fontFamily:"fa"===s?"IRANSansX, sans-serif":"inherit"}},"data-id-ref":"group-card-alarm-badge",children:i.jsx(ue,{sx:{fontSize:"3.5rem",color:T?"error.main":"warning.main",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",willChange:"transform",".MuiCardActionArea-root:hover &":{transform:"scale(1.15) rotate(-5deg)"}},"data-id-ref":"group-card-folder-icon"})})}),i.jsx(S,{variant:"subtitle1",component:"h6",sx:{fontWeight:600,wordBreak:"break-word",lineHeight:1.4,maxWidth:"100%"},"data-id-ref":"group-card-title-heading",children:k}),i.jsxs(V,{direction:"row",flexWrap:"wrap",justifyContent:"center",sx:{gap:1},"data-id-ref":"group-card-badges-row",children:[I>0&&i.jsx(U,{icon:i.jsx(xe,{sx:{fontSize:16},"data-id-ref":"group-card-alarm-icon"}),label:`${z(I)} ${n("itemCard.highPriorityAlarm")}`,color:"error",size:"small",sx:{transition:"transform 0.2s ease",".MuiCardActionArea-root:hover &":{transform:"scale(1.05)"}},"data-id-ref":"group-card-alarm-count-badge"}),C>0&&i.jsx(U,{icon:i.jsx(fe,{sx:{fontSize:16},"data-id-ref":"group-card-warning-icon"}),label:`${z(C)} ${n("itemCard.lowPriorityAlarm")}`,color:"warning",size:"small",sx:{transition:"transform 0.2s ease",".MuiCardActionArea-root:hover &":{transform:"scale(1.05)"}},"data-id-ref":"group-card-warning-count-badge"}),a>0&&i.jsx(U,{label:`${z(a)} ${n(1===a?"folder":"folders2")}`,color:"primary",size:"small",sx:{transition:"transform 0.2s ease",".MuiCardActionArea-root:hover &":{transform:"scale(1.05)"}},"data-id-ref":"group-card-subgroup-badge"}),t>0&&i.jsx(U,{label:`${z(t)} ${n(1===t?"item":"items2")}`,color:"info",size:"small",sx:{transition:"transform 0.2s ease",".MuiCardActionArea-root:hover &":{transform:"scale(1.05)"}},"data-id-ref":"group-card-item-badge"})]})]})}),i.jsxs(X,{open:null!==g,onClose:P,anchorReference:"anchorPosition",anchorPosition:null!==g?{top:g.mouseY,left:g.mouseX}:void 0,"data-id-ref":"group-card-admin-context-menu",children:[i.jsxs(E,{onClick:()=>{x(!0),P()},"data-id-ref":"group-card-menu-move-folder",children:[i.jsx(_,{children:i.jsx(ce,{fontSize:"small"})}),i.jsx(Y,{children:n("groupCard.adminMenu.moveFolder")})]}),i.jsxs(E,{onClick:()=>{b(!0),P()},"data-id-ref":"group-card-menu-edit-folder",children:[i.jsx(_,{children:i.jsx(ge,{fontSize:"small"})}),i.jsx(Y,{children:n("groupCard.adminMenu.editFolder")})]}),i.jsxs(E,{onClick:()=>{y(!0),P()},"data-id-ref":"group-card-menu-delete-folder",children:[i.jsx(_,{children:i.jsx(pe,{fontSize:"small"})}),i.jsx(Y,{children:n("groupCard.adminMenu.deleteFolder")})]})]}),i.jsx(Ta,{open:f,groupId:e.id,groupName:e.name,onClose:()=>x(!1),onSuccess:()=>{x(!1)}}),i.jsx(Na,{open:h,groupId:e.id,groupName:e.name,groupNameFa:e.nameFa,onClose:()=>b(!1),onSuccess:()=>{b(!1)}}),i.jsx(za,{open:v,groupId:e.id,groupName:k,onClose:()=>y(!1),onSuccess:()=>{y(!1)}})]})})},Ma=o(),Ea=()=>{const e=t.useRef(new Set);return t.useCallback(a=>{if(!e.current.has(a))try{const t=document.createElement("link");t.rel="prefetch",t.href=a,t.as="document",document.head.appendChild(t),e.current.add(a),t.onload=()=>{Ma.debug(`Prefetched: ${a}`)},t.onerror=()=>{Ma.warn(`Failed to prefetch: ${a}`),e.current.delete(a)}}catch(t){Ma.error("Failed to create prefetch link:",t)}},[])},Aa=o();function Oa(e){const{itemId:a}=e,{state:i}=n(),r=i.activeAlarms.list,o=i.activeAlarms.isFetching,l=i.alarms;return t.useMemo(()=>{Aa.log(`Calculating alarm status for item: ${a} from Zustand store`);const e=r.filter(e=>e.itemId===a);if(e.length>0){let t=[];if(l)if(Array.isArray(l))t=l;else if("object"==typeof l&&"data"in l){const e=l;Array.isArray(e.data)&&(t=e.data)}const i=e.map(e=>{const a=t.find(a=>a.id===e.alarmId);return a&&e.alarmId?{alarmId:e.alarmId,priority:a.alarmPriority||1,message:a.message,messageFa:a.messageFa,activatedAt:e.time,dateTime:e.dateTime}:null}).filter(e=>null!==e),r=i.reduce((e,a)=>2===a.priority?2:e,1);return Aa.log(`Item ${a} HAS ${i.length} active alarm(s)`,{alarmCount:i.length,highestPriority:r,alarmIds:i.map(e=>e.alarmId)}),{hasAlarm:!0,alarmPriority:r,alarms:i,isChecking:o,error:null,refresh:async()=>{Aa.log("Refresh called - data is automatically updated via Zustand store")}}}return Aa.log(`Item ${a} has NO active alarm`),{hasAlarm:!1,alarmPriority:null,alarms:[],isChecking:o,error:null,refresh:async()=>{Aa.log("Refresh called - data is automatically updated via Zustand store")}}},[a,r,l,o])}function Wa(e,a){const t=new URLSearchParams({itemId:a.itemId}).toString();return`${"undefined"!=typeof window&&window.location.origin||""}/item-detail/${e}?${t}`}const La=o(),Ga=({open:e,onClose:a,item:r,onCommandSent:o})=>{const{t:n}=I(),[l,s]=t.useState(!1),[d,m]=t.useState(""),[c,g]=t.useState(""),[p,f]=t.useState(!1),[x,h]=t.useState(""),[b,v]=t.useState(!1);La.log("ItemCommandDialog render",{open:e,itemId:r.id,itemType:r.itemType,itemName:r.name});const j=t.useMemo(()=>r.itemType===Ze.DigitalInput||r.itemType===Ze.DigitalOutput,[r.itemType]),y=t.useMemo(()=>r.itemType===Ze.AnalogInput||r.itemType===Ze.AnalogOutput,[r.itemType]),k=t.useMemo(()=>y?{min:r.scaleMin??0,max:r.scaleMax??100}:null,[y,r.scaleMin,r.scaleMax]);t.useEffect(()=>{e&&(s(!1),m(""),g(""),h(""),v(!1),f(!1),La.log("Dialog opened, form reset",{itemId:r.id}))},[e,r.id]),t.useEffect(()=>{if(b){const e=setTimeout(()=>{a()},2e3);return()=>clearTimeout(e)}},[b,a]);const z=t.useMemo(()=>e=>{if(!e.trim())return n("itemCommandDialog.validation.required");const a=parseFloat(e);if(isNaN(a))return n("itemCommandDialog.validation.invalidNumber");if(k){if(a<k.min)return n("itemCommandDialog.validation.belowMinimum",{min:k.min});if(a>k.max)return n("itemCommandDialog.validation.aboveMaximum",{max:k.max})}return null},[n,k]),P=t.useMemo(()=>e=>{if(!e.trim())return null;const a=parseFloat(e);return isNaN(a)?n("itemCommandDialog.validation.invalidNumber"):a<=0?n("itemCommandDialog.validation.invalidDuration"):null},[n]),M=async()=>{try{h(""),f(!0);const e=j?l?"1":"0":y?d.trim():"";if(y){const e=z(d);if(e)return void h(e)}if(c.trim()){const e=P(c);if(e)return void h(e)}if(La.log("Sending command",{itemId:r.id,itemName:r.name,itemType:r.itemType,commandValue:e,duration:c.trim()||"not specified"}),!(await u({itemId:r.id,value:e,...c.trim()&&{duration:parseInt(c,10)}})).isSuccess)throw new Error(n("itemCommandDialog.errors.commandFailed"));v(!0),o&&o(r.id,e),La.log("Command sent successfully",{itemId:r.id,commandValue:e,duration:c.trim()||"not specified"})}catch(e){const a=e instanceof Error?e.message:n("itemCommandDialog.errors.sendFailed");h(a),La.error("Failed to send command",{itemId:r.id,error:e})}finally{f(!1)}},E=()=>{p||a()},H=t.useMemo(()=>!(p||b||c.trim()&&null!==P(c)||!j&&(!y||""===d.trim()||null!==z(d))),[j,y,d,c,p,b,z,P]);return i.jsxs(C,{open:e,onClose:E,maxWidth:"sm",fullWidth:!0,"data-id-ref":"item-command-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},"data-id-ref":"item-command-dialog-title",children:[i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(he,{color:"primary","data-id-ref":"item-command-dialog-title-icon"}),i.jsx(S,{variant:"h6",component:"span","data-id-ref":"item-command-dialog-title-text",children:n("itemCommandDialog.title")})]}),i.jsx(W,{onClick:E,disabled:p,size:"small",variant:"text",color:"inherit",sx:{minWidth:"auto",p:.5},"data-id-ref":"item-command-dialog-close-button",children:i.jsx(be,{fontSize:"small","data-id-ref":"item-command-dialog-close-icon"})})]}),i.jsx(F,{}),i.jsx(T,{sx:{pt:2,pb:2},"data-id-ref":"item-command-dialog-content",children:i.jsxs(V,{spacing:3,children:[i.jsxs(w,{"data-id-ref":"item-command-dialog-item-info",children:[i.jsx(S,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:n("itemCommandDialog.itemInformation")}),i.jsxs(V,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(U,{label:r.name,size:"small",color:"primary",variant:"outlined","data-id-ref":"item-command-dialog-item-name-chip"}),i.jsx(U,{label:`${n("pointNumber")}: ${r.pointNumber}`,size:"small",color:"default",variant:"outlined","data-id-ref":"item-command-dialog-point-number-chip"}),r.unit&&i.jsx(U,{label:`${n("unit")}: ${r.unit}`,size:"small",color:"default",variant:"outlined","data-id-ref":"item-command-dialog-unit-chip"})]})]}),j&&i.jsxs(w,{"data-id-ref":"item-command-dialog-digital-controls",children:[i.jsx(S,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:n("itemCommandDialog.digitalCommand")}),i.jsx(N,{control:i.jsx(Z,{checked:l,onChange:e=>s(e.target.checked),disabled:p||b,color:"primary","data-id-ref":"item-command-dialog-digital-switch"}),label:i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(S,{variant:"body2",children:l?r.onText||n("common.on"):r.offText||n("common.off")}),i.jsx(U,{label:l?"1":"0",size:"small",color:l?"success":"default",variant:"filled","data-id-ref":"item-command-dialog-digital-value-chip"})]}),"data-id-ref":"item-command-dialog-digital-control"})]}),y&&i.jsxs(w,{"data-id-ref":"item-command-dialog-analog-controls",children:[i.jsx(S,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:n("itemCommandDialog.analogCommand")}),i.jsx(G,{fullWidth:!0,type:"number",label:n("itemCommandDialog.setValue"),value:d,onChange:e=>m(e.target.value),disabled:p||b,error:!!z(d)&&""!==d.trim(),helperText:""!==d.trim()?z(d):k?n("itemCommandDialog.rangeHelper",{min:k.min,max:k.max}):void 0,InputProps:{endAdornment:r.unit?i.jsx(J,{position:"end",children:i.jsx(S,{variant:"caption",color:"text.secondary",children:r.unit})}):void 0},inputProps:{step:.1,...k&&{min:k.min,max:k.max}},"data-id-ref":"item-command-dialog-analog-input"})]}),i.jsxs(w,{"data-id-ref":"item-command-dialog-duration-field",children:[i.jsxs(S,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:[n("itemCommandDialog.duration"),i.jsx(U,{label:n("itemCommandDialog.durationOptional"),size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"},"data-id-ref":"item-command-dialog-duration-optional-chip"})]}),i.jsx(G,{fullWidth:!0,type:"number",label:n("itemCommandDialog.duration"),value:c,onChange:e=>g(e.target.value),disabled:p||b,error:!!c.trim()&&!!P(c),helperText:c.trim()&&P(c)?P(c):n("itemCommandDialog.durationHelper"),InputProps:{endAdornment:i.jsx(J,{position:"end",children:i.jsx(S,{variant:"caption",color:"text.secondary",children:n("seconds")})})},inputProps:{step:1,min:1},"data-id-ref":"item-command-dialog-duration-input"})]}),x&&i.jsx(A,{severity:"error",icon:i.jsx(xe,{}),"data-id-ref":"item-command-dialog-error-alert",children:x}),b&&i.jsx(A,{severity:"success",icon:i.jsx(ve,{}),"data-id-ref":"item-command-dialog-success-alert",children:n("itemCommandDialog.commandSentSuccessfully")})]})}),i.jsx(F,{}),i.jsxs(O,{sx:{p:2},"data-id-ref":"item-command-dialog-actions",children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),E()},disabled:p,color:"inherit","data-id-ref":"item-command-dialog-cancel-button",children:n(b?"close":"cancel")}),!b&&i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),M()},disabled:!H,variant:"contained",color:"primary",startIcon:p?i.jsx(L,{size:16,color:"inherit"}):i.jsx(je,{}),"data-id-ref":"item-command-dialog-send-button",children:n(p?"itemCommandDialog.sending":"itemCommandDialog.sendCommand")})]})]})},Ha=o(),Ba=({open:e,onClose:a,itemId:r,itemName:o,currentGroupId:s,onSuccess:d})=>{const{t:m}=I(),{language:c}=l(),{state:u}=n(),p=u.groups,[f,x]=t.useState(""),[h,b]=t.useState(!1),[v,j]=t.useState(null),[y,N]=t.useState(!1);Ha.log("MoveItemDialog render",{open:e,itemId:r,itemName:o,currentGroupId:s,groupsCount:p.length});const k=t.useMemo(()=>{const e=new Map;p.forEach(a=>{a.id&&e.set(a.id,a)});const a=t=>{const i=e.get(t);if(!i)return"";const r=e=>"fa"===c?e.nameFa||e.name||"پوشه بدون نام":e.name||e.nameFa||"Unnamed Folder";if(!i.parentId)return r(i);const o=a(i.parentId),n=r(i);return o?`${o} / ${n}`:n};return p.filter(e=>e.id&&e.id!==s).map(e=>({id:e.id,name:e.name||e.nameFa||"Unnamed Folder",nameFa:e.nameFa||e.name||"پوشه بدون نام",fullPath:a(e.id),parentId:e.parentId})).sort((e,a)=>e.fullPath.localeCompare(a.fullPath))},[p,s,c]),G=t.useMemo(()=>{if(!s)return m("moveItemDialog.noCurrentFolder");const e=p.find(e=>e.id===s);return e?"fa"===c?e.nameFa||e.name||m("moveItemDialog.unnamedFolder"):e.name||e.nameFa||m("moveItemDialog.unnamedFolder"):m("moveItemDialog.unknownFolder")},[s,p,m,c]),H=()=>{h||(x(""),j(null),N(!1),a())},B=async()=>{if(f){Ha.log("Moving item to new folder",{itemId:r,itemName:o,fromFolderId:s,toFolderId:f}),b(!0),j(null);try{(await g({pointId:r,parentId:f})).isSuccessful?(Ha.log("Item moved successfully",{itemId:r,toFolderId:f}),N(!0),setTimeout(()=>{d?.(),H()},1e3)):(Ha.error("Move item failed - API returned unsuccessful",{itemId:r}),j(m("moveItemDialog.errors.moveFailed")))}catch(e){Ha.error("Error moving item",e);const a=e,t=a?.response?.data?.message||a?.message||m("moveItemDialog.errors.unknownError");j(t)}finally{b(!1)}}else j(m("moveItemDialog.validation.folderRequired"))};return i.jsxs(C,{open:e,onClose:H,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:{xs:2,sm:3},maxHeight:{xs:"calc(100% - 32px)",sm:"calc(100% - 64px)"}}},"data-id-ref":"move-item-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsx(D,{"data-id-ref":"move-item-dialog-title",sx:{px:{xs:2,sm:3},pt:{xs:2,sm:3}},children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ce,{color:"primary"}),i.jsx(S,{variant:"h6",component:"span",sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:m("moveItemDialog.title")})]})}),i.jsxs(T,{"data-id-ref":"move-item-dialog-content",sx:{px:{xs:2,sm:3}},children:[i.jsxs(w,{mb:2,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:m("moveItemDialog.itemLabel")}),i.jsx(S,{variant:"body1",fontWeight:"medium",sx:{fontSize:{xs:"0.9rem",sm:"1rem"},wordBreak:"break-word"},children:o})]}),i.jsxs(w,{mb:3,children:[i.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:m("moveItemDialog.currentFolderLabel")}),i.jsx(S,{variant:"body1",color:"text.primary",sx:{fontSize:{xs:"0.9rem",sm:"1rem"},wordBreak:"break-word"},children:G})]}),i.jsx(F,{sx:{mb:3}}),i.jsxs(z,{fullWidth:!0,disabled:h,"data-id-ref":"move-item-dialog-folder-select",size:"small",children:[i.jsx(P,{id:"move-item-folder-label",children:m("moveItemDialog.selectFolderLabel")}),i.jsxs(M,{labelId:"move-item-folder-label",value:f,onChange:e=>{x(e.target.value),j(null)},label:m("moveItemDialog.selectFolderLabel"),MenuProps:{PaperProps:{style:{maxHeight:300}}},children:[i.jsx(E,{value:"",disabled:!0,children:i.jsx("em",{children:m("moveItemDialog.selectFolderPlaceholder")})}),k.map(e=>i.jsx(E,{value:e.id,"data-id-ref":`move-item-dialog-folder-option-${e.id}`,children:i.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ue,{fontSize:"small",color:"action"}),i.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"},wordBreak:"break-word"},children:e.fullPath})]})},e.id))]})]}),v&&i.jsx(A,{severity:"error",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-item-dialog-error",children:v}),y&&i.jsx(A,{severity:"success",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-item-dialog-success",children:m("moveItemDialog.success")}),0===k.length&&i.jsx(A,{severity:"info",sx:{mt:2,fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"move-item-dialog-no-folders",children:m("moveItemDialog.noFoldersAvailable")})]}),i.jsxs(O,{"data-id-ref":"move-item-dialog-actions",sx:{px:{xs:2,sm:3},pb:{xs:2,sm:2},gap:1,flexDirection:{xs:"column",sm:"row"},"& > :not(style)":{width:{xs:"100%",sm:"auto"}}},children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),H()},disabled:h,"data-id-ref":"move-item-dialog-cancel-button",fullWidth:!1,sx:{order:{xs:2,sm:1}},children:m("cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),B()},variant:"contained",disabled:h||!f||0===k.length,startIcon:h?i.jsx(L,{size:16}):i.jsx(ce,{}),"data-id-ref":"move-item-dialog-move-button",fullWidth:!1,sx:{order:{xs:1,sm:2}},children:m(h?"moveItemDialog.moving":"moveItemDialog.moveButton")})]})]})},Ra=o(),$a=({open:e,onClose:a,itemId:r,onSuccess:o})=>{const{t:n}=l(),[s,d]=t.useState(!1),[m,c]=t.useState(!1),[u,g]=t.useState(null),[x,h]=t.useState(null),[b,v]=t.useState({}),[j,y]=t.useState(null),[I,k]=t.useState({itemType:1,itemName:"",itemNameFa:"",pointNumber:0,shouldScale:2,rawHigh:0,rawLow:0,scaleHigh:0,scaleLow:0,valueCalculationMethod:0,saveIntervalSeconds:5,saveHistoricalIntervalSeconds:5,numberOfSamples:1,saveOnChange:0,saveOnChangeRange:0,onText:"",onTextFa:"",offText:"",offTextFa:"",unit:"",unitFa:"",isDisabled:!1,isCalibrationEnabled:!1,calibrationA:1,calibrationB:0,interfaceType:0,isEditable:!1}),H=t.useMemo(()=>1===I.itemType||2===I.itemType,[I.itemType]),B=t.useMemo(()=>3===I.itemType||4===I.itemType,[I.itemType]),R=t.useMemo(()=>B&&1===I.shouldScale,[B,I.shouldScale]);t.useEffect(()=>{e&&r&&(async()=>{if(r){d(!0),g(null),Ra.log("Loading item data for itemId:",r);try{const e=await p(r);if(!e.success||!e.data)return g(n("editItemDialog.errors.loadFailed")),void Ra.error("Failed to load item:",e.errorMessage);const a=e.data;y(a),k({itemType:a.itemType,itemName:a.name||"",itemNameFa:a.nameFa||"",pointNumber:a.pointNumber,shouldScale:a.shouldScale,rawHigh:a.normMax||0,rawLow:a.normMin||0,scaleHigh:a.scaleMax||0,scaleLow:a.scaleMin||0,valueCalculationMethod:a.calculationMethod,saveIntervalSeconds:a.saveInterval,saveHistoricalIntervalSeconds:a.saveHistoricalInterval,numberOfSamples:a.numberOfSamples,saveOnChange:a.saveOnChange??0,saveOnChangeRange:a.saveOnChangeRange??0,onText:a.onText||"",onTextFa:a.onTextFa||"",offText:a.offText||"",offTextFa:a.offTextFa||"",unit:a.unit||"",unitFa:a.unitFa||"",isDisabled:a.isDisabled||!1,isCalibrationEnabled:a.isCalibrationEnabled||!1,calibrationA:a.calibrationA??1,calibrationB:a.calibrationB??0,interfaceType:a.interfaceType,isEditable:a.isEditable}),Ra.log("Item data loaded successfully:",a)}catch(e){Ra.error("Error loading item data:",e),g(n("editItemDialog.errors.loadFailed"))}finally{d(!1)}}else Ra.warn("loadItemData: No itemId provided")})()},[e,r,n]);const $=(e,a)=>{k(t=>({...t,[e]:a}))},K=()=>{if(h(null),!I.itemName.trim())return h(n("editItemDialog.errors.itemNameRequired")),!1;if(I.pointNumber<0)return h(n("editItemDialog.errors.invalidPointNumber")),!1;if(I.saveIntervalSeconds<=0)return h(n("editItemDialog.errors.invalidSaveInterval")),!1;if(R){if(I.rawHigh===I.rawLow)return h(n("editItemDialog.errors.invalidRawRange")),!1;if(I.scaleHigh===I.scaleLow)return h(n("editItemDialog.errors.invalidScaleRange")),!1}return!0},q=async()=>{if(r&&K()){c(!0),h(null),v({}),Ra.log("Saving item changes for itemId:",r);try{const e=e=>{const a=e.trim();return a.length>0?a:null},a=e=>null!=e?e:null,t={id:r,itemType:I.itemType,itemName:I.itemName.trim(),itemNameFa:e(I.itemNameFa),pointNumber:I.pointNumber,shouldScale:I.shouldScale,normMin:I.rawLow,normMax:I.rawHigh,scaleMin:I.scaleLow,scaleMax:I.scaleHigh,saveInterval:I.saveIntervalSeconds,saveHistoricalInterval:I.saveHistoricalIntervalSeconds,calculationMethod:I.valueCalculationMethod,numberOfSamples:I.numberOfSamples,saveOnChange:0===I.saveOnChange?null:I.saveOnChange,saveOnChangeRange:a(I.saveOnChangeRange),onText:e(I.onText),onTextFa:e(I.onTextFa),offText:e(I.offText),offTextFa:e(I.offTextFa),unit:e(I.unit),unitFa:e(I.unitFa),isDisabled:I.isDisabled,isCalibrationEnabled:I.isCalibrationEnabled?I.isCalibrationEnabled:null,calibrationA:a(I.calibrationA),calibrationB:a(I.calibrationB),interfaceType:I.interfaceType,isEditable:I.isEditable};Ra.log("Sending edit request with DTO:",t);const i=await f(t);if(!i.success){const e=i.error;let a=n("editItemDialog.errors.saveFailed");if(void 0!==e)switch(e){case Je.InvalidPointNumber:a=n("editItemDialog.errors.invalidPointNumber");break;case Je.DuplicatePointNumber:a=n("editItemDialog.errors.duplicatePointNumber");break;case Je.ValidationError:a=i.message||n("editItemDialog.errors.validationError");break;case Je.Unauthorized:a=n("editItemDialog.errors.unauthorized")}return h(a),void Ra.error("Failed to save item:",i.message,"Error type:",e)}Ra.log("Item saved successfully"),o&&o(),V()}catch(e){Ra.error("Error saving item:",e);const a=e;if(400===a.status&&a.errors){const e={},t={ItemName:"itemName",ItemNameFa:"itemNameFa",PointNumber:"pointNumber",NumberOfSamples:"numberOfSamples",SaveInterval:"saveIntervalSeconds",SaveHistoricalInterval:"saveHistoricalIntervalSeconds",NormMin:"rawLow",NormMax:"rawHigh",ScaleMin:"scaleLow",ScaleMax:"scaleHigh",Unit:"unit",UnitFa:"unitFa",OnText:"onText",OnTextFa:"onTextFa",OffText:"offText",OffTextFa:"offTextFa",CalibrationA:"calibrationA",CalibrationB:"calibrationB",SaveOnChangeRange:"saveOnChangeRange"};Object.keys(a.errors).forEach(i=>{const r=t[i]||i.charAt(0).toLowerCase()+i.slice(1),o=a.errors[i];o&&o.length>0&&(e[r]=o.join(" "))}),v(e),h(n("editItemDialog.errors.validationErrorsFound")),Ra.error("Validation errors:",e)}else h(a.message||n("editItemDialog.errors.saveFailed"))}finally{c(!1)}}},V=()=>{m||(k({itemType:1,itemName:"",itemNameFa:"",pointNumber:0,shouldScale:2,rawHigh:0,rawLow:0,scaleHigh:0,scaleLow:0,valueCalculationMethod:0,saveIntervalSeconds:5,saveHistoricalIntervalSeconds:5,numberOfSamples:1,saveOnChange:0,saveOnChangeRange:0,onText:"",onTextFa:"",offText:"",offTextFa:"",unit:"",unitFa:"",isDisabled:!1,isCalibrationEnabled:!1,calibrationA:1,calibrationB:0,interfaceType:0,isEditable:!1}),y(null),g(null),h(null),v({}),a())};return i.jsxs(C,{open:e,onClose:V,maxWidth:"md",fullWidth:!0,"data-id-ref":"edit-item-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsx(D,{"data-id-ref":"edit-item-dialog-title",children:i.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(S,{variant:"h6",component:"span",children:n("editItemDialog.title")}),i.jsx(Q,{edge:"end",color:"inherit",onClick:V,disabled:m,"aria-label":n("common.close"),"data-id-ref":"edit-item-dialog-close-button",children:i.jsx(be,{"data-id-ref":"edit-item-dialog-close-icon"})})]})}),i.jsxs(T,{dividers:!0,"data-id-ref":"edit-item-dialog-content",children:[s&&i.jsx(w,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},"data-id-ref":"edit-item-dialog-loading-container",children:i.jsx(L,{"data-id-ref":"edit-item-dialog-loading-spinner"})}),u&&i.jsx(A,{severity:"error","data-id-ref":"edit-item-dialog-load-error",children:u}),x&&i.jsx(A,{severity:"error",sx:{mb:2},"data-id-ref":"edit-item-dialog-save-error",children:x}),!s&&!u&&j&&i.jsxs(w,{"data-id-ref":"edit-item-dialog-form",children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"edit-item-dialog-basic-info-heading",children:n("editItemDialog.sections.basicInformation")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,disabled:m,children:[i.jsx(P,{id:"item-type-label",children:n("editItemDialog.fields.itemType")}),i.jsxs(M,{labelId:"item-type-label",value:I.itemType,label:n("editItemDialog.fields.itemType"),onChange:e=>$("itemType",e.target.value),"data-id-ref":"edit-item-dialog-item-type",children:[i.jsx(E,{value:1,children:n("itemCard.itemTypes.digitalInput")}),i.jsx(E,{value:2,children:n("itemCard.itemTypes.digitalOutput")}),i.jsx(E,{value:3,children:n("itemCard.itemTypes.analogInput")}),i.jsx(E,{value:4,children:n("itemCard.itemTypes.analogOutput")})]})]}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.pointNumber"),type:"number",value:I.pointNumber,onChange:e=>$("pointNumber",parseInt(e.target.value)||0),disabled:m,required:!0,error:!!b.pointNumber,helperText:b.pointNumber||"",inputProps:{min:0,max:2147483647},"data-id-ref":"edit-item-dialog-point-number"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,disabled:m,children:[i.jsx(P,{id:"interface-type-label",children:n("editItemDialog.fields.interfaceType")}),i.jsxs(M,{labelId:"interface-type-label",value:I.interfaceType,label:n("editItemDialog.fields.interfaceType"),onChange:e=>$("interfaceType",e.target.value),"data-id-ref":"edit-item-dialog-interface-type",children:[i.jsx(E,{value:0,children:n("editItemDialog.interfaceTypes.none")}),i.jsx(E,{value:1,children:n("editItemDialog.interfaceTypes.sharp7")}),i.jsx(E,{value:2,children:n("editItemDialog.interfaceTypes.bacnet")}),i.jsx(E,{value:3,children:n("editItemDialog.interfaceTypes.modbus")})]})]}),i.jsx(N,{control:i.jsx(Z,{checked:I.isEditable,onChange:e=>$("isEditable",e.target.checked),disabled:m,"data-id-ref":"edit-item-dialog-is-editable-switch"}),label:n("editItemDialog.fields.isEditable"),sx:{flex:1,display:"flex",justifyContent:"flex-start"},"data-id-ref":"edit-item-dialog-is-editable"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.itemName"),value:I.itemName,onChange:e=>$("itemName",e.target.value),disabled:m,required:!0,error:!!b.itemName,helperText:b.itemName||"",inputProps:{maxLength:200},"data-id-ref":"edit-item-dialog-item-name"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.itemNameFa"),value:I.itemNameFa,onChange:e=>$("itemNameFa",e.target.value),disabled:m,error:!!b.itemNameFa,helperText:b.itemNameFa||"",inputProps:{maxLength:200},"data-id-ref":"edit-item-dialog-item-name-fa"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,children:[i.jsx(P,{id:"value-calc-method-label",children:n("editItemDialog.fields.valueCalculationMethod")}),i.jsxs(M,{labelId:"value-calc-method-label",value:I.valueCalculationMethod,label:n("editItemDialog.fields.valueCalculationMethod"),onChange:e=>$("valueCalculationMethod",e.target.value),disabled:m,"data-id-ref":"edit-item-dialog-value-calc-method",children:[i.jsx(E,{value:0,children:n("editItemDialog.valueCalculationMethods.lastValue")}),i.jsx(E,{value:1,children:n("editItemDialog.valueCalculationMethods.average")})]})]}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.numberOfSamples"),type:"number",value:I.numberOfSamples,onChange:e=>$("numberOfSamples",parseInt(e.target.value)||1),disabled:m,required:!0,error:!!b.numberOfSamples,helperText:b.numberOfSamples||"",inputProps:{min:1,max:100},"data-id-ref":"edit-item-dialog-number-of-samples"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.saveIntervalSeconds"),type:"number",value:I.saveIntervalSeconds,onChange:e=>$("saveIntervalSeconds",parseInt(e.target.value)||5),disabled:m,required:!0,error:!!b.saveIntervalSeconds,helperText:b.saveIntervalSeconds||"",inputProps:{min:1,max:3600},"data-id-ref":"edit-item-dialog-save-interval"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.saveHistoricalIntervalSeconds"),type:"number",value:I.saveHistoricalIntervalSeconds,onChange:e=>$("saveHistoricalIntervalSeconds",parseInt(e.target.value)||5),disabled:m,required:!0,error:!!b.saveHistoricalIntervalSeconds,helperText:b.saveHistoricalIntervalSeconds||"",inputProps:{min:1,max:3600},"data-id-ref":"edit-item-dialog-save-historical-interval"})]}),i.jsx(N,{control:i.jsx(Z,{checked:I.isDisabled,onChange:e=>$("isDisabled",e.target.checked),disabled:m,"data-id-ref":"edit-item-dialog-is-disabled-switch"}),label:n("editItemDialog.fields.isDisabled"),"data-id-ref":"edit-item-dialog-is-disabled"})]}),i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"edit-item-dialog-advanced-settings-heading",children:n("editItemDialog.sections.advancedSettings")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(z,{fullWidth:!0,disabled:m,children:[i.jsx(P,{id:"save-on-change-label",children:n("editItemDialog.fields.saveOnChange")}),i.jsxs(M,{labelId:"save-on-change-label",id:"save-on-change",value:I.saveOnChange,label:n("editItemDialog.fields.saveOnChange"),onChange:e=>$("saveOnChange",e.target.value),"data-id-ref":"edit-item-dialog-save-on-change",children:[i.jsx(E,{value:0,children:n("editItemDialog.saveOnChangeOptions.default")}),i.jsx(E,{value:1,children:n("editItemDialog.saveOnChangeOptions.on")}),i.jsx(E,{value:2,children:n("editItemDialog.saveOnChangeOptions.off")})]})]}),1===I.saveOnChange&&i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.saveOnChangeRange"),type:"number",value:I.saveOnChangeRange,onChange:e=>$("saveOnChangeRange",parseFloat(e.target.value)||0),disabled:m,error:!!b.saveOnChangeRange,helperText:b.saveOnChangeRange||n("editItemDialog.fields.saveOnChangeRangeHelper"),inputProps:{min:0,step:.1},"data-id-ref":"edit-item-dialog-save-on-change-range"}),i.jsx(N,{control:i.jsx(Z,{checked:I.isCalibrationEnabled,onChange:e=>$("isCalibrationEnabled",e.target.checked),disabled:m,"data-id-ref":"edit-item-dialog-is-calibration-enabled-switch"}),label:n("editItemDialog.fields.isCalibrationEnabled"),"data-id-ref":"edit-item-dialog-is-calibration-enabled"}),I.isCalibrationEnabled&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"edit-item-dialog-calibration-formula",children:n("editItemDialog.fields.calibrationFormula")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.calibrationA"),type:"number",value:I.calibrationA,onChange:e=>$("calibrationA",parseFloat(e.target.value)||1),disabled:m,error:!!b.calibrationA,helperText:b.calibrationA||n("editItemDialog.fields.calibrationAHelper"),inputProps:{step:.01},"data-id-ref":"edit-item-dialog-calibration-a"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.calibrationB"),type:"number",value:I.calibrationB,onChange:e=>$("calibrationB",parseFloat(e.target.value)||0),disabled:m,error:!!b.calibrationB,helperText:b.calibrationB||n("editItemDialog.fields.calibrationBHelper"),inputProps:{step:.01},"data-id-ref":"edit-item-dialog-calibration-b"})]})]})]}),H&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"edit-item-dialog-digital-fields-heading",children:n("editItemDialog.sections.digitalFields")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.onText"),value:I.onText,onChange:e=>$("onText",e.target.value),disabled:m,error:!!b.onText,helperText:b.onText||"",inputProps:{maxLength:50},"data-id-ref":"edit-item-dialog-on-text"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.onTextFa"),value:I.onTextFa,onChange:e=>$("onTextFa",e.target.value),disabled:m,error:!!b.onTextFa,helperText:b.onTextFa||"",inputProps:{maxLength:50},"data-id-ref":"edit-item-dialog-on-text-fa"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.offText"),value:I.offText,onChange:e=>$("offText",e.target.value),disabled:m,error:!!b.offText,helperText:b.offText||"",inputProps:{maxLength:50},"data-id-ref":"edit-item-dialog-off-text"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.offTextFa"),value:I.offTextFa,onChange:e=>$("offTextFa",e.target.value),disabled:m,error:!!b.offTextFa,helperText:b.offTextFa||"",inputProps:{maxLength:50},"data-id-ref":"edit-item-dialog-off-text-fa"})]})]})]}),B&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"edit-item-dialog-analog-fields-heading",children:n("editItemDialog.sections.analogFields")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.unit"),value:I.unit,onChange:e=>$("unit",e.target.value),disabled:m,error:!!b.unit,helperText:b.unit||"",inputProps:{maxLength:20},"data-id-ref":"edit-item-dialog-unit"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.unitFa"),value:I.unitFa,onChange:e=>$("unitFa",e.target.value),disabled:m,error:!!b.unitFa,helperText:b.unitFa||"",inputProps:{maxLength:20},"data-id-ref":"edit-item-dialog-unit-fa"})]}),i.jsx(N,{control:i.jsx(Z,{checked:1===I.shouldScale,onChange:e=>$("shouldScale",e.target.checked?1:2),disabled:m,"data-id-ref":"edit-item-dialog-should-scale-switch"}),label:n("editItemDialog.fields.shouldScale"),"data-id-ref":"edit-item-dialog-should-scale"}),R&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"edit-item-dialog-raw-range-label",children:n("editItemDialog.sections.rawRange")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.rawLow"),type:"number",value:I.rawLow,onChange:e=>$("rawLow",parseFloat(e.target.value)||0),disabled:m,error:!!b.rawLow,helperText:b.rawLow||"","data-id-ref":"edit-item-dialog-raw-low"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.rawHigh"),type:"number",value:I.rawHigh,onChange:e=>$("rawHigh",parseFloat(e.target.value)||0),disabled:m,error:!!b.rawHigh,helperText:b.rawHigh||"","data-id-ref":"edit-item-dialog-raw-high"})]}),i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"edit-item-dialog-scale-range-label",children:n("editItemDialog.sections.scaleRange")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.scaleLow"),type:"number",value:I.scaleLow,onChange:e=>$("scaleLow",parseFloat(e.target.value)||0),disabled:m,error:!!b.scaleLow,helperText:b.scaleLow||"","data-id-ref":"edit-item-dialog-scale-low"}),i.jsx(G,{fullWidth:!0,label:n("editItemDialog.fields.scaleHigh"),type:"number",value:I.scaleHigh,onChange:e=>$("scaleHigh",parseFloat(e.target.value)||0),disabled:m,error:!!b.scaleHigh,helperText:b.scaleHigh||"","data-id-ref":"edit-item-dialog-scale-high"})]})]})]})]})]})]}),i.jsxs(O,{"data-id-ref":"edit-item-dialog-actions",children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),V()},disabled:m,"data-id-ref":"edit-item-dialog-cancel-button",children:n("common.cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),q()},variant:"contained",disabled:s||m||!!u,"data-id-ref":"edit-item-dialog-save-button",children:n(m?"common.saving":"common.save")})]})]})},Ka=({anchorEl:e,open:a,onClose:t,alarms:r,itemName:o})=>{const{t:n}=I(),{language:s}=l(),d=(e,a)=>{if(a){const e=new Date(a);return"fa"===s?new Intl.DateTimeFormat("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}const t=new Date(1e3*e);return"fa"===s?new Intl.DateTimeFormat("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)},m=e=>2===e?"error":"warning";return 0===r.length?null:i.jsx(ee,{open:a,anchorEl:e,onClose:t,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},disableRestoreFocus:!0,disableAutoFocus:!0,disableEnforceFocus:!0,sx:{pointerEvents:"none"},slotProps:{paper:{sx:{pointerEvents:"auto",maxWidth:450,minWidth:320,borderRadius:2,boxShadow:e=>e.shadows[8],overflow:"hidden"}}},"data-id-ref":"alarm-badge-popover","aria-hidden":!a,children:i.jsxs(ae,{elevation:0,"data-id-ref":"alarm-badge-popover-paper",children:[i.jsx(w,{sx:{background:e=>`linear-gradient(135deg, ${te(e.palette.error.main,.1)} 0%, ${te(e.palette.warning.main,.1)} 100%)`,px:2.5,py:2,borderBottom:1,borderColor:"divider"},"data-id-ref":"alarm-badge-popover-header",children:i.jsxs(V,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(ye,{sx:{color:"error.main",fontSize:28,animation:"alarm-icon-pulse 2s ease-in-out infinite","@keyframes alarm-icon-pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.1)"}}},"data-id-ref":"alarm-badge-popover-header-icon"}),i.jsxs(w,{sx:{flex:1},children:[i.jsx(S,{variant:"subtitle1",fontWeight:600,"data-id-ref":"alarm-badge-popover-header-title",children:n("alarmBadgePopover.title")}),o&&i.jsx(S,{variant:"body2",color:"text.secondary",sx:{mt:.25},"data-id-ref":"alarm-badge-popover-header-item-name",children:o})]}),i.jsx(U,{label:r.length,size:"small",color:"error",sx:{fontWeight:700,minWidth:32},"data-id-ref":"alarm-badge-popover-header-count"})]})}),i.jsx(w,{sx:{maxHeight:400,overflowY:"auto",overflowX:"hidden"},"data-id-ref":"alarm-badge-popover-content",children:i.jsx(V,{divider:i.jsx(F,{}),spacing:0,children:r.map((e,a)=>{const t="fa"===s&&e.messageFa?e.messageFa:e.message||n("alarmBadgePopover.noMessage");return i.jsx(w,{sx:{px:2.5,py:2,transition:"all 0.2s ease","&:hover":{backgroundColor:e=>te(e.palette.primary.main,.04)}},"data-id-ref":`alarm-badge-popover-alarm-${a}`,children:i.jsxs(V,{spacing:1.5,children:[i.jsx(w,{sx:{display:"flex",alignItems:"center",gap:1},children:i.jsx(U,{icon:i.jsx(Ie,{sx:{fontSize:14}}),label:(r=e.priority,n(2===r?"itemCard.highPriorityAlarm":"itemCard.lowPriorityAlarm")),size:"small",color:m(e.priority),sx:{fontWeight:600},"data-id-ref":`alarm-badge-popover-alarm-${a}-priority`})}),i.jsx(S,{variant:"body2",sx:{color:"text.primary",lineHeight:1.6,wordBreak:"break-word"},"data-id-ref":`alarm-badge-popover-alarm-${a}-message`,children:t}),i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:.75},children:[i.jsx(Ce,{sx:{fontSize:16,color:"text.secondary"},"data-id-ref":`alarm-badge-popover-alarm-${a}-time-icon`}),i.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},"data-id-ref":`alarm-badge-popover-alarm-${a}-time`,children:d(e.activatedAt,e.dateTime)})]})]})},e.alarmId||a);var r})})})]})})},qa=o(),Va=t.lazy(()=>Ye(()=>import("./ItemModbusMappingsDialog-C2ge8Q5Y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Ua=t.lazy(()=>Ye(()=>import("./ItemSharp7MappingsDialog-B0dQDnOG.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Xa=e=>{switch(e){case Qe.Sharp7:return{short:"S",translationKey:"itemCard.interfaceTypes.sharp7",color:"info"};case Qe.BACnet:return{short:"B",translationKey:"itemCard.interfaceTypes.bacnet",color:"success"};case Qe.Modbus:return{short:"M",translationKey:"itemCard.interfaceTypes.modbus",color:"warning"};case Qe.None:default:return{short:"N",translationKey:"itemCard.interfaceTypes.none",color:"default"}}},_a=e=>{switch(e){case Ze.DigitalInput:return{icon:i.jsx(Pe,{sx:{fontSize:14},"data-id-ref":"item-card-item-type-icon-digital-input"}),translationKey:"itemCard.itemTypes.digitalInput",color:"primary"};case Ze.DigitalOutput:return{icon:i.jsx(Ae,{sx:{fontSize:14},"data-id-ref":"item-card-item-type-icon-digital-output"}),translationKey:"itemCard.itemTypes.digitalOutput",color:"secondary"};case Ze.AnalogInput:return{icon:i.jsx(Ee,{sx:{fontSize:14},"data-id-ref":"item-card-item-type-icon-analog-input"}),translationKey:"itemCard.itemTypes.analogInput",color:"success"};case Ze.AnalogOutput:return{icon:i.jsx(Me,{sx:{fontSize:14},"data-id-ref":"item-card-item-type-icon-analog-output"}),translationKey:"itemCard.itemTypes.analogOutput",color:"warning"};default:return{icon:i.jsx(Pe,{sx:{fontSize:14},"data-id-ref":"item-card-item-type-icon-default"}),translationKey:"itemCard.itemTypes.digitalInput",color:"default"}}},Ya=r.memo(({itemId:e,name:a,pointNumber:o,value:l,time:s,valueHistory:d=[],item:m,isLoadingValue:u=!1})=>{const{t:g}=I(),{user:p}=c(),{fetchGroups:f,fetchItems:h}=n(),b=Ea(),v=ta(),j=ie(),y=re(j.breakpoints.down("md")),[N,k]=t.useState(3),[z,P]=t.useState(!1),[M,A]=t.useState(!1),[L,G]=t.useState(null),[H,$]=t.useState(null),[q,Z]=t.useState(!1),[J,ee]=t.useState(!1),[ae,te]=t.useState(null),[le,se]=t.useState(!1),[de,me]=t.useState(!1),[ue,pe]=t.useState(!1),[fe,xe]=t.useState(!1),ve=t.useMemo(()=>!(!p||!p.roles)&&p.roles.map(e=>e.toLowerCase()).includes("admin"),[p]),{hasAlarm:je,alarmPriority:Ie,alarms:Ce,isChecking:Pe}=Oa({itemId:e});qa.log("ItemCard render",{itemId:e,name:a,historyLength:d.length,hasAlarm:je,alarmPriority:Ie,alarmCount:Ce.length,isChecking:Pe,isAdmin:ve});const Me=t.useMemo(()=>Wa("trend-analysis",{itemId:e}),[e]),Ee=t.useMemo(()=>{if(!d||d.length<2)return"stable";const e=d[d.length-1].value,a=d[d.length-2].value;return e>a?"up":e<a?"down":"stable"},[d]),Ae=r.useCallback(()=>{try{if(y){const e=Me.replace(window.location.origin,"");v(e)}else window.open(Me,"_blank")}catch(e){qa.warn("Could not open tab",e)}},[y,Me,v]),We=r.useCallback(()=>{b(Me)},[b,Me]),Le=r.useCallback(()=>{d&&d.length>1?(qa.log(`Opening history modal for item: ${a}`,{historyLength:d.length}),P(!0)):qa.warn("Cannot open history: insufficient data",{historyLength:d?.length||0})},[d,a]),Ge=()=>{qa.log(`Opening command dialog for editable item: ${a}`,{itemId:e,itemType:m?.itemType}),A(!0)},He=()=>{te(null)},Be=Boolean(ae),Re=()=>{qa.log("Closing admin menu"),G(null),$(null)},$e=()=>{qa.log("Delete confirmation dialog closed"),se(!1)},Ke=async()=>{qa.log("Item updated successfully, refreshing data",{itemId:e,itemName:a});try{await Promise.all([f(),h()]),qa.log("Data refreshed successfully")}catch(t){qa.error("Failed to refresh data after item update",t)}};return i.jsxs(i.Fragment,{children:[i.jsx(B,{in:!0,timeout:300,children:i.jsx(R,{elevation:N,onMouseEnter:()=>k(8),onMouseLeave:()=>k(3),onContextMenu:t=>{if(t.preventDefault(),t.stopPropagation(),!ve)return;const i=t.clientX,r=t.clientY,o=t.currentTarget;null!==L?(qa.log("Closing existing admin menu before opening new one"),G(null),$(null),requestAnimationFrame(()=>{requestAnimationFrame(()=>{qa.log("Opening admin menu at new position",{itemId:e,itemName:a,x:i,y:r}),G(o),$({top:r,left:i})})})):(qa.log("Opening admin menu via right-click",{itemId:e,itemName:a,x:i,y:r}),G(o),$({top:r,left:i}))},sx:{height:"100%",position:"relative",overflow:"visible",border:"1px solid",borderColor:"divider",transition:"box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1)",...ve&&{cursor:"context-menu"},...je&&{borderWidth:2,borderStyle:"solid",borderColor:2===Ie?"error.main":"warning.main",boxShadow:2===Ie?e=>`0 0 0 2px ${e.palette.error.main}40, 0 0 20px ${e.palette.error.main}30`:e=>`0 0 0 2px ${e.palette.warning.main}40, 0 0 20px ${e.palette.warning.main}30`,animation:"alarm-pulse 2s ease-in-out infinite","@keyframes alarm-pulse":{"0%, 100%":{boxShadow:2===Ie?e=>`0 0 0 2px ${e.palette.error.main}40, 0 0 20px ${e.palette.error.main}30`:e=>`0 0 0 2px ${e.palette.warning.main}40, 0 0 20px ${e.palette.warning.main}30`},"50%":{boxShadow:2===Ie?e=>`0 0 0 4px ${e.palette.error.main}60, 0 0 30px ${e.palette.error.main}50`:e=>`0 0 0 4px ${e.palette.warning.main}60, 0 0 30px ${e.palette.warning.main}50`}}}},"data-id-ref":"item-card-root-container",children:i.jsxs(K,{sx:{display:"flex",flexDirection:"column",height:"100%",padding:2,"&:last-child":{paddingBottom:2}},children:[i.jsxs(w,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"flex-start",md:"center"},gap:{xs:1.5,sm:1.5,md:1},marginBottom:1.5},"data-id-ref":"item-card-header",children:[i.jsxs(w,{sx:{display:"flex",alignItems:"flex-start",gap:1,width:{xs:"100%",sm:"100%",md:"auto"},flex:{xs:"none",sm:"none",md:1}},children:[i.jsx(S,{variant:"h6",component:"h6",sx:{fontWeight:600,wordBreak:"break-word",lineHeight:1.4,flex:1,fontSize:{xs:"0.95rem",sm:"1rem"}},"data-id-ref":"item-card-title",children:a}),i.jsxs(w,{sx:{display:{xs:"flex",sm:"flex",md:"none"},alignItems:"center",gap:.5,flexShrink:0},children:[m?.isEditable&&i.jsx(oe,{title:g("itemCard.setCommand"),arrow:!0,placement:"top",children:i.jsx(Q,{onClick:Ge,"aria-label":g("itemCard.setCommand"),size:"small",sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"warning.main",transform:"scale(1.1)"}},"data-id-ref":"item-card-command-button",children:i.jsx(he,{fontSize:"small","data-id-ref":"item-card-command-icon"})})}),i.jsx(oe,{title:g(y?"openDetails":"openInNewTab"),arrow:!0,placement:"top",children:i.jsx(Q,{onClick:Ae,onMouseEnter:We,"aria-label":g(y?"openDetails":"openInNewTab"),size:"small",sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"}},"data-id-ref":"item-card-open-new-tab-button",children:i.jsx(De,{fontSize:"small","data-id-ref":"item-card-open-icon"})})})]})]}),i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",width:{xs:"100%",sm:"100%",md:"auto"}},children:[void 0!==m?.itemType&&(()=>{const e=_a(m.itemType),a=g(e.translationKey);return i.jsx(oe,{title:a,arrow:!0,placement:"top",children:i.jsx(U,{icon:e.icon,size:"small",color:e.color,variant:"outlined",sx:{height:24,fontWeight:600,fontSize:"0.75rem",borderRadius:1,"& .MuiChip-icon":{marginInlineStart:1,marginInlineEnd:-.5}},"data-id-ref":"item-card-item-type-indicator"})})})(),void 0!==m?.interfaceType&&(()=>{const e=Xa(m.interfaceType),a=g(e.translationKey);return i.jsx(oe,{title:a,arrow:!0,placement:"top",children:i.jsx(U,{label:e.short,size:"small",color:e.color,variant:"filled",sx:{minWidth:32,height:24,fontWeight:600,fontSize:"0.75rem",borderRadius:1},"data-id-ref":"item-card-interface-type-indicator"})})})(),void 0!==m?.isEditable&&(()=>{const e=m.isEditable?{icon:i.jsx(ge,{sx:{fontSize:14},"data-id-ref":"item-card-editable-status-icon-editable"}),translationKey:"itemCard.editableStatus.editable",color:"info"}:{icon:i.jsx(Oe,{sx:{fontSize:14},"data-id-ref":"item-card-editable-status-icon-readonly"}),translationKey:"itemCard.editableStatus.readOnly",color:"default"},a=g(e.translationKey);return i.jsx(oe,{title:a,arrow:!0,placement:"top",children:i.jsx(U,{icon:e.icon,size:"small",color:e.color,variant:"outlined",sx:{height:24,fontWeight:600,fontSize:"0.75rem",borderRadius:1,"& .MuiChip-icon":{marginInlineStart:1,marginInlineEnd:-.5}},"data-id-ref":"item-card-editable-status-indicator"})})})(),je&&i.jsx(ne,{in:!0,timeout:300,children:i.jsx(U,{icon:i.jsx(ye,{sx:{fontSize:16},"data-id-ref":"item-card-alarm-badge-icon"}),label:g(2===Ie?"itemCard.highPriorityAlarm":"itemCard.lowPriorityAlarm"),size:"small",color:2===Ie?"error":"warning",onMouseEnter:e=>{je&&Ce.length>0&&te(e.currentTarget)},onMouseLeave:He,sx:{fontWeight:600,animation:"alarm-badge-pulse 2s ease-in-out infinite",cursor:"default","@keyframes alarm-badge-pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}}},"data-id-ref":"item-card-alarm-badge"})}),i.jsxs(w,{sx:{display:{xs:"none",sm:"none",md:"flex"},alignItems:"center",gap:.5,marginInlineStart:"auto"},children:[m?.isEditable&&i.jsx(oe,{title:g("itemCard.setCommand"),arrow:!0,placement:"top",children:i.jsx(Q,{onClick:Ge,"aria-label":g("itemCard.setCommand"),size:"small",sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"warning.main",transform:"scale(1.1)"}},"data-id-ref":"item-card-command-button-desktop",children:i.jsx(he,{fontSize:"small","data-id-ref":"item-card-command-icon-desktop"})})}),i.jsx(oe,{title:g(y?"openDetails":"openInNewTab"),arrow:!0,placement:"top",children:i.jsx(Q,{onClick:Ae,onMouseEnter:We,"aria-label":g(y?"openDetails":"openInNewTab"),size:"small",sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"}},"data-id-ref":"item-card-open-new-tab-button-desktop",children:i.jsx(De,{fontSize:"small","data-id-ref":"item-card-open-icon-desktop"})})})]})]})]}),i.jsx(F,{sx:{marginBottom:1.5},"data-id-ref":"item-card-header-divider"}),i.jsxs(V,{spacing:{xs:.75,sm:1},sx:{flex:1},"data-id-ref":"item-card-body",children:[i.jsxs(w,{sx:{display:"flex",alignItems:"baseline",gap:1},"data-id-ref":"item-card-row-point-number",children:[i.jsxs(S,{variant:"body2",component:"span",sx:{fontWeight:600,whiteSpace:"nowrap",color:"text.primary",fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"item-card-label-point-number",children:[g("pointNumber"),":"]}),i.jsx(S,{variant:"body2",component:"span",sx:{color:"text.secondary",wordBreak:"break-word",fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"item-card-value-point-number",children:o})]}),i.jsxs(w,{sx:{display:"flex",alignItems:"baseline",gap:1},"data-id-ref":"item-card-row-value",children:[i.jsxs(S,{variant:"body2",component:"span",sx:{fontWeight:600,whiteSpace:"nowrap",color:"text.primary",fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"item-card-label-value",children:[g("value"),":"]}),i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:.5,flex:1,flexWrap:"wrap"},children:[i.jsx(S,{variant:"body2",component:"span",sx:{color:"text.secondary",wordBreak:"break-word",fontSize:{xs:"0.8rem",sm:"0.875rem"},...u&&{animation:"value-loading-pulse 1.5s ease-in-out infinite","@keyframes value-loading-pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:1}}}},"data-id-ref":"item-card-value-value",children:l}),d&&d.length>=2&&(()=>{const e=Ee;return"up"===e?i.jsx(oe,{title:g("activeAlarmsPage.trendIncreasing"),arrow:!0,children:i.jsx(we,{sx:{fontSize:{xs:14,sm:16},color:"error.main"},"data-id-ref":"item-card-trend-up-icon"})}):"down"===e?i.jsx(oe,{title:g("activeAlarmsPage.trendDecreasing"),arrow:!0,children:i.jsx(Se,{sx:{fontSize:{xs:14,sm:16},color:"success.main"},"data-id-ref":"item-card-trend-down-icon"})}):d.length>=2?i.jsx(oe,{title:g("activeAlarmsPage.trendStable"),arrow:!0,children:i.jsx(Te,{sx:{fontSize:{xs:14,sm:16},color:"text.disabled"},"data-id-ref":"item-card-trend-flat-icon"})}):null})(),d&&d.length>1&&i.jsx(oe,{title:g("activeAlarmsPage.viewHistory"),arrow:!0,children:i.jsx(Q,{size:"small",sx:{p:0,ml:.5},onClick:Le,"data-id-ref":"value-history-icon",children:i.jsx(Fe,{sx:{fontSize:{xs:14,sm:16},color:"info.main"},"data-id-ref":"value-history-timeline-icon"})})})]})]}),i.jsxs(w,{sx:{display:"flex",alignItems:"baseline",gap:1},"data-id-ref":"item-card-row-time",children:[i.jsxs(S,{variant:"body2",component:"span",sx:{fontWeight:600,whiteSpace:"nowrap",color:"text.primary",fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"item-card-label-time",children:[g("time"),":"]}),i.jsx(S,{variant:"body2",component:"span",sx:{color:"text.secondary",wordBreak:"break-word",fontSize:{xs:"0.8rem",sm:"0.875rem"}},"data-id-ref":"item-card-value-time",children:s})]})]})]})})}),i.jsxs(C,{open:z,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,fullScreen:!1,sx:{"& .MuiDialog-paper":{margin:{xs:2,sm:3},maxHeight:{xs:"calc(100% - 32px)",sm:"calc(100% - 64px)"}}},"data-id-ref":"item-card-history-modal",children:[i.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,px:{xs:2,sm:3},pt:{xs:2,sm:3}},"data-id-ref":"item-card-history-modal-title",children:[i.jsx(S,{variant:"h6",component:"span",sx:{fontSize:{xs:"1rem",sm:"1.25rem"},pr:2},"data-id-ref":"item-card-history-modal-title-text",children:g("activeAlarmsPage.historyModalTitle",{itemName:a})}),i.jsx(Q,{edge:"end",color:"inherit",onClick:()=>P(!1),"aria-label":g("cancel"),size:"small","data-id-ref":"item-card-history-modal-close-button",children:i.jsx(be,{"data-id-ref":"item-card-history-modal-close-icon"})})]}),i.jsx(F,{}),i.jsx(T,{sx:{pt:2,pb:2,px:{xs:2,sm:3}},"data-id-ref":"item-card-history-modal-content",children:i.jsx(w,{sx:{width:"100%",height:{xs:300,sm:400,md:500},display:"flex",alignItems:"center",justifyContent:"center"},"data-id-ref":"item-card-history-chart-container",children:d&&d.length>1&&m?i.jsx(aa,{history:d,item:m,itemName:a,height:"100%",width:"100%","data-id-ref":"item-card-history-chart"}):i.jsx(S,{color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},"data-id-ref":"item-card-history-no-data",children:g("activeAlarmsPage.noHistoryData")})})}),i.jsx(F,{}),i.jsx(O,{sx:{p:{xs:2,sm:2}},"data-id-ref":"item-card-history-modal-actions",children:i.jsx(W,{onClick:()=>P(!1),variant:"contained",fullWidth:!1,sx:{minWidth:{xs:80,sm:100}},"data-id-ref":"item-card-history-modal-close-action-button",children:g("cancel")})})]}),m&&i.jsx(Ga,{open:M,onClose:()=>A(!1),item:m,onCommandSent:(e,t)=>{qa.log("Command sent successfully from ItemCard",{itemId:e,value:t,itemName:a})}}),i.jsxs(X,{open:Boolean(L)&&null!==H,onClose:Re,anchorReference:"anchorPosition",anchorPosition:null!==H?{top:H.top,left:H.left}:void 0,MenuListProps:{onContextMenu:e=>{e.preventDefault(),e.stopPropagation()}},"data-id-ref":"item-card-admin-menu",children:[i.jsxs(E,{onClick:()=>{qa.log("Opening move item dialog",{itemId:e,itemName:a}),Re(),Z(!0)},"data-id-ref":"item-card-admin-menu-move-item",children:[i.jsx(_,{children:i.jsx(ce,{fontSize:"small","data-id-ref":"item-card-admin-menu-move-item-icon"})}),i.jsx(Y,{primary:g("itemCard.adminMenu.moveItemToGroup")})]}),i.jsxs(E,{onClick:()=>{qa.log("Opening edit item dialog",{itemId:e,itemName:a}),Re(),ee(!0)},"data-id-ref":"item-card-admin-menu-edit-point",children:[i.jsx(_,{children:i.jsx(ge,{fontSize:"small","data-id-ref":"item-card-admin-menu-edit-point-icon"})}),i.jsx(Y,{primary:g("itemCard.adminMenu.editPoint")})]}),i.jsxs(E,{onClick:()=>{qa.log("Delete point clicked",{itemId:e,itemName:a}),Re(),se(!0)},"data-id-ref":"item-card-admin-menu-delete-point",children:[i.jsx(_,{children:i.jsx(Ne,{fontSize:"small","data-id-ref":"item-card-admin-menu-delete-point-icon"})}),i.jsx(Y,{primary:g("itemCard.adminMenu.deletePoint")})]}),m?.interfaceType===Qe.Modbus&&i.jsxs(E,{onClick:()=>{qa.log("Opening Modbus mappings dialog",{itemId:e,itemName:a}),Re(),pe(!0)},"data-id-ref":"item-card-admin-menu-modbus-mappings",children:[i.jsx(_,{children:i.jsx(ke,{fontSize:"small","data-id-ref":"item-card-admin-menu-modbus-mappings-icon"})}),i.jsx(Y,{primary:g("itemCard.adminMenu.manageModbusMappings")})]}),m?.interfaceType===Qe.Sharp7&&i.jsxs(E,{onClick:()=>{qa.log("Opening Sharp7 mappings dialog",{itemId:e,itemName:a}),Re(),xe(!0)},"data-id-ref":"item-card-admin-menu-sharp7-mappings",children:[i.jsx(_,{children:i.jsx(ze,{fontSize:"small","data-id-ref":"item-card-admin-menu-sharp7-mappings-icon"})}),i.jsx(Y,{primary:g("itemCard.adminMenu.manageSharp7Mappings")})]})]}),i.jsx(Ba,{open:q,onClose:()=>Z(!1),itemId:e,itemName:a,currentGroupId:m?.groupId,onSuccess:Ke,"data-id-ref":"item-card-move-item-dialog"}),i.jsx($a,{open:J,onClose:()=>ee(!1),itemId:e,onSuccess:Ke,"data-id-ref":"item-card-edit-item-dialog"}),i.jsx(Ka,{anchorEl:ae,open:Be,onClose:He,alarms:Ce.map(e=>({alarmId:e.alarmId,priority:e.priority,message:e.message,messageFa:e.messageFa,activatedAt:e.activatedAt,dateTime:e.dateTime})),itemName:a}),i.jsxs(C,{open:le,onClose:$e,"data-id-ref":"item-card-delete-confirm-dialog",children:[i.jsx(D,{"data-id-ref":"item-card-delete-confirm-title",children:g("itemCard.deleteConfirm.title")}),i.jsxs(T,{"data-id-ref":"item-card-delete-confirm-content",children:[i.jsx(S,{"data-id-ref":"item-card-delete-confirm-message",children:g("itemCard.deleteConfirm.message")}),i.jsxs(S,{variant:"body2",color:"text.secondary",sx:{mt:1},"data-id-ref":"item-card-delete-confirm-item-name",children:[i.jsxs("strong",{children:[g("itemCard.deleteConfirm.itemName"),":"]})," ",a]})]}),i.jsxs(O,{"data-id-ref":"item-card-delete-confirm-actions",children:[i.jsx(W,{onClick:$e,disabled:de,"data-id-ref":"item-card-delete-confirm-cancel-button",children:g("common.cancel")}),i.jsx(W,{onClick:async()=>{qa.log("Confirming deletion",{itemId:e,itemName:a}),me(!0);try{const t=await x({id:e});t.isSuccess?(qa.log("Point deleted successfully",{itemId:e,itemName:a}),se(!1),await Ke()):qa.error("Failed to delete point - backend returned isSuccess=false",{itemId:e,itemName:a,response:t})}catch(t){qa.error("Error deleting point - exception caught:",{itemId:e,itemName:a,error:t,errorMessage:t instanceof Error?t.message:"Unknown error",errorStack:t instanceof Error?t.stack:void 0})}finally{me(!1)}},color:"error",variant:"contained",disabled:de,"data-id-ref":"item-card-delete-confirm-delete-button",children:g(de?"common.deleting":"common.delete")})]})]}),i.jsx(t.Suspense,{fallback:null,children:ue&&m&&i.jsx(Va,{open:ue,item:m,onClose:()=>pe(!1)})}),i.jsx(t.Suspense,{fallback:null,children:fe&&m&&i.jsx(Ua,{open:fe,item:m,onClose:()=>xe(!1)})})]})}),Za=o(),Ja=({open:e,onClose:a,onSuccess:r,parentId:o})=>{const{t:n}=l(),[s,d]=t.useState(""),[m,c]=t.useState(""),[u,g]=t.useState(!1),[p,f]=t.useState(null);t.useEffect(()=>{e&&(d(""),c(""),f(null),g(!1))},[e]);const x=async()=>{if(s&&0!==s.trim().length)if(s.length>100)f(n("addGroupDialog.errors.nameTooLong"));else{g(!0),f(null);try{const e={name:s.trim(),nameFa:m.trim()||null,parentId:o||null};Za.log("Submitting add group request",{requestDto:e});const t=await h(e);if(Za.log("Add group response received",{response:t}),t.success&&t.groupId)Za.log("Group created successfully",{groupId:t.groupId}),r&&r(t.groupId),a();else{const e=b(t.error,t.message);Za.error("Add group failed",{error:t.error,message:t.message}),f(e)}}catch(e){Za.error("Add group request failed",{error:e}),f(n("addGroupDialog.errors.requestFailed"))}finally{g(!1)}}else f(n("addGroupDialog.errors.nameRequired"))},b=(e,a)=>{if(a)return a;switch(e){case 1:return n("addGroupDialog.errors.invalidName");case 2:return n("addGroupDialog.errors.duplicateName");case 3:return n("addGroupDialog.errors.parentNotFound");default:return n("addGroupDialog.errors.unknownError")}},v=()=>{u||a()},j=e=>{"Enter"!==e.key||u||(e.preventDefault(),x())};return i.jsxs(C,{open:e,onClose:v,maxWidth:"sm",fullWidth:!0,"data-id-ref":"add-group-dialog",children:[i.jsx(D,{"data-id-ref":"add-group-dialog-title",children:n("addGroupDialog.title")}),i.jsx(T,{"data-id-ref":"add-group-dialog-content",children:i.jsxs(w,{sx:{pt:1},"data-id-ref":"add-group-dialog-form",children:[p&&i.jsx(A,{severity:"error",sx:{mb:2},"data-id-ref":"add-group-dialog-error-alert",children:p}),i.jsx(G,{autoFocus:!0,fullWidth:!0,label:n("addGroupDialog.folderNameLabel"),value:s,onChange:e=>d(e.target.value),onKeyPress:j,disabled:u,error:Boolean(p),inputProps:{maxLength:100},helperText:n("addGroupDialog.folderNameHelperText"),"data-id-ref":"add-group-dialog-name-input",sx:{mb:2}}),i.jsx(G,{fullWidth:!0,label:n("addGroupDialog.folderNameFaLabel"),value:m,onChange:e=>c(e.target.value),onKeyPress:j,disabled:u,inputProps:{maxLength:100},helperText:n("addGroupDialog.folderNameFaHelperText"),"data-id-ref":"add-group-dialog-name-fa-input"})]})}),i.jsxs(O,{"data-id-ref":"add-group-dialog-actions",children:[i.jsx(W,{onClick:v,disabled:u,"data-id-ref":"add-group-dialog-cancel-button",children:n("common.cancel")}),i.jsx(W,{onClick:x,variant:"contained",disabled:u,startIcon:u?i.jsx(L,{size:16}):null,"data-id-ref":"add-group-dialog-submit-button",children:n(u?"common.creating":"common.create")})]})]})},Qa=o(),et=({open:e,onClose:a,parentGroupId:r,onSuccess:o})=>{const{t:n}=l(),[s,d]=t.useState(!1),[m,c]=t.useState(null),[u,g]=t.useState({}),[p,f]=t.useState(!1),[x,h]=t.useState({itemType:1,itemName:"",itemNameFa:"",pointNumber:0,shouldScale:2,rawHigh:0,rawLow:0,scaleHigh:0,scaleLow:0,valueCalculationMethod:0,saveIntervalSeconds:4,saveHistoricalIntervalSeconds:60,numberOfSamples:1,saveOnChange:0,saveOnChangeRange:0,onText:"",onTextFa:"",offText:"",offTextFa:"",unit:"",unitFa:"",isDisabled:!1,isCalibrationEnabled:!1,calibrationA:1,calibrationB:0,interfaceType:0,isEditable:!1}),j=t.useMemo(()=>1===x.itemType||2===x.itemType,[x.itemType]),y=t.useMemo(()=>3===x.itemType||4===x.itemType,[x.itemType]),I=t.useMemo(()=>y&&1===x.shouldScale,[y,x.shouldScale]);t.useEffect(()=>{(async()=>{if(e){f(!0);try{Qa.log("Fetching next point number");const e=await b();e.success&&e.nextPointNumber>0?(Qa.log("Next point number retrieved:",e.nextPointNumber),h(a=>({...a,pointNumber:e.nextPointNumber}))):Qa.warn("Failed to retrieve next point number, using default 0")}catch(a){Qa.error("Error fetching next point number:",a)}finally{f(!1)}}})()},[e]);const k=(e,a)=>{h(t=>({...t,[e]:a}))},H=()=>{if(c(null),!x.itemName.trim())return c(n("addItemDialog.errors.itemNameRequired")),!1;if(x.pointNumber<0)return c(n("addItemDialog.errors.invalidPointNumber")),!1;if(x.saveIntervalSeconds<=0)return c(n("addItemDialog.errors.invalidSaveInterval")),!1;if(I){if(x.rawHigh===x.rawLow)return c(n("addItemDialog.errors.invalidRawRange")),!1;if(x.scaleHigh===x.scaleLow)return c(n("addItemDialog.errors.invalidScaleRange")),!1}return!0},B=async()=>{if(H()){d(!0),c(null),g({}),Qa.log("Adding new item");try{const e=e=>{const a=e.trim();return a.length>0?a:null},a=e=>null!=e?e:null,t={itemType:x.itemType,itemName:x.itemName.trim(),itemNameFa:e(x.itemNameFa),pointNumber:x.pointNumber,shouldScale:x.shouldScale,normMin:x.rawLow,normMax:x.rawHigh,scaleMin:x.scaleLow,scaleMax:x.scaleHigh,saveInterval:x.saveIntervalSeconds,saveHistoricalInterval:x.saveHistoricalIntervalSeconds,calculationMethod:x.valueCalculationMethod,numberOfSamples:x.numberOfSamples,saveOnChange:0===x.saveOnChange?null:x.saveOnChange,saveOnChangeRange:a(x.saveOnChangeRange),onText:e(x.onText),onTextFa:e(x.onTextFa),offText:e(x.offText),offTextFa:e(x.offTextFa),unit:e(x.unit),unitFa:e(x.unitFa),isDisabled:x.isDisabled,isCalibrationEnabled:x.isCalibrationEnabled?x.isCalibrationEnabled:null,calibrationA:a(x.calibrationA),calibrationB:a(x.calibrationB),interfaceType:x.interfaceType,isEditable:x.isEditable,parentGroupId:r||null};Qa.log("Sending add request with DTO:",t);const i=await v(t);if(!i.success){const e=i.error;let a=n("addItemDialog.errors.saveFailed");if(void 0!==e)switch(e){case ea.InvalidPointNumber:a=n("addItemDialog.errors.invalidPointNumber");break;case ea.DuplicatePointNumber:a=n("addItemDialog.errors.duplicatePointNumber");break;case ea.ValidationError:a=i.message||n("addItemDialog.errors.validationError");break;case ea.Unauthorized:a=n("addItemDialog.errors.unauthorized")}return c(a),void Qa.error("Failed to add item:",i.message,"Error type:",e)}Qa.log("Item added successfully",{itemId:i.itemId}),o&&o(),R()}catch(e){Qa.error("Error adding item:",e);const a=e;if(400===a.status&&a.errors){const e={},t={ItemName:"itemName",ItemNameFa:"itemNameFa",PointNumber:"pointNumber",NumberOfSamples:"numberOfSamples",SaveInterval:"saveIntervalSeconds",SaveHistoricalInterval:"saveHistoricalIntervalSeconds",NormMin:"rawLow",NormMax:"rawHigh",ScaleMin:"scaleLow",ScaleMax:"scaleHigh",Unit:"unit",UnitFa:"unitFa",OnText:"onText",OnTextFa:"onTextFa",OffText:"offText",OffTextFa:"offTextFa",CalibrationA:"calibrationA",CalibrationB:"calibrationB",SaveOnChangeRange:"saveOnChangeRange"};Object.keys(a.errors).forEach(i=>{const r=t[i]||i.charAt(0).toLowerCase()+i.slice(1),o=a.errors[i];o&&o.length>0&&(e[r]=o.join(" "))}),g(e),c(n("addItemDialog.errors.validationErrorsFound")),Qa.error("Validation errors:",e)}else c(a.message||n("addItemDialog.errors.saveFailed"))}finally{d(!1)}}},R=()=>{s||(h({itemType:1,itemName:"",itemNameFa:"",pointNumber:0,shouldScale:2,rawHigh:0,rawLow:0,scaleHigh:0,scaleLow:0,valueCalculationMethod:0,saveIntervalSeconds:4,saveHistoricalIntervalSeconds:60,numberOfSamples:1,saveOnChange:0,saveOnChangeRange:0,onText:"",onTextFa:"",offText:"",offTextFa:"",unit:"",unitFa:"",isDisabled:!1,isCalibrationEnabled:!1,calibrationA:1,calibrationB:0,interfaceType:0,isEditable:!1}),c(null),g({}),a())};return i.jsxs(C,{open:e,onClose:R,maxWidth:"md",fullWidth:!0,"data-id-ref":"add-item-dialog",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[i.jsx(D,{"data-id-ref":"add-item-dialog-title",children:i.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(S,{variant:"h6",component:"span",children:n("addItemDialog.title")}),i.jsx(Q,{edge:"end",color:"inherit",onClick:R,disabled:s,"aria-label":n("common.close"),"data-id-ref":"add-item-dialog-close-button",children:i.jsx(be,{"data-id-ref":"add-item-dialog-close-icon"})})]})}),i.jsxs(T,{dividers:!0,"data-id-ref":"add-item-dialog-content",children:[m&&i.jsx(A,{severity:"error",sx:{mb:2},"data-id-ref":"add-item-dialog-save-error",children:m}),i.jsxs(w,{"data-id-ref":"add-item-dialog-form",children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"add-item-dialog-basic-info-heading",children:n("addItemDialog.sections.basicInformation")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,disabled:s,children:[i.jsx(P,{id:"item-type-label",children:n("addItemDialog.fields.itemType")}),i.jsxs(M,{labelId:"item-type-label",value:x.itemType,label:n("addItemDialog.fields.itemType"),onChange:e=>k("itemType",e.target.value),"data-id-ref":"add-item-dialog-item-type",children:[i.jsx(E,{value:1,children:n("itemCard.itemTypes.digitalInput")}),i.jsx(E,{value:2,children:n("itemCard.itemTypes.digitalOutput")}),i.jsx(E,{value:3,children:n("itemCard.itemTypes.analogInput")}),i.jsx(E,{value:4,children:n("itemCard.itemTypes.analogOutput")})]})]}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.pointNumber"),type:"number",value:x.pointNumber,onChange:e=>k("pointNumber",parseInt(e.target.value)||0),disabled:s||p,required:!0,error:!!u.pointNumber,helperText:u.pointNumber||n(p?"addItemDialog.fields.loadingNextNumber":"addItemDialog.fields.nextAvailablePointNumber"),inputProps:{min:0,max:2147483647},"data-id-ref":"add-item-dialog-point-number",InputProps:{endAdornment:p?i.jsx(L,{size:20,"data-id-ref":"add-item-dialog-point-number-loading"}):void 0}})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,disabled:s,children:[i.jsx(P,{id:"interface-type-label",children:n("addItemDialog.fields.interfaceType")}),i.jsxs(M,{labelId:"interface-type-label",value:x.interfaceType,label:n("addItemDialog.fields.interfaceType"),onChange:e=>k("interfaceType",e.target.value),"data-id-ref":"add-item-dialog-interface-type",children:[i.jsx(E,{value:0,children:n("addItemDialog.interfaceTypes.none")}),i.jsx(E,{value:1,children:n("addItemDialog.interfaceTypes.sharp7")}),i.jsx(E,{value:2,children:n("addItemDialog.interfaceTypes.bacnet")}),i.jsx(E,{value:3,children:n("addItemDialog.interfaceTypes.modbus")})]})]}),i.jsx(N,{control:i.jsx(Z,{checked:x.isEditable,onChange:e=>k("isEditable",e.target.checked),disabled:s,"data-id-ref":"add-item-dialog-is-editable-switch"}),label:n("addItemDialog.fields.isEditable"),sx:{flex:1,display:"flex",justifyContent:"flex-start"},"data-id-ref":"add-item-dialog-is-editable"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.itemName"),value:x.itemName,onChange:e=>k("itemName",e.target.value),disabled:s,required:!0,error:!!u.itemName,helperText:u.itemName||"",inputProps:{maxLength:200},"data-id-ref":"add-item-dialog-item-name"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.itemNameFa"),value:x.itemNameFa,onChange:e=>k("itemNameFa",e.target.value),disabled:s,error:!!u.itemNameFa,helperText:u.itemNameFa||"",inputProps:{maxLength:200},"data-id-ref":"add-item-dialog-item-name-fa"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsxs(z,{fullWidth:!0,children:[i.jsx(P,{id:"value-calc-method-label",children:n("addItemDialog.fields.valueCalculationMethod")}),i.jsxs(M,{labelId:"value-calc-method-label",value:x.valueCalculationMethod,label:n("addItemDialog.fields.valueCalculationMethod"),onChange:e=>k("valueCalculationMethod",e.target.value),disabled:s,"data-id-ref":"add-item-dialog-value-calc-method",children:[i.jsx(E,{value:0,children:n("addItemDialog.valueCalculationMethods.lastValue")}),i.jsx(E,{value:1,children:n("addItemDialog.valueCalculationMethods.average")})]})]}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.numberOfSamples"),type:"number",value:x.numberOfSamples,onChange:e=>k("numberOfSamples",parseInt(e.target.value)||1),disabled:s,required:!0,error:!!u.numberOfSamples,helperText:u.numberOfSamples||"",inputProps:{min:1,max:100},"data-id-ref":"add-item-dialog-number-of-samples"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.saveIntervalSeconds"),type:"number",value:x.saveIntervalSeconds,onChange:e=>k("saveIntervalSeconds",parseInt(e.target.value)||5),disabled:s,required:!0,error:!!u.saveIntervalSeconds,helperText:u.saveIntervalSeconds||"",inputProps:{min:1,max:3600},"data-id-ref":"add-item-dialog-save-interval"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.saveHistoricalIntervalSeconds"),type:"number",value:x.saveHistoricalIntervalSeconds,onChange:e=>k("saveHistoricalIntervalSeconds",parseInt(e.target.value)||5),disabled:s,required:!0,error:!!u.saveHistoricalIntervalSeconds,helperText:u.saveHistoricalIntervalSeconds||"",inputProps:{min:1,max:3600},"data-id-ref":"add-item-dialog-save-historical-interval"})]}),i.jsx(N,{control:i.jsx(Z,{checked:x.isDisabled,onChange:e=>k("isDisabled",e.target.checked),disabled:s,"data-id-ref":"add-item-dialog-is-disabled-switch"}),label:n("addItemDialog.fields.isDisabled"),"data-id-ref":"add-item-dialog-is-disabled"})]}),i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"add-item-dialog-advanced-settings-heading",children:n("addItemDialog.sections.advancedSettings")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(z,{fullWidth:!0,disabled:s,children:[i.jsx(P,{id:"save-on-change-label",children:n("addItemDialog.fields.saveOnChange")}),i.jsxs(M,{labelId:"save-on-change-label",id:"save-on-change",value:x.saveOnChange,label:n("addItemDialog.fields.saveOnChange"),onChange:e=>k("saveOnChange",e.target.value),"data-id-ref":"add-item-dialog-save-on-change",children:[i.jsx(E,{value:0,children:n("addItemDialog.saveOnChangeOptions.default")}),i.jsx(E,{value:1,children:n("addItemDialog.saveOnChangeOptions.on")}),i.jsx(E,{value:2,children:n("addItemDialog.saveOnChangeOptions.off")})]})]}),1===x.saveOnChange&&i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.saveOnChangeRange"),type:"number",value:x.saveOnChangeRange,onChange:e=>k("saveOnChangeRange",parseFloat(e.target.value)||0),disabled:s,error:!!u.saveOnChangeRange,helperText:u.saveOnChangeRange||n("addItemDialog.fields.saveOnChangeRangeHelper"),inputProps:{min:0,step:.1},"data-id-ref":"add-item-dialog-save-on-change-range"}),i.jsx(N,{control:i.jsx(Z,{checked:x.isCalibrationEnabled,onChange:e=>k("isCalibrationEnabled",e.target.checked),disabled:s,"data-id-ref":"add-item-dialog-is-calibration-enabled-switch"}),label:n("addItemDialog.fields.isCalibrationEnabled"),"data-id-ref":"add-item-dialog-is-calibration-enabled"}),x.isCalibrationEnabled&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"add-item-dialog-calibration-formula",children:n("addItemDialog.fields.calibrationFormula")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.calibrationA"),type:"number",value:x.calibrationA,onChange:e=>k("calibrationA",parseFloat(e.target.value)||1),disabled:s,error:!!u.calibrationA,helperText:u.calibrationA||n("addItemDialog.fields.calibrationAHelper"),inputProps:{step:.01},"data-id-ref":"add-item-dialog-calibration-a"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.calibrationB"),type:"number",value:x.calibrationB,onChange:e=>k("calibrationB",parseFloat(e.target.value)||0),disabled:s,error:!!u.calibrationB,helperText:u.calibrationB||n("addItemDialog.fields.calibrationBHelper"),inputProps:{step:.01},"data-id-ref":"add-item-dialog-calibration-b"})]})]})]}),j&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"add-item-dialog-digital-fields-heading",children:n("addItemDialog.sections.digitalFields")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.onText"),value:x.onText,onChange:e=>k("onText",e.target.value),disabled:s,error:!!u.onText,helperText:u.onText||"",inputProps:{maxLength:50},"data-id-ref":"add-item-dialog-on-text"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.onTextFa"),value:x.onTextFa,onChange:e=>k("onTextFa",e.target.value),disabled:s,error:!!u.onTextFa,helperText:u.onTextFa||"",inputProps:{maxLength:50},"data-id-ref":"add-item-dialog-on-text-fa"})]}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.offText"),value:x.offText,onChange:e=>k("offText",e.target.value),disabled:s,error:!!u.offText,helperText:u.offText||"",inputProps:{maxLength:50},"data-id-ref":"add-item-dialog-off-text"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.offTextFa"),value:x.offTextFa,onChange:e=>k("offTextFa",e.target.value),disabled:s,error:!!u.offTextFa,helperText:u.offTextFa||"",inputProps:{maxLength:50},"data-id-ref":"add-item-dialog-off-text-fa"})]})]})]}),y&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,"data-id-ref":"add-item-dialog-analog-fields-heading",children:n("addItemDialog.sections.analogFields")}),i.jsx(F,{sx:{mb:2}}),i.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.unit"),value:x.unit,onChange:e=>k("unit",e.target.value),disabled:s,error:!!u.unit,helperText:u.unit||"",inputProps:{maxLength:20},"data-id-ref":"add-item-dialog-unit"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.unitFa"),value:x.unitFa,onChange:e=>k("unitFa",e.target.value),disabled:s,error:!!u.unitFa,helperText:u.unitFa||"",inputProps:{maxLength:20},"data-id-ref":"add-item-dialog-unit-fa"})]}),i.jsx(N,{control:i.jsx(Z,{checked:1===x.shouldScale,onChange:e=>k("shouldScale",e.target.checked?1:2),disabled:s,"data-id-ref":"add-item-dialog-should-scale-switch"}),label:n("addItemDialog.fields.shouldScale"),"data-id-ref":"add-item-dialog-should-scale"}),I&&i.jsxs(i.Fragment,{children:[i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"add-item-dialog-raw-range-label",children:n("addItemDialog.sections.rawRange")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.rawLow"),type:"number",value:x.rawLow,onChange:e=>k("rawLow",parseFloat(e.target.value)||0),disabled:s,error:!!u.rawLow,helperText:u.rawLow||"","data-id-ref":"add-item-dialog-raw-low"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.rawHigh"),type:"number",value:x.rawHigh,onChange:e=>k("rawHigh",parseFloat(e.target.value)||0),disabled:s,error:!!u.rawHigh,helperText:u.rawHigh||"","data-id-ref":"add-item-dialog-raw-high"})]}),i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"add-item-dialog-scale-range-label",children:n("addItemDialog.sections.scaleRange")}),i.jsxs(w,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.scaleLow"),type:"number",value:x.scaleLow,onChange:e=>k("scaleLow",parseFloat(e.target.value)||0),disabled:s,error:!!u.scaleLow,helperText:u.scaleLow||"","data-id-ref":"add-item-dialog-scale-low"}),i.jsx(G,{fullWidth:!0,label:n("addItemDialog.fields.scaleHigh"),type:"number",value:x.scaleHigh,onChange:e=>k("scaleHigh",parseFloat(e.target.value)||0),disabled:s,error:!!u.scaleHigh,helperText:u.scaleHigh||"","data-id-ref":"add-item-dialog-scale-high"})]})]})]})]})]})]}),i.jsxs(O,{"data-id-ref":"add-item-dialog-actions",children:[i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),R()},disabled:s,"data-id-ref":"add-item-dialog-cancel-button",children:n("common.cancel")}),i.jsx(W,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),B()},variant:"contained",disabled:s,"data-id-ref":"add-item-dialog-save-button",children:n(s?"common.saving":"common.save")})]})]})},at=e=>{switch(e){case"name":return i.jsx(qe,{fontSize:"small"});case"value":return i.jsx(Ke,{fontSize:"small"});case"alarm":return i.jsx(xe,{fontSize:"small"});case"type":return i.jsx($e,{fontSize:"small"});case"pointNumber":return i.jsx(Re,{fontSize:"small"});case"timestamp":return i.jsx(Be,{fontSize:"small"});default:return i.jsx(He,{fontSize:"small"})}},tt=({sortConfig:e,onSortFieldChange:a,onDirectionToggle:t,onReset:o,"data-id-ref":n="sort-menu"})=>{const{t:s}=l(),[d,m]=r.useState(null),c=Boolean(d),u=()=>{m(null)},g=at(e.field);return i.jsxs(i.Fragment,{children:[i.jsx(oe,{title:s("sort.tooltip"),children:i.jsx(Q,{onClick:e=>{m(e.currentTarget)},"data-id-ref":n,"aria-label":s("sort.tooltip"),"aria-controls":c?"sort-menu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,color:"none"!==e.field?"primary":"default",children:g})}),i.jsxs(X,{id:"sort-menu",anchorEl:d,open:c,onClose:u,"data-id-ref":`${n}-dropdown`,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[i.jsxs(w,{sx:{px:2,py:1,minWidth:200},children:[i.jsx(S,{variant:"caption",color:"text.secondary",children:s("sort.currentSort")}),i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[i.jsx(S,{variant:"body2",fontWeight:"medium",children:s(oa.find(a=>a.field===e.field)?.labelKey||"sort.fields.none")}),"none"!==e.field&&i.jsx(Q,{size:"small",onClick:()=>{t()},"data-id-ref":`${n}-toggle-direction`,"aria-label":s("sort.toggleDirection"),children:"asc"===e.direction?i.jsx(We,{fontSize:"small"}):i.jsx(Le,{fontSize:"small"})})]})]}),i.jsx(F,{}),oa.map(t=>{const r=e.field===t.field;return i.jsxs(E,{onClick:()=>{return e=t.field,a(e),void u();var e},selected:r,"data-id-ref":`${n}-option-${t.field}`,children:[i.jsx(_,{children:at(t.field)}),i.jsx(Y,{children:s(t.labelKey)}),r&&i.jsx(Ge,{fontSize:"small",color:"primary",sx:{ml:1}})]},t.field)}),"none"!==e.field&&i.jsx(F,{}),"none"!==e.field&&i.jsxs(E,{onClick:()=>{o(),u()},"data-id-ref":`${n}-reset`,children:[i.jsx(_,{children:i.jsx(be,{fontSize:"small"})}),i.jsx(Y,{children:s("sort.reset")})]})]})]})},it=o(),rt=()=>{const{t:e,language:a}=l(),r=ta(),{user:o}=c(),{state:s,setCurrentFolderId:d,fetchValues:m,fetchGroups:u,fetchItems:g}=n(),[p]=ia(),f=p.get("folderId"),[x,h]=t.useState(null),[b,v]=t.useState(null),[j,I]=t.useState(!1),[C,D]=t.useState(!1),T=o?.roles?.includes("Admin")||!1,[F,N]=t.useState(!1),k=t.useRef(null),z=t.useRef(null),{groups:P,groupsLoading:M,groupsError:A,items:O,itemsLoading:W,itemsError:G,values:H,valuesLoading:B,alarms:$}=s;t.useEffect(()=>{d(f)},[f,d]);const{childGroups:q,breadcrumbs:V}=t.useMemo(()=>{if(!P||0===P.length)return{childGroups:[],breadcrumbs:[]};if(!f)return{childGroups:P.filter(e=>!e.parentId||null===e.parentId),breadcrumbs:[]};const e=P.find(e=>e.id===f);if(!e)return{childGroups:[],breadcrumbs:[]};const a=P.filter(e=>e.parentId===f),t=[];let i=e;for(;i;)t.unshift(i),i=i.parentId?P.find(e=>e.id===i.parentId):void 0;return{childGroups:a,breadcrumbs:t}},[P,f]),Z=t.useMemo(()=>O&&0!==O.length?f?O.filter(e=>e.groupId===f):O.filter(e=>!e.groupId||null===e.groupId):[],[O,f]),J=t.useMemo(()=>{const e={};return Object.entries(H||{}).forEach(([a,t])=>{t&&"time"in t&&(e[a]=t.time)}),e},[H]),Q=t.useMemo(()=>{const e={};return Object.entries(H||{}).forEach(([a,t])=>{if(t&&"value"in t&&null!==t.value){const i=Number(t.value);if(isNaN(i)){const i=t.value.toLowerCase();"true"===i||"1"===i?e[a]=!0:"false"!==i&&"0"!==i||(e[a]=!1)}else e[a]=i}}),e},[H]),{sortedItems:ee,sortConfig:ae,setSortField:te,toggleDirection:ie,resetSort:re}=Ca({groupId:f,language:a,items:Z,values:Q,alarms:$||[],timestamps:J}),oe=t.useMemo(()=>{const e=ee.map(e=>e.id);return JSON.stringify(e)},[ee]);t.useEffect(()=>{const e=JSON.parse(oe);if(0===e.length)return;const a=setTimeout(()=>{m(e)},150);return z.current=window.setInterval(()=>{m(e)},4e3),()=>{clearTimeout(a),z.current&&(clearInterval(z.current),z.current=null)}},[oe]),t.useEffect(()=>(B?(N(!0),k.current&&(clearTimeout(k.current),k.current=null)):F&&(k.current=setTimeout(()=>{N(!1),k.current=null},1e3)),()=>{k.current&&clearTimeout(k.current)}),[B,F]);const ne=t.useCallback(e=>"fa"===a&&e.nameFa?e.nameFa:e.name,[a]),ce=t.useCallback(e=>"fa"===a&&e.nameFa?e.nameFa:e.name,[a]),ge=t.useCallback(e=>{const a=H.find(a=>a.itemId===e);return a?{...a,isLoading:!1}:{itemId:e,value:null,time:0,isLoading:!0}},[H]),pe=t.useCallback((t,i,r)=>{if(r)return"...";if(null==i)return e("noValue");if(1===t.itemType||2===t.itemType)return"true"===i||"1"===i?"fa"===a&&t.onTextFa?t.onTextFa:t.onText||e("on"):"fa"===a&&t.offTextFa?t.offTextFa:t.offText||e("off");const o=parseFloat(i);if(!isNaN(o)){const e="fa"===a&&t.unitFa?t.unitFa:t.unit||"";return`${o.toFixed(2)} ${e}`}return i},[a,e]),fe=t.useCallback((e,t)=>t||0===e?"...":y(e,a,"long"),[a]),xe=e=>{r(e?`/dashboard/monitoring?folderId=${e}`:"/dashboard/monitoring")},he=()=>{it.log("Closing admin menu"),h(null),v(null)};return i.jsxs(le,{maxWidth:!1,"data-id-ref":"monitoring-page-root-container",sx:{height:"100%",width:"100%",py:"24px",px:0,mx:0},children:[i.jsxs(R,{"data-id-ref":"monitoring-page-main-card",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[i.jsx(se,{"data-id-ref":"monitoring-page-header",title:i.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2},"data-id-ref":"monitoring-page-title-row",children:[i.jsx(S,{variant:"h4",component:"h1","data-id-ref":"monitoring-page-title",children:e("monitoring")}),F&&ee.length>0&&i.jsxs(w,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:1},"data-id-ref":"monitoring-page-refresh-indicator-container",children:[i.jsx(L,{size:16,"data-id-ref":"monitoring-page-refresh-spinner"}),i.jsx(S,{variant:"body2",color:"text.secondary","data-id-ref":"monitoring-page-refresh-label",children:e("refreshingData")})]})]})}),i.jsxs(K,{"data-id-ref":"monitoring-page-body",sx:{flex:1,overflow:"auto",...T&&{cursor:"context-menu"}},onContextMenu:e=>{const a=e.target,t=a.closest('[data-id-ref="group-card-root-container"]')||a.closest('[data-id-ref="group-card-action-area"]'),i=a.closest('[data-id-ref="item-card-root-container"]');if(t||i)return;if(e.preventDefault(),e.stopPropagation(),!T)return;const r=e.clientX,o=e.clientY,n=e.currentTarget;null!==x?(it.log("Closing existing admin menu before opening new one"),h(null),v(null),requestAnimationFrame(()=>{requestAnimationFrame(()=>{it.log("Opening admin menu at new position",{currentFolderId:f,x:r,y:o}),h(n),v({top:o,left:r})})})):(it.log("Opening admin menu via right-click",{currentFolderId:f,x:r,y:o}),h(n),v({top:o,left:r}))},children:[V.length>0&&i.jsx(w,{sx:{mb:3,display:{xs:"none",md:"block"}},"data-id-ref":"monitoring-page-breadcrumb-nav",children:i.jsxs(de,{"aria-label":"breadcrumb","data-id-ref":"monitoring-page-breadcrumb-list",children:[i.jsxs(me,{underline:"hover",sx:{display:"flex",alignItems:"center",cursor:"pointer"},color:"inherit",onClick:()=>xe(null),"data-id-ref":"monitoring-page-breadcrumb-root-link",children:[i.jsx(Ve,{sx:{mr:.5},fontSize:"small","data-id-ref":"monitoring-page-breadcrumb-root-icon"}),e("rootFolder")]}),V.map((e,a)=>a===V.length-1?i.jsx(S,{color:"text.primary","data-id-ref":`monitoring-page-breadcrumb-item-${e.id}`,children:ne(e)},e.id):i.jsx(me,{underline:"hover",sx:{cursor:"pointer"},color:"inherit",onClick:()=>xe(e.id),"data-id-ref":`monitoring-page-breadcrumb-link-${e.id}`,children:ne(e)},e.id))]})}),M,A,0===q.length&&0===ee.length&&i.jsxs(w,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,textAlign:"center"},"data-id-ref":"monitoring-page-empty-state-container",children:[i.jsx(ue,{sx:{fontSize:80,color:"text.disabled",mb:2},"data-id-ref":"monitoring-page-empty-state-icon"}),i.jsx(S,{variant:"h6",color:"text.secondary",gutterBottom:!0,"data-id-ref":"monitoring-page-empty-state-title",children:e(f?"emptyFolder":"noItemsFound")}),i.jsx(S,{variant:"body2",color:"text.disabled",sx:{maxWidth:500},"data-id-ref":"monitoring-page-empty-state-description",children:e(f?"emptyFolderDescription":"noItemsDescription")})]}),q.length>0&&i.jsxs(w,{sx:{mb:4},"data-id-ref":"monitoring-page-folder-grid-section",children:[i.jsxs(w,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:1,mb:3},"data-id-ref":"monitoring-page-folder-grid-header",children:[i.jsx(ue,{color:"warning","data-id-ref":"monitoring-page-folder-grid-icon"}),i.jsx(S,{variant:"h5",component:"h2","data-id-ref":"monitoring-page-folder-grid-title",children:e("folders")}),i.jsx(U,{label:q.length,size:"small",color:"secondary","data-id-ref":"monitoring-page-folder-grid-count"})]}),i.jsx(w,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)",lg:"repeat(5, 1fr)",xl:"repeat(6, 1fr)"},gap:{xs:1.5,sm:2,md:3},marginTop:2},"data-id-ref":"monitoring-page-folder-grid",children:q.map(e=>{const a=P.filter(a=>a.parentId===e.id).length,t=O.filter(a=>a.groupId===e.id).length;return i.jsx(Pa,{group:e,subgroupCount:a,itemCount:t,onClick:()=>{return a=e.id,void r(`/dashboard/monitoring?folderId=${a}`);var a},"data-id-ref":`monitoring-page-group-card-${e.id}`},e.id)})})]}),ee.length>0&&i.jsxs(w,{"data-id-ref":"monitoring-page-items-list-section",children:[i.jsxs(w,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:1,mb:3},"data-id-ref":"monitoring-page-items-list-header",children:[i.jsx(Ue,{color:"primary","data-id-ref":"monitoring-page-items-list-icon"}),i.jsx(S,{variant:"h5",component:"h2","data-id-ref":"monitoring-page-items-list-title",children:e("items")}),i.jsx(U,{label:ee.length,size:"small",color:"secondary","data-id-ref":"monitoring-page-items-list-count"}),i.jsx(w,{sx:{ml:"auto"},"data-id-ref":"monitoring-page-items-sort-container",children:i.jsx(tt,{sortConfig:ae,onSortFieldChange:te,onDirectionToggle:ie,onReset:re,"data-id-ref":"monitoring-page-items-sort-menu"})})]}),i.jsx(w,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)",xl:"repeat(2, 1fr)"},gap:2,marginTop:2},"data-id-ref":"monitoring-page-items-grid",children:ee.map(e=>{const a=ge(e.id),t=ce(e),r=pe(e,a.value,a.isLoading),o=fe(a.time,a.isLoading);return i.jsx(Ya,{itemId:e.id,name:t,pointNumber:e.pointNumber,value:r,time:o,valueHistory:void 0,item:e,isLoadingValue:a.isLoading,"data-id-ref":`monitoring-page-item-card-${e.id}`},e.id)})})]}),W,G]})]}),i.jsxs(X,{open:Boolean(x)&&null!==b,onClose:he,anchorReference:"anchorPosition",anchorPosition:null!==b?{top:b.top,left:b.left}:void 0,MenuListProps:{onContextMenu:e=>{e.preventDefault(),e.stopPropagation()}},"data-id-ref":"monitoring-page-admin-menu",children:[i.jsxs(E,{onClick:()=>{it.log("Add folder clicked",{currentFolderId:f}),he(),I(!0)},"data-id-ref":"monitoring-page-admin-menu-add-folder",children:[i.jsx(_,{children:i.jsx(Xe,{fontSize:"small","data-id-ref":"monitoring-page-admin-menu-add-folder-icon"})}),i.jsx(Y,{primary:e("monitoringPage.adminMenu.addFolder")})]}),f&&i.jsxs(E,{onClick:()=>{it.log("Add point clicked",{currentFolderId:f}),he(),D(!0)},"data-id-ref":"monitoring-page-admin-menu-add-point",children:[i.jsx(_,{children:i.jsx(_e,{fontSize:"small","data-id-ref":"monitoring-page-admin-menu-add-point-icon"})}),i.jsx(Y,{primary:e("monitoringPage.adminMenu.addPoint")})]})]}),i.jsx(Ja,{open:j,onClose:()=>I(!1),onSuccess:e=>{it.log("Group added successfully",{groupId:e,currentFolderId:f}),u()},parentId:f}),i.jsx(et,{open:C,onClose:()=>D(!1),onSuccess:()=>{it.log("Point added successfully",{currentFolderId:f}),u(),g()},parentGroupId:f||void 0})]})};export{rt as default};
